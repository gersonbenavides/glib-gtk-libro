<!DOCTYPE HTML>
<html lang="es" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>La plataforma de desarrollo GLib/GTK</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-2BG5WVZ08D"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-2BG5WVZ08D');
</script>

        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="./src/assets/css/custom.css">

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="content/book/struct/title.html">La plataforma de desarrollo GLib/GTK</a></li><li class="chapter-item expanded "><a href="content/intro/chpt/intro.html"><strong aria-hidden="true">1.</strong> Introducci√≥n</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/intro/sect/glib-gtk.html"><strong aria-hidden="true">1.1.</strong> ¬øQu√© es GLib y GTK?</a></li><li class="chapter-item expanded "><a href="content/intro/sect/gnome-dskt.html"><strong aria-hidden="true">1.2.</strong> El escritorio GNOME</a></li><li class="chapter-item expanded "><a href="content/intro/sect/preq.html"><strong aria-hidden="true">1.3.</strong> Prerrequisitos</a></li><li class="chapter-item expanded "><a href="content/intro/sect/why-when-c.html"><strong aria-hidden="true">1.4.</strong> ¬øPor qu√© y cu√°ndo se usa el lenguaje C?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/intro/sect/sep-backend.html"><strong aria-hidden="true">1.4.1.</strong> Separaci√≥n de backend del frontend</a></li><li class="chapter-item expanded "><a href="content/intro/sect/other-aspects.html"><strong aria-hidden="true">1.4.2.</strong> Otros aspectos a tener en cuenta</a></li></ol></li><li class="chapter-item expanded "><a href="content/intro/sect/lrn-path.html"><strong aria-hidden="true">1.5.</strong> Ruta de aprendizaje</a></li><li class="chapter-item expanded "><a href="content/intro/sect/dev-env.html"><strong aria-hidden="true">1.6.</strong> El entorno de desarrollo</a></li><li class="chapter-item expanded "><a href="content/intro/install/install.html"><strong aria-hidden="true">1.7.</strong> Instalaci√≥n</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/intro/install/linux.html"><strong aria-hidden="true">1.7.1.</strong> Linux</a></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.7.2.</strong> Windows</div></li><li class="chapter-item expanded "><div><strong aria-hidden="true">1.7.3.</strong> Mac</div></li><li class="spacer"></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">GLib, la biblioteca principal</li><li class="chapter-item expanded "><a href="content/glib/chpt/glib.html"><strong aria-hidden="true">2.</strong> GLib, la biblioteca principal</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/glib/basics/basics.html"><strong aria-hidden="true">2.1.</strong> Lo esencial</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/glib/basics/type-def.html"><strong aria-hidden="true">2.1.1.</strong> Definiciones de tipo</a></li><li class="chapter-item expanded "><a href="content/glib/basics/freq-macros.html"><strong aria-hidden="true">2.1.2.</strong> Macros de uso frecuente</a></li><li class="chapter-item expanded "><a href="content/glib/basics/dbg-macros.html"><strong aria-hidden="true">2.1.3.</strong> Macros de depuraci√≥n</a></li><li class="chapter-item expanded "><a href="content/glib/basics/mem.html"><strong aria-hidden="true">2.1.4.</strong> Memoria</a></li><li class="chapter-item expanded "><a href="content/glib/basics/str-hdlg.html"><strong aria-hidden="true">2.1.5.</strong> Manejo de string</a></li></ol></li><li class="chapter-item expanded "><a href="content/glib/data-struct/data-struct.html"><strong aria-hidden="true">2.2.</strong> Estructura de datos</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/glib/data-struct/lists.html"><strong aria-hidden="true">2.2.1.</strong> Listas</a></li><li class="chapter-item expanded "><a href="content/glib/data-struct/trees.html"><strong aria-hidden="true">2.2.2.</strong> √Årboles</a></li><li class="chapter-item expanded "><a href="content/glib/data-struct/hash-tables.html"><strong aria-hidden="true">2.2.3.</strong> Tablas hash</a></li></ol></li><li class="chapter-item expanded "><a href="content/glib/sect/main-loop.html"><strong aria-hidden="true">2.3.</strong> El bucle del evento principal</a></li><li class="chapter-item expanded "><a href="content/glib/sect/other-feat.html"><strong aria-hidden="true">2.4.</strong> Otras caracter√≠sticas</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Programaci√≥n orientada a objetos en C</li><li class="chapter-item expanded "><a href="content/oop-semi/chpt/oop-semi.html"><strong aria-hidden="true">3.</strong> Programaci√≥n semi-orientada a objetos en C</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/hdr-ex.html"><strong aria-hidden="true">3.1.</strong> Ejemplo de encabezado</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/prj-names.html"><strong aria-hidden="true">3.1.1.</strong> Espacio de nombres del proyecto</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/class-names.html"><strong aria-hidden="true">3.1.2.</strong> Espacio de nombres de clase</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/letter-case.html"><strong aria-hidden="true">3.1.3.</strong> ¬øMin√∫sculas, May√∫sculas o CamelCase?</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/incl-guard.html"><strong aria-hidden="true">3.1.4.</strong> Incluir guardia</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/cpp-supt.html"><strong aria-hidden="true">3.1.5.</strong> Soporte de C++</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/incl.html"><strong aria-hidden="true">3.1.6.</strong> #include</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/type-def.html"><strong aria-hidden="true">3.1.7.</strong> Definici√≥n de tipo</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/obj-ctor.html"><strong aria-hidden="true">3.1.8.</strong> Constructor de objetos</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/obj-dtor.html"><strong aria-hidden="true">3.1.9.</strong> Destructor de objetos</a></li><li class="chapter-item expanded "><a href="content/oop-semi/hdr-ex/other-func.html"><strong aria-hidden="true">3.1.10.</strong> Otras funciones p√∫blicas</a></li></ol></li><li class="chapter-item expanded "><a href="content/oop-semi/c-file/c-file.html"><strong aria-hidden="true">3.2.</strong> El archivo *.c correspondiente</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/oop-semi/c-file/order-incl.html"><strong aria-hidden="true">3.2.1.</strong> Orden de #include</a></li><li class="chapter-item expanded "><a href="content/oop-semi/c-file/gtk-doc-cmnt.html"><strong aria-hidden="true">3.2.2.</strong> Comentarios de GTK-Doc</a></li><li class="chapter-item expanded "><a href="content/oop-semi/c-file/gobj-introsp.html"><strong aria-hidden="true">3.2.3.</strong> Anotaciones de introspecci√≥n de GObject</a></li><li class="chapter-item expanded "><a href="content/oop-semi/c-file/stc-vs-non-stc.html"><strong aria-hidden="true">3.2.4.</strong> Funciones est√°ticas vs funciones no est√°ticas</a></li><li class="chapter-item expanded "><a href="content/oop-semi/c-file/defen-prog.html"><strong aria-hidden="true">3.2.5.</strong> Programaci√≥n defensiva</a></li><li class="chapter-item expanded "><a href="content/oop-semi/c-file/coding-style.html"><strong aria-hidden="true">3.2.6.</strong> Estilo de codificaci√≥n</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="content/oop-gobj/chpt/oop-gobj.html"><strong aria-hidden="true">4.</strong> Una suave introducci√≥n a GObject</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/oop-gobj/sect/inherit.html"><strong aria-hidden="true">4.1.</strong> Herencia</a></li><li class="chapter-item expanded "><a href="content/oop-gobj/sect/gobj-macros.html"><strong aria-hidden="true">4.2.</strong> Macros de GObject</a></li><li class="chapter-item expanded "><a href="content/oop-gobj/sect/intfc.html"><strong aria-hidden="true">4.3.</strong> Interfaces</a></li><li class="chapter-item expanded "><a href="content/oop-gobj/ref-cnt/ref-cnt.html"><strong aria-hidden="true">4.4.</strong> Recuento de referencias</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/oop-gobj/ref-cnt/avoid-ref.html"><strong aria-hidden="true">4.4.1.</strong> Evitar ciclos de referencia con referencias d√©biles</a></li><li class="chapter-item expanded "><a href="content/oop-gobj/ref-cnt/float-ref.html"><strong aria-hidden="true">4.4.2.</strong> Referencias flotantes</a></li></ol></li><li class="chapter-item expanded "><a href="content/oop-gobj/sig-prop/sig-prop.html"><strong aria-hidden="true">4.5.</strong> Se√±ales y propiedades</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/oop-gobj/sig-prop/cnct-callb-sig.html"><strong aria-hidden="true">4.5.1.</strong> Conexi√≥n de una funci√≥n de devoluci√≥n de llamada a una se√±al</a></li><li class="chapter-item expanded "><a href="content/oop-gobj/sig-prop/disc-sig.html"><strong aria-hidden="true">4.5.2.</strong> Desconexi√≥n de controladores de se√±ales</a></li><li class="chapter-item expanded "><a href="content/oop-gobj/sig-prop/prop.html"><strong aria-hidden="true">4.5.3.</strong> Propiedades</a></li></ol></li></ol></li><li class="chapter-item expanded "><li class="part-title">GTK</li><li class="chapter-item expanded "><a href="content/gtk-app-arch/chpt/gtk-app-arch.html"><strong aria-hidden="true">5.</strong> Ejemplo de una arquitectura de c√≥digo de aplicaci√≥n GTK</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/gtk-app-arch/sect/main-func.html"><strong aria-hidden="true">5.1.</strong> La funci√≥n main() y GeditApp</a></li><li class="chapter-item expanded "><a href="content/gtk-app-arch/sect/geditwindow.html"><strong aria-hidden="true">5.2.</strong> GeditWindow</a></li><li class="chapter-item expanded "><a href="content/gtk-app-arch/sect/geditnotebook.html"><strong aria-hidden="true">5.3.</strong> GeditNotebook y lo que contiene</a></li><li class="chapter-item expanded "><a href="content/gtk-app-arch/sect/why-when-sub-class.html"><strong aria-hidden="true">5.4.</strong> ¬øPor qu√© y cu√°ndo crear subclases de widgets GTK?</a></li><li class="chapter-item expanded "><a href="content/gtk-app-arch/sect/comp-widg.html"><strong aria-hidden="true">5.5.</strong> Widgets compuestos</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Lectura adicional</li><li class="chapter-item expanded "><a href="content/fthr-rdg/chpt/fthr-rdg.html"><strong aria-hidden="true">6.</strong> Lecturas adicionales</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/fthr-rdg/sect/gtk-gio.html"><strong aria-hidden="true">6.1.</strong> GTK y GIO</a></li><li class="chapter-item expanded "><a href="content/fthr-rdg/sect/wrtg-gobj-class.html"><strong aria-hidden="true">6.2.</strong> Escribir sus propias clases de GObject</a></li><li class="chapter-item expanded "><a href="content/fthr-rdg/bld-sys/bld-sys.html"><strong aria-hidden="true">6.3.</strong> Sistema de compilaci√≥n</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="content/fthr-rdg/bld-sys/autotools.html"><strong aria-hidden="true">6.3.1.</strong> Las Autotools</a></li><li class="chapter-item expanded "><a href="content/fthr-rdg/bld-sys/meson.html"><strong aria-hidden="true">6.3.2.</strong> Meson</a></li></ol></li><li class="chapter-item expanded "><a href="content/fthr-rdg/sect/prog-prac.html"><strong aria-hidden="true">6.4.</strong> Mejores pr√°cticas de programaci√≥n</a></li><li class="spacer"></li></ol></li><li class="chapter-item expanded "><a href="content/book/struct/biblio.html">Bibliograf√≠a</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">La plataforma de desarrollo GLib/GTK</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/gersonbdev/glib-gtk-libro" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="la-plataforma-de-desarrollo-glibgtk"><a class="header" href="#la-plataforma-de-desarrollo-glibgtk">La plataforma de desarrollo GLib/GTK</a></h1>
<p><em>Por S√©bastien Wilmet y Gerson Benavides</em> <br></p>
<div class="caption">
<img src="https://gersonbdev.github.io/glib-gtk-libro/assets/img/logo-gtk.svg" alt="Logo de GTK" width="40%" />
</div>
<h2 id="prefacio"><a class="header" href="#prefacio">Prefacio</a></h2>
<p>Este texto es una gu√≠a de inicio para dar comienzo con la plataforma de desarrollo GLib/GTK, haciendo uso del lenguaje C. El libro nace en 2016 como un proyecto personal de <a href="https://louvilug.tuxfamily.org/swilmet/">S√©bastien Wilmetn</a>, el cual desarrolla hasta el a√±o 2019. El proyecto es luego retomado por <a href="https://gersonbdev.github.io/about/">Gerson Benavides</a> a partir del a√±o 2021.</p>
<p>En ocasiones se asumir√° que el lector usa un sistema similar a Unix, no obstante, la mayor parte de lo escrito en este libro es aplicable a otros sistemas operativos.</p>
<p>Tenga en cuenta que este libro est√° lejos de estar terminado, en este momento esta leyendo <code>versi√≥n 0.9 alpha</code>. Si tiene alg√∫n comentario, no dude en ponerse en contacto escribiendo a <a href="mailto:gersonbdev@gmail.com">gersonbdev@gmail.com</a>.</p>
<h2 id="enlaces"><a class="header" href="#enlaces">Enlaces</a></h2>
<p>El c√≥digo fuente y los diferentes formatos del libro se pueden encontrar en los siguientes enlaces:</p>
<table><thead><tr><th>Idioma</th><th>Formato</th></tr></thead><tbody>
<tr><td>ES</td><td><a href="https://gersonbdev.github.io/glib-gtk-libro/">Web</a></td></tr>
<tr><td></td><td><a href="https://raw.githubusercontent.com/gersonbdev/glib-gtk-libro/master/glib-gtk-libro.pdf">PDF</a></td></tr>
<tr><td></td><td><a href="https://github.com/gersonbdev/glib-gtk-libro">Repositorio</a></td></tr>
<tr><td>EN</td><td><a href="https://people.gnome.org/%7Eswilmet/glib-gtk-book/">Web</a></td></tr>
<tr><td></td><td><a href="https://people.gnome.org/%7Eswilmet/glib-gtk-dev-platform.pdf">PDF</a></td></tr>
<tr><td></td><td><a href="https://github.com/swilmet/glib-gtk-book">Repositorio</a></td></tr>
</tbody></table>
<h2 id="contribuci√≥n"><a class="header" href="#contribuci√≥n">Contribuci√≥n</a></h2>
<p>Si desea contribuir con el desarrollo de este libro puede apoyar con:</p>
<ul>
<li>
<p><strong>Soporte en redacci√≥n</strong>: Escribiendo o revisando el texto, para hacerlo participe en el repositorio del libro (<a href="https://github.com/gersonbdev/glib-gtk-libro">https://github.com/gersonbdev/glib-gtk-libro</a>) dando su opini√≥n o desarrollando las tareas propuestas (revise el archivo TODO).</p>
</li>
<li>
<p><strong>Soporte financiero</strong>: El libro se publica como un documento <em>libre</em> y es gratuito. Pero no se materializa en un espacio vac√≠o, se necesita tiempo para escribir. Al donar, demuestra su aprecio por este trabajo y ayuda a su desarrollo futuro. Puede encontrar un bot√≥n de donaci√≥n en <a href="https://gersonbdev.github.io/about/">https://gersonbdev.github.io/about/</a>.</p>
</li>
</ul>
<p>¬°Gracias!</p>
<h2 id="agradecimientos"><a class="header" href="#agradecimientos">Agradecimientos</a></h2>
<p>Se agradece los aportes de Christian Stadelmann, Errol van de l‚ÄôIsle, Andrew Colin Kissa y Link
Dupont.</p>
<p><a id="title-lic"></a></p>
<h2 id="licencia"><a class="header" href="#licencia">Licencia</a></h2>
<div class="caption">
<img src="https://gersonbdev.github.io/glib-gtk-libro/assets/img/license-cc-by-sa-88x31.png" alt="License CC BY-SA" width="88px" />
</div>
<p>Este trabajo est√° autorizado bajo una licencia internacional Creative Commons Attribution-ShareAlike 4.0:</p>
<p><a href="https://creativecommons.org/licenses/by-sa/4.0/">https://creativecommons.org/licenses/by-sa/4.0/</a></p>
<p>Algunas secciones est√°n basadas en el libro <em>GTK+/Gnome Application Development</em>, escrito en 1999, editado por New Riders Publishing y con licencia de Open Publication License. La √∫ltima versi√≥n de la licencia de publicaci√≥n abierta se puede encontrar en:</p>
<p><a href="http://www.opencontent.org/openpub/">http://www.opencontent.org/openpub/</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="introducci√≥n"><a class="header" href="#introducci√≥n">Introducci√≥n</a></h1>
<p>Este texto es una gu√≠a para comenzar con la plataforma de desarrollo GLib/GTK, haciendo uso del lenguaje C. En ocasiones se asumir√° que el lector usa un sistema similar a Unix.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="qu√©-es-glib-y-gtk"><a class="header" href="#qu√©-es-glib-y-gtk">¬øQu√© es GLib y GTK?</a></h1>
<p>En t√©rminos generales, GLib es un conjunto de bibliotecas: GLib core, GObject y GIO. Esas tres bibliotecas se desarrollan en el mismo repositorio de Git llamado <em>glib</em>, por lo que cuando se hace referencia a &quot;GLib&quot;, puede significar &quot;GLib core&quot; o el conjunto m√°s amplio que incluye tambi√©n GObject y GIO.</p>
<p>GLib core proporciona manejo de estructura de datos para C (listas enlazadas, √°rboles, tablas hash, ...), envoltorios de portabilidad, un bucle de eventos, hilos, carga din√°mica de m√≥dulos y muchas funciones de utilidad.</p>
<p>GObject -- que depende del n√∫cleo GLib -- simplifica la programaci√≥n orientada a objetos y los paradigmas de programaci√≥n dirigida por eventos en C. La programaci√≥n dirigida por eventos no solo es √∫til para interfaces gr√°ficas de usuario (con eventos de usuario como pulsaciones de teclas y clics del mouse), pero tambi√©n para daemons que responden a cambios de hardware (una memoria USB insertada, un segundo monitor conectado, una impresora con poco papel), o software que escucha conexiones de red o mensajes de otros procesos, etc.</p>
<p>GIO -- que depende de GLib core y GObject -- proporciona API de alto nivel para entrada/salida: lectura de un archivo local, un archivo remoto, un flujo de red, comunicaci√≥n entre procesos con D-Bus y muchos m√°s.</p>
<p><a id="fig-glib-struct-001"></a></p>
<div class="caption">
<img src="content/intro/sect/../../../assets/img/diag/glib-struct-001.svg" alt="Estructura de la biblioteca GLib." width="32%" />
<p><span class="fig-glib-struct-001">Figura</span>: Estructura de la biblioteca GLib.</p>
</div>
<p>Las bibliotecas GLib se pueden utilizar para escribir servicios del sistema operativo, bibliotecas, utilidades de l√≠nea de comandos y dem√°s. GLib ofrece API de mayor nivel que el est√°ndar POSIX; por lo tanto, es m√°s c√≥modo escribir un programa en C con GLib.</p>
<p>GTK es un conjunto de herramientas de widgets basado en GLib que se puede utilizar para desarrollar aplicaciones con una interfaz gr√°fica de usuario (GUI). Un ‚Äúwidget‚Äù es un elemento de la GUI, por ejemplo, un bot√≥n, un texto, un men√∫, etc. Y hay algunos tipos especiales de widgets que se denominan ‚Äúcontainers‚Äù, que pueden contener otros widgets, para ensamblar los elementos en una ventana. GTK proporciona una amplia gama de widgets y contenedores.</p>
<p>La primera versi√≥n de GTK, o GIMP Tool Kit, fue escrita principalmente por Peter Mattis, con la ayuda de Spencer Kimball y Josh MacDonald en 1996 para GIMP (programa de manipulaci√≥n de im√°genes GNU) mientras trabajaban en el eXperimental Computing Facility de la Universidad de California, Berkeley, convirti√©ndose r√°pidamente en una biblioteca de uso general. Una vez el proyecto se movi√≥ fuera del √°rbol de fuentes de GIMP para distinguir entre la versi√≥n original y una nueva versi√≥n que agreg√≥ caracter√≠sticas orientadas a objetos se agrego al nombre un &quot;+&quot; denomin√°ndose la biblioteca como GTK+ (actualmente este nombre esta en desuso y se conoce simplemente como GTK). GLib comenz√≥ como parte de GTK, pero ahora es una biblioteca independiente.</p>
<blockquote>
<p><strong>üìå Nota:</strong> El nombre &quot;The GIMP Tool Kit&quot; ahora rara vez se usa, hoy se conoce m√°s com√∫nmente como GTK para abreviar.</p>
</blockquote>
<p>Las API GLib y GTK est√°n documentadas con GTK-Doc. Los comentarios especiales est√°n escritos en el c√≥digo fuente y GTK-Doc extrae esos comentarios para generar p√°ginas HTML.</p>
<p>Aunque GLib y GTK est√°n escritos en C, los enlaces de lenguaje est√°n disponibles para JavaScript, Python, Perl y muchos otros lenguajes de programaci√≥n. Al principio, se crearon enlaces manuales, que deb√≠an actualizarse cada vez que cambiaba la API de la biblioteca. Hoy en d√≠a, los enlaces de lenguaje son gen√©ricos y, por lo tanto, se actualizan autom√°ticamente cuando, por ejemplo, se agregan nuevas funciones, esto es gracias a GObject Introspection. Se agregan anotaciones especiales a los comentarios de GTK-Doc, para exponer m√°s informaci√≥n de la que puede proporcionar la sintaxis de C, por ejemplo, sobre la transferencia de propiedad de contenido asignado din√°micamente.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Por ejemplo, si necesita liberar el valor de retorno.</p>
</blockquote>
<p>Adem√°s, las anotaciones tambi√©n son √∫tiles para el programador en C porque es una forma buena y concisa de documentar ciertos aspectos recurrentes de la API.</p>
<p>En el momento de escribir este art√≠culo, hay nuevas versiones estables de GLib y GTK cada seis meses, alrededor de marzo y septiembre. Un n√∫mero de versi√≥n tiene la forma &quot;<code>major.minor.micro</code>&quot;, donde &quot;<code>minor</code>&quot; designa ciclos estables si es par y ciclos de desarrollo (versiones inestables) si es impar. Por ejemplo, las versiones 4.4.* son estables, pero las versiones 4.5.* son inestables. Una nueva versi√≥n &quot;<code>micro</code>&quot; estable (por ejemplo, 4.4.0 ‚Üí 4.4.1) no agrega nuevas funciones, solo actualizaciones de traducci√≥n, correcci√≥n de errores y mejoras de rendimiento. Para una biblioteca, un nuevo n√∫mero de versi√≥n &quot;<code>major</code>&quot; generalmente significa que ha habido una ruptura de la API, pero afortunadamente las versiones principales anteriores se pueden instalar en paralelo con la nueva versi√≥n. Durante un ciclo de desarrollo (por ejemplo, 4.5), no hay garant√≠as de estabilidad en la API para <em>nuevas</em> funciones; pero al ser uno de los primeros en adoptarlo, sus comentarios son √∫tiles para descubrir m√°s r√°pidamente fallas y errores de dise√±o.</p>
<p>GLib y GTK son parte del Proyecto GNU, cuyo objetivo general es desarrollar un sistema operativo libre (llamado GNU) m√°s aplicaciones que lo acompa√±en. GNU significa ‚ÄúGNU‚Äôs Not Unix‚Äù, una forma divertida de decir que el sistema operativo GNU es compatible con Unix. Puede obtener m√°s informaci√≥n sobre GNU en <a href="https://www.gnu.org">https://www.gnu.org</a>.</p>
<p>El sitio web de GLib/GTK es: <a href="http://www.gtk.org">http://www.gtk.org</a></p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="intro-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="el-escritorio-gnome"><a class="header" href="#el-escritorio-gnome">El escritorio GNOME</a></h1>
<p>Un proyecto importante para GLib y GTK es GNOME. GNOME, que tambi√©n forma parte de GNU, es un entorno de escritorio libre iniciado en 1997 por Miguel de Icaza y Federico Mena-Quintero. GNOME hace un uso extensivo de GTK, y este √∫ltimo ahora es desarrollado principalmente por desarrolladores de GNOME.</p>
<p>&quot;GNOME&quot; es en realidad un acr√≥nimo: GNU Network Object Model Environment.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Como con GTK, el nombre completo de GNOME rara vez se usa y no refleja la realidad actual.</p>
</blockquote>
<p>Originalmente, el proyecto ten√≠a la intenci√≥n de crear un marco para objetos de aplicaci√≥n, similar a las tecnolog√≠as OLE y COM de Microsoft. Sin embargo, el alcance del proyecto se expandi√≥ r√°pidamente; qued√≥ claro se requer√≠a un trabajo preliminar sustancial antes de que la parte del nombre de &quot;network object&quot; pudiera convertirse en realidad. Las versiones antiguas de GNOME inclu√≠an una arquitectura de incrustaci√≥n de objetos llamada Bonobo, y GNOME 1.0 inclu√≠a un ORB CORBA r√°pido y ligero llamado ORBit. Bonobo ha sido reemplazado por D-Bus un sistema de comunicaci√≥n entre procesos.</p>
<p>GNOME tiene dos caras importantes. Desde la perspectiva del usuario, es un entorno de escritorio integrado y una suite de aplicaciones. Desde la perspectiva del programador, es un marco de desarrollo de aplicaciones (compuesto por numerosas bibliotecas √∫tiles que se basan en GLib y GTK). Las aplicaciones
escritas con las bibliotecas de GNOME funcionan bien incluso si el usuario no est√° ejecutando el entorno de escritorio, pero se integran bien con el escritorio de GNOME si est√° disponible.</p>
<p>El entorno de escritorio incluye un &quot;shell&quot; para cambiar de tareas y ejecutar programas, un &quot;centro de control&quot; para la configuraci√≥n, muchas aplicaciones como un administrador de archivos, un navegador web, un reproductor de pel√≠culas, etc. Estos programas ocultan la l√≠nea de comandos tradicional de Unix detr√°s de una interfaz gr√°fica f√°cil de usar.</p>
<p>El marco de desarrollo de GNOME permite escribir aplicaciones interoperables, coherentes y f√°ciles de usar. Los dise√±adores de sistemas de ventanas como X11 o Wayland tomaron la decisi√≥n deliberada de no imponer ninguna pol√≠tica de interfaz de usuario a los desarrolladores; GNOME agrega una &quot;capa de pol√≠tica&quot;, creando una apariencia coherente. Las aplicaciones GNOME terminadas funcionan bien con el escritorio GNOME, pero tambi√©n se pueden usar de forma &quot;independiente&quot; -- los usuarios solo necesitan instalar las bibliotecas compartidas de GNOME. Una aplicaci√≥n GNOME no est√° vinculada a un sistema de ventanas espec√≠fico, GTK proporciona backends para X Window System, Wayland, Mac OS X, Windows e incluso para un navegador web.</p>
<p>Los componentes de GNOME deben instalarse con las mismas versiones, junto con la versi√≥n de GTK y GLib lanzada al mismo tiempo; por ejemplo, es una mala idea ejecutar un demonio GNOME en la versi√≥n 41 con el centro de control en la versi√≥n 40. En el momento de escribir este art√≠culo, las √∫ltimas versiones estables son: GLib 2.70, GTK 4.4 y GNOME 41, todas lanzadas en el segundo semestre de 2021.</p>
<p>M√°s informaci√≥n sobre GNOME: <a href="https://www.gnome.org/">https://www.gnome.org/</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prerrequisitos"><a class="header" href="#prerrequisitos">Prerrequisitos</a></h1>
<p>Este libro asume que ya tiene algo de pr√°ctica en programaci√≥n. A continuaci√≥n, se muestra una lista de requisitos previos recomendados, con referencias de libros.</p>
<ul>
<li>
<p>Este texto supone que ya conoce el lenguaje C. El libro de referencia es <em><strong>The C Programming Language</strong></em>, de Brian Kernighan y Dennis Ritchie <span class="k-r-book"></span>.</p>
</li>
<li>
<p>La programaci√≥n orientada a objetos (OOP) tambi√©n es necesaria para aprender GObject. Debe estar familiarizado con conceptos como herencia, una interfaz, un m√©todo virtual o polimorfismo. Un buen libro, con m√°s de sesenta pautas, es <em><strong>Object-Oriented Design Heuristics</strong></em>, de Arthur Riel <span class="oop-book"></span>.</p>
</li>
<li>
<p>Es √∫til haber le√≠do un libro sobre estructuras de datos y algoritmos, pero puede aprenderlo en paralelo. Un libro recomendado es <em><strong>The Algorithm Design Manual</strong></em>, de Steven Skiena <span class="algo-book"></span>.</p>
</li>
<li>
<p>Si desea desarrollar su software en un sistema similar a Unix, otro requisito previo es saber c√≥mo funciona Unix y estar familiarizado con la l√≠nea de comandos, un poco de scripts de shell y c√≥mo escribir un Makefile. Un posible libro es <em><strong>UNIX for the Impatient</strong></em>, de Paul Abrahams <span class="unix-impatient"></span>.</p>
</li>
<li>
<p>No es estrictamente necesario, pero se recomienda encarecidamente utilizar un sistema de control de versiones como Git. Un buen libro es <em><strong>Pro Git</strong></em>, de Scott Chacon <span class="pro-git"></span>.</p>
</li>
</ul>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="biblio-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="por-qu√©-y-cu√°ndo-se-usa-el-lenguaje-c"><a class="header" href="#por-qu√©-y-cu√°ndo-se-usa-el-lenguaje-c">¬øPor qu√© y cu√°ndo se usa el lenguaje C?</a></h1>
<p>Las bibliotecas GLib y GTK pueden ser utilizadas por otros lenguajes de programaci√≥n adem√°s de C. Gracias a GObject Introspection, los enlaces autom√°ticos est√°n disponibles para una gran variedad de lenguajes, de manera que puedan ser usadas todas las bibliotecas basadas en GObject por estos. Los enlaces oficiales de GNOME est√°n disponibles para los siguientes lenguajes:</p>
<table><thead><tr><th>Lenguaje</th><th>v3</th><th>v4</th></tr></thead><tbody>
<tr><td><a href="https://www.gtkmm.org/" title="gtkmm">C++</a></td><td>‚òë</td><td>‚òë</td></tr>
<tr><td><a href="https://gjs.guide/" title="GJS">JavaScript</a></td><td>‚òë</td><td>‚òë</td></tr>
<tr><td><a href="https://pygobject.readthedocs.io/" title="PyGObject">Python</a></td><td>‚òë</td><td>‚òë</td></tr>
<tr><td><a href="https://gtk-rs.org/" title="gtk-rs">Rust</a></td><td>‚òë</td><td>‚òë</td></tr>
<tr><td><a href="https://valadoc.org/" title="Vala">Vala</a></td><td>‚òë</td><td>‚òë</td></tr>
</tbody></table>
<blockquote>
<p><strong>üìå Nota:</strong> Aunque existen enlaces a m√°s lenguajes, los expresados en la tabla son los m√°s activos es sus repositorios y con una mayor comunidad.</p>
</blockquote>
<p>Una buena alternativa es Vala, el cual es un nuevo lenguaje de programaci√≥n que integra las peculiaridades de GObject directamente en su sintaxis similar a C#. De manera que todo el c√≥digo hecho en Vala es traducido a c√≥digo en C, el cual hace uso de GObject directamente, esto puede resultar √∫til si desea c√≥digo cercano a C pero haciendo uso de un lenguaje m√°s moderno.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Tenga en cuenta que el lenguaje Vala podr√≠a considerarse un lenguaje de nicho, teniendo una comunidad peque√±a si es comparado con lenguajes m√°s populares.</p>
</blockquote>
<p>M√°s all√° de los enlaces oficiales de GNOME, GLib y GTK se pueden usar en m√°s de una docena de lenguajes de programaci√≥n, con un nivel de soporte variable. Entonces, <em>¬øpor qu√© y cu√°ndo elegir el lenguaje C?</em>.</p>
<p>Por ejemplo, para escribir un daemon en un sistema tipo Unix, C es el idioma <em>predeterminado</em>. Pero es menos obvio que lenguaje usar para una aplicaci√≥n. Para responder a la pregunta, veamos primero c√≥mo estructurar el c√≥digo base de una aplicaci√≥n.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="separaci√≥n-de-backend-del-frontend"><a class="header" href="#separaci√≥n-de-backend-del-frontend">Separaci√≥n de backend del frontend</a></h1>
<p>Una buena pr√°ctica es separar la interfaz gr√°fica de usuario del resto de la aplicaci√≥n. Por diversas razones, la interfaz gr√°fica de una aplicaci√≥n tiende a ser una pieza de software excepcionalmente vol√°til y en constante cambio. Es el foco de la mayor√≠a de las solicitudes de cambio de los usuarios. Es dif√≠cil planificar y ejecutar bien la primera vez; a menudo descubrir√° que alg√∫n aspecto es desagradable de usar solo despu√©s de haberlo escrito. A veces es deseable tener varias interfaces de usuario diferentes, por ejemplo, una versi√≥n de l√≠nea de comandos o una interfaz basada en web.</p>
<p>En t√©rminos pr√°cticos, esto significa que cualquier aplicaci√≥n grande debe tener una separaci√≥n radical entre sus diversos <em>frontends</em> o interfaces y el <em>backend</em>. El backend debe contener todas las &quot;partes complejas&quot;: sus algoritmos y estructuras de datos, el trabajo real realizado por la aplicaci√≥n. Piense en ello como un &quot;modelo&quot; abstracto que se muestra y manipula el usuario.</p>
<p>Cada interfaz debe ser una &quot;vista&quot; y un &quot;controlador&quot;. Como una &quot;vista&quot;, la interfaz debe anotar cualquier cambio en el backend y cambiar la pantalla en consecuencia. Como un &quot;controlador&quot;, la interfaz debe permitir al usuario transmitir solicitudes de cambio al backend (define c√≥mo las manipulaciones de la interfaz se traducen en cambios en el modelo).</p>
<p>Hay muchas formas de disciplinarse para mantener su aplicaci√≥n separada. Un par de ideas √∫tiles:</p>
<ul>
<li>Escriba el backend como una biblioteca. Al principio, la biblioteca puede ser interna a la aplicaci√≥n y estar vinculada est√°ticamente, sin garant√≠as de estabilidad API/ABI. Cuando el proyecto crezca, y si el c√≥digo es √∫til para otros programas, puede convertir f√°cilmente su backend en una biblioteca compartida.</li>
<li>Escriba al menos dos interfaces desde el principio; uno o ambos pueden ser prototipos feos, solo desea tener una idea de c√≥mo estructurar el backend. Recuerde, las interfaces deben ser f√°ciles; el backend tiene las partes dif√≠ciles.</li>
</ul>
<p>El lenguaje C es una buena opci√≥n para la parte de backend de una aplicaci√≥n. Al utilizar GObject y GObject Introspection, su biblioteca estar√° disponible para otros proyectos escritos en varios lenguajes de programaci√≥n. Por otro lado, una biblioteca de Python o JavaScript no se puede utilizar en otros lenguajes. Para las interfaces, un idioma de nivel superior puede ser m√°s conveniente, dependiendo de los idiomas con los que ya domine.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otros-aspectos-a-tener-en-cuenta"><a class="header" href="#otros-aspectos-a-tener-en-cuenta">Otros aspectos a tener en cuenta</a></h1>
<p>Si tiene dudas sobre el lenguaje a elegir, aqu√≠ hay otros aspectos a tener en cuenta. Tenga en cuenta que este texto est√° un poco sesgado ya que se eligi√≥ el lenguaje C.</p>
<p>C es un lenguaje de tipo est√°tico: los tipos de variables y los prototipos de funciones en un programa se conocen en el momento de la compilaci√≥n. El compilador descubre muchos errores triviales, como un error tipogr√°fico en el nombre de una funci√≥n. El compilador tambi√©n es de gran ayuda cuando se hacen refactorizaciones de c√≥digo, lo cual es esencial para el mantenimiento a largo plazo de un programa. Por ejemplo, cuando divide una clase en dos, si el c√≥digo que usa la clase inicial no se actualiza correctamente, el compilador se lo informar√° amablemente.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Bueno, amablemente quiz√°s no sea la mejor descripci√≥n, arrojar un mont√≥n de errores est√° m√°s cerca de la realidad.</p>
</blockquote>
<p>Con el desarrollo basado en pruebas (TDD), y escribiendo pruebas unitarias para <em>todo</em>, tambi√©n es factible escribir una enorme base de c√≥digo en un lenguaje de tipo din√°mico como Python. Con una muy buena cobertura de c√≥digo, las pruebas unitarias tambi√©n detectar√°n errores al refactorizar el c√≥digo. Pero las pruebas unitarias pueden ser mucho m√°s lentas de ejecutar que compilar el c√≥digo, ya que tambi√©n prueba el comportamiento del programa. Por lo tanto, puede que no sea conveniente ejecutar todas las pruebas unitarias al realizar refactorizaciones de c√≥digo. ¬°Por supuesto, escribir pruebas unitarias tambi√©n es una buena pr√°ctica para una base de c√≥digo C! Sin embargo, para la parte GUI del c√≥digo, escribir pruebas unitarias a menudo no es una tarea de alta prioridad si la aplicaci√≥n est√° bien probada por sus desarrolladores.</p>
<p>C es un lenguaje escrito expl√≠citamente: los tipos de variables son visibles en el c√≥digo. Es una forma de auto-documentar el c√≥digo; por lo general, no es necesario agregar comentarios para explicar qu√© contienen las variables. Conocer el tipo de variable es importante para comprender el c√≥digo, saber qu√© representa la variable y qu√© funciones se pueden llamar sobre ella. En un asunto relacionado, el objeto <em>self</em> se pasa expl√≠citamente como un argumento de funci√≥n. Por lo tanto, cuando se accede a un atributo a trav√©s del puntero <em>self</em>, se sabe de d√≥nde procede el atributo. Algunos lenguajes orientados a objetos tienen <em>esta</em> palabra clave para ese prop√≥sito, pero a veces es opcional como en C ++ o Java. En este √∫ltimo caso, una funci√≥n √∫til del editor de texto es resaltar atributos de manera diferente, por lo que incluso cuando no se usa <em>esta</em> palabra clave, usted sabe que es un atributo y no una variable local. Con el objeto <em>self</em> pasado como argumento, no hay posibles confusiones.</p>
<p>El lenguaje C tiene una <em>cadena de herramientas</em> muy buena: compiladores estables (GCC, Clang,...), Editores de texto (Vim, Emacs,...), Depuradores (GDB, Valgrind,...), Herramientas de an√°lisis est√°tico, ...</p>
<p>Para algunos programas, un recolector de basura no es apropiado porque pausa el programa regularmente para liberar la memoria no utilizada. Para secciones de c√≥digo cr√≠ticas, como animaciones en tiempo real, no es conveniente pausar el programa (un recolector de basura a veces puede ejecutarse durante varios segundos). En este caso, la gesti√≥n manual de la memoria como en C es una soluci√≥n.</p>
<p>Menos importante, pero √∫til; la verbosidad de C en combinaci√≥n con las convenciones GLib/GTK tiene una ventaja: el c√≥digo se puede buscar f√°cilmente con un comando como <code>grep</code>. Por ejemplo, la funci√≥n <code>gtk_widget_show()</code> contiene el espacio de nombres (<code>gtk</code>), la clase (<code>widget</code>) y el m√©todo (<code>show</code>). Con un lenguaje orientado a objetos, la sintaxis es generalmente <code>object.show()</code>. Si se busca &quot;show&quot; en el c√≥digo, probablemente habr√° m√°s falsos positivos, por lo que se necesita una herramienta m√°s inteligente. Otra ventaja es que conocer el espacio de nombres y la clase de un m√©todo puede ser √∫til al leer el c√≥digo, es otra forma de auto-documentaci√≥n.</p>
<p>M√°s importante a√∫n, la documentaci√≥n de la API GLib/GTK est√° escrita principalmente para el lenguaje C. No es conveniente leer la documentaci√≥n de C mientras se programa en otro idioma. Algunas herramientas est√°n actualmente en desarrollo para generar la documentaci√≥n de la API para otros lenguajes de destino, por lo que es de esperar que en el futuro ya no sea un problema.</p>
<p>GLib/GTK est√°n escritos en C. Entonces, cuando se programa en C, no hay capa adicional. Una capa adicional es potencialmente una fuente de errores adicionales y cargas de mantenimiento. Adem√°s, usar el lenguaje C probablemente
sea mejor para prop√≥sitos pedag√≥gicos. Un lenguaje de nivel superior puede ocultar algunos detalles sobre GLib/GTK. Por lo tanto, el c√≥digo es m√°s corto, pero cuando tiene un problema, debe comprender no solo c√≥mo funciona la funci√≥n de la biblioteca, sino tambi√©n c√≥mo funciona el enlace del idioma.</p>
<p>Dicho esto, si:</p>
<ul>
<li>No se siente c√≥modo en C.</li>
<li>Ya domina un lenguaje de nivel superior con compatibilidad con GObject Introspection.</li>
<li>Planea escribir solo una peque√±a aplicaci√≥n o complemento.</li>
</ul>
<p>Elegir un lenguaje de nivel superior tiene mucho sentido.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="ruta-de-aprendizaje"><a class="header" href="#ruta-de-aprendizaje">Ruta de aprendizaje</a></h1>
<p>Normalmente, esta secci√≥n deber√≠a llamarse &quot;Estructura del libro&quot;, pero como puede ver, el libro est√° lejos de estar terminado, por lo que la secci√≥n se llama &quot;Ruta de aprendizaje&quot;.</p>
<p>El camino de aprendizaje l√≥gico es:</p>
<ol>
<li>Los fundamentos del n√∫cleo GLib;</li>
<li>Programaci√≥n orientada a objetos en C y los conceptos b√°sicos de GObject;</li>
<li>GTK y GIO en paralelo.</li>
</ol>
<p>Dado que GTK se basa en GLib y GObject, es mejor comprender primero los conceptos b√°sicos de esas dos bibliotecas. Algunos tutoriales se sumergen directamente en GTK, por lo que despu√©s de un corto per√≠odo de tiempo puede mostrar una ventana con texto y tres botones; es divertido, pero conocer GLib y GObject no es un lujo si quiere comprender lo que est√° haciendo, y una aplicaci√≥n GTK realista utiliza ampliamente las bibliotecas GLib. GTK y GIO se pueden aprender en paralelo --- una vez que comience a usar GTK, ver√° que algunas partes que no son GUI est√°n basadas en GIO.</p>
<p>As√≠ que este libro comienza con la biblioteca principal GLib, luego presenta la Programaci√≥n Orientada a Objetos en C seguida de un cap√≠tulo de Lecturas Adicionales.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="el-entorno-de-desarrollo"><a class="header" href="#el-entorno-de-desarrollo">El entorno de desarrollo</a></h1>
<p>Esta secci√≥n describe el entorno de desarrollo que se usa normalmente al programar con GLib y GTK en un sistema tipo Unix.</p>
<p>En una distribuci√≥n GNU/Linux, a menudo se puede instalar un solo paquete o grupo para obtener un entorno de desarrollo C completo, que incluye, entre otros:</p>
<ul>
<li>Un compilador compatible con C89, GCC por ejemplo.</li>
<li>El depurador GNU GDB.</li>
<li>GNU Make.</li>
<li>Las Autotools (Autoconf, Automake y Libtool).</li>
<li>Las p√°ginas del manual de:
<ul>
<li>El kernel de Linux.</li>
<li>glibc.</li>
</ul>
</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> No confundir la biblioteca GNU C (glibc) con GLib. La primera es de nivel inferior.</p>
</blockquote>
<p>Para utilizar GLib y GTK como desarrollador, existen varias soluciones:</p>
<ul>
<li>
<p>Los encabezados y la documentaci√≥n se pueden instalar con el administrador de paquetes. El nombre de los paquetes suele terminar con uno de los siguientes sufijos: <code>-devel</code>, <code>-dev</code> o <code>-doc</code>. Por ejemplo <code>glib2-devel</code> y <code>glib2-doc</code> en Fedora.</p>
</li>
<li>
<p>Si desea construir por usted mismo la √∫ltimas versiones de GLib y GTK lo puede hacer con Meson, para mas informaci√≥n se puede dirigir a: <a href="https://docs.gtk.org/gtk4/building.html">https://docs.gtk.org/gtk4/building.html</a></p>
</li>
</ul>
<p>Para leer la documentaci√≥n de la API de GLib y GTK, Devhelp es una aplicaci√≥n √∫til, si ha instalado el paquete -dev o -doc. Por otro lado para el editor de texto o IDE, hay muchas opciones (y con ellas una fuente de muchos trolls), como por ejemplo: Vim/Neovim, Emacs, gedit, Anjuta, MonoDevelop/Xamarin Studio, Geany, entre muchos otras. Un prometedor IDE especializado para GNOME es Builder, el cual de manera nativa posee integraci√≥n con GLib/GTK y con su documentaci√≥n, adem√°s de ofrecer integraci√≥n con Git.</p>
<p>Para crear una <em>interfaz gr√°fica de usuario</em> o GUI con GTK, puede escribir directamente el c√≥digo para hacerla o puede usar Glade para dise√±ar la GUI gr√°ficamente. Finalmente, GTK-Doc se usa para escribir documentaci√≥n de API y agregar las anotaciones de GObject Introspection.</p>
<p>Cuando utilice GLib o GTK, preste atenci√≥n a no utilizar API obsoletas para el c√≥digo reci√©n escrito. Aseg√∫rese de leer la documentaci√≥n m√°s reciente, la cual esta disponible en l√≠nea en:</p>
<p><a href="https://developer.gnome.org/">https://developer.gnome.org/</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="instalaci√≥n"><a class="header" href="#instalaci√≥n">Instalaci√≥n</a></h1>
<p>Esta secci√≥n presenta un ejemplo recomendado de entorno de desarrollo y su instalaci√≥n. Tenga en cuenta que como se explica en la secci√≥n <span class="ch-intro-dev-env"></span> existen m√∫ltiples alternativas a los paquetes aqu√≠ propuestos que usted puede usar para el desarrollo (por ejemplo, el editor de texto o IDE).</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="linux"><a class="header" href="#linux">Linux</a></h1>
<p>Por la gran cantidad de distribuciones que posee GNU/Linux, explicar el proceso de instalaci√≥n en todas se sale de los alcances de este texto, aun as√≠ tenga en cuenta que el nombre de los paquetes y el m√©todo de instalaci√≥n tiende a ser parecido en cada una de ellas.</p>
<h2 id="compilador-y-utilidades"><a class="header" href="#compilador-y-utilidades">Compilador y utilidades</a></h2>
<ul>
<li><strong>Fedora</strong></li>
</ul>
<pre><code class="language-console">$ sudo dnf groupinstall &quot;Development Tools&quot;
</code></pre>
<ul>
<li><strong>Ubuntu</strong></li>
</ul>
<pre><code class="language-console">$ sudo apt install build-essential
</code></pre>
<h2 id="gtkglib"><a class="header" href="#gtkglib">GTK/GLib</a></h2>
<ul>
<li><strong>Fedora</strong></li>
</ul>
<pre><code class="language-console">$ sudo dnf install glib2-devel gtk4 gtk4-devel
</code></pre>
<ul>
<li><strong>Ubuntu</strong></li>
</ul>
<pre><code class="language-console">$ sudo apt install libglib2.0-dev libgtk-4-1 libgtk-4-dev
</code></pre>
<h2 id="flatpak"><a class="header" href="#flatpak">Flatpak</a></h2>
<p>Si desarrolla en Linux, hacer uso de Flatpak es la mejor opci√≥n, ya que su flujo de trabajo se ubicara en contenedores, incluidas todas las dependencias. Esto le permitir√° publicar su aplicaci√≥n en m√∫ltiples distribuciones con un solo paquete. Para verificar si Flatpak esta instalado en su sistema, escriba en una terminal:</p>
<pre><code class="language-console">$ flatpak --version
</code></pre>
<p>Si recibe como respuesta la versi√≥n de Flatpak ignore esta instalaci√≥n, de lo contrario puede consultar este sitio web para ver si es necesario realizar alg√∫n paso extra en su distribuci√≥n.</p>
<p><a href="https://flatpak.org/setup/">https://flatpak.org/setup/</a></p>
<h2 id="editor-de-texto-o-ide"><a class="header" href="#editor-de-texto-o-ide">Editor de texto o IDE</a></h2>
<p>Si no esta familiarizado con editores como Vim/Neovim o Emacs puede ser una buena idea iniciar con los siguientes editores:</p>
<h3 id="gnome-builder"><a class="header" href="#gnome-builder">GNOME Builder</a></h3>
<p>El IDE de desarrollo de GNOME, le brindara algunas ventajas gracias a su integraci√≥n nativa al entorno de desarrollo de aplicaciones GTK/GLib, permiti√©ndole por ejemplo descargar las dependencias de compilaci√≥n con solo presionar ejecutar el proyecto. La instalaci√≥n la puede hacer escribiendo.</p>
<pre><code class="language-console">$ flatpak install flathub org.gnome.Builder
</code></pre>
<h3 id="visual-studio-code"><a class="header" href="#visual-studio-code">Visual Studio Code</a></h3>
<p>Quiz√°s el editor de texto mas popular para el momento de escribir este libro, desarrollado de la mano de Mirosoft. Posee m√∫ltiples extensiones que le permitir√°n trabajar con C f√°cilmente. La instalaci√≥n la puede hacer escribiendo.</p>
<pre><code class="language-console">$ flatpak install flathub com.visualstudio.code
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glib-la-biblioteca-principal"><a class="header" href="#glib-la-biblioteca-principal">GLib, la biblioteca principal</a></h1>
<p>GLib es la biblioteca central de bajo nivel que forma la base para proyectos como GTK y GNOME. Proporciona estructuras de datos, funciones de utilidad, envoltorios de portabilidad y otras funciones esenciales, como un bucle de eventos e hilos. GLib est√° disponible en la mayor√≠a de los sistemas similares a Unix y Windows.</p>
<p>Este cap√≠tulo cubre algunas de las funciones m√°s utilizadas. GLib es simple y los conceptos son familiares; as√≠ que nos moveremos r√°pidamente. Para obtener una cobertura m√°s completa de GLib, consulte la √∫ltima documentaci√≥n de la API que viene con la biblioteca (para el entorno de desarrollo, consulte la secci√≥n <span class="ch-intro-dev-env"></span>). Por cierto: si tiene preguntas muy espec√≠ficas sobre la implementaci√≥n, no tema mirar el c√≥digo fuente. Normalmente, la ocumentaci√≥n contiene suficiente informaci√≥n, pero si encuentra un detalle faltante, por favor presente un error (por supuesto, lo mejor ser√≠a con un parche proporcionado).</p>
<p>Las diversas instalaciones de GLib est√°n destinadas a tener una interfaz coherente; el estilo de codificaci√≥n est√° orientado a semiobjetos, y los identificadores tienen el prefijo &quot;g&quot; para crear una especie de espacio de nombres.</p>
<p>GLib tiene algunos encabezados de nivel superior:</p>
<ul>
<li><code>glib.h</code>, el encabezado principal.</li>
<li><code>gmodule.h</code> para carga din√°mica de m√≥dulos.</li>
<li><code>glib-unix.h</code> para API espec√≠ficas de Unix.</li>
<li><code>glib/gi18n.h</code> y <code>glib/gi18n-lib.h</code> para la internacionalizaci√≥n;</li>
<li><code>glib/gprintf.h</code> y <code>glib/gstdio.h</code> para evitar hacer uso de todo <code>stdio</code>.</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> En lugar de reinventar la rueda, este cap√≠tulo se basa en gran medida en el cap√≠tulo correspondiente del libro <em>GTK+/Gnome Application Development</em> de Havoc Pennington, con licencia de Open Publication License (consulte la secci√≥n <span class="ch-title-lic"></span>). GLib tiene una API muy estable. A pesar de que el libro de Havoc Pennington fue escrito en 1999 (para GLib 1.2), solo se requirieron algunas actualizaciones para adaptarse a las √∫ltimas versiones de GLib (versi√≥n 2.42 en el momento de escribir este art√≠culo).</p>
</blockquote>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lo-esencial"><a class="header" href="#lo-esencial">Lo esencial</a></h1>
<p>GLib proporciona sustitutos para muchas construcciones de lenguaje C est√°ndar y de uso com√∫n. Esta secci√≥n describe las definiciones de tipos fundamentales, macros, rutinas de asignaci√≥n de memoria y funciones de utilidad de cadena de GLib.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="definiciones-de-tipo"><a class="header" href="#definiciones-de-tipo">Definiciones de tipo</a></h1>
<p>En lugar de utilizar los tipos est√°ndar de C (<code>int</code>, <code>long</code> , etc.), GLib define los suyos propios. Estos sirven para una variedad de prop√≥sitos. Por ejemplo, se garantiza que <code>gint32</code> tiene 32 bits de ancho, algo que ning√∫n tipo C89 est√°ndar puede garantizar. <code>guint</code> es simplemente m√°s f√°cil de escribir que <code>unsigned</code> . Algunos de los typedefs existen solo por coherencia; por ejemplo, <code>gchar</code> siempre es equivalente al <code>char</code> est√°ndar.</p>
<p>Los tipos primitivos m√°s importantes definidos por GLib:</p>
<ul>
<li><code>gint8</code>, <code>guint8</code>, <code>gint16</code>, <code>guint16</code>, <code>gint32</code>, <code>guint32</code>, <code>gint64</code>, <code>guint64</code> --- le dar√° n√∫meros enteros de un tama√±o garantizado. (Si no es obvio, los tipos <code>guint</code> son <code>unsigned</code>, los tipos de <code>gint</code> son <code>signed</code>).</li>
<li><code>gboolean</code> es √∫til para hacer su c√≥digo m√°s legible, ya que C89 no tiene un tipo bool.</li>
<li><code>gchar</code>, <code>gshort</code>, <code>glong</code>, <code>gint</code>, <code>gfloat</code>, <code>gdouble</code> son puramente cosm√©ticos.</li>
<li><code>gpointer</code> puede ser m√°s conveniente de escribir que <code>void *</code>. <code>gconstpointer</code> le da <code>const void *</code>. (<code>const gpointer</code> no har√° lo que normalmente quiere; dedique un tiempo a leer un buen libro sobre C si no ve por qu√©).</li>
<li><code>gsize</code> es un tipo entero sin signo que puede contener el resultado del operador <code>sizeof</code>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macros-de-uso-frecuente"><a class="header" href="#macros-de-uso-frecuente">Macros de uso frecuente</a></h1>
<p>GLib define una serie de macros familiares que se utilizan en muchos programas C, que se muestran en el <span class="glib-simplemacros">Listado</span>. Todos estos deben ser autoexplicativos. <code>MIN()</code>/<code>MAX()</code> devuelven el menor o mayor de sus argumentos. <code>ABS()</code> devuelve el valor absoluto de su argumento. <code>CLAMP(x, low, high)</code> significa <code>x</code>, a menos que <code>x</code> est√© fuera del rango [<code>low</code>, <code>high</code>]; si <code>x</code> est√° por debajo del rango, se devuelve <code>low</code>; si x est√° por encima del rango, se devuelve <code>high</code>. Adem√°s de las macros que se muestran en el <span class="glib-simplemacros">Listado</span>, <code>TRUE</code>/<code>FALSE</code>/<code>NULL</code> se definen como los habituales <code>1</code>/<code>0</code>/<code>((void *)0)</code>.</p>
<p><a id="glib-simplemacros"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

MAX (a, b);
MIN (a, b);
ABS (x);
CLAMP (x, low, high);
</code></pre>
<div class="caption">
<p><span class="glib-simplemacros">Listado</span>: Macros C familiares.</p>
</div>
<p>Tambi√©n hay muchas macros exclusivas de GLib, como las conversiones port√°tiles <code>gpointer</code>-to-<code>gint</code> y <code>gpointer</code>-to-<code>guint</code> que se muestran en el <span class="glib-pointerint">Listado</span>.</p>
<p><a id="glib-pointerint"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

GINT_TO_POINTER (p);
GPOINTER_TO_INT (p);
GUINT_TO_POINTER (p);
GPOINTER_TO_UINT (p);
</code></pre>
<div class="caption">
<p><span class="glib-pointerint">Listado</span>: Macros para almacenar enteros en punteros.</p>
</div>
<p>La mayor√≠a de las estructuras de datos de GLib est√°n dise√±adas para almacenar un <code>gpointer</code>. Si desea almacenar punteros a objetos asignados din√°micamente, esto es lo correcto. Sin embargo, a veces desea almacenar una lista simple de n√∫meros enteros sin tener que asignarlos din√°micamente. Aunque el est√°ndar C no lo garantiza estrictamente, es posible almacenar un <code>gint</code> o <code>guint</code> en una variable <code>gpointer</code> en la amplia gama de plataformas a las que GLib ha sido portado; en algunos casos, se requiere un yeso intermedio. Las macros en el <span class="glib-pointerint">Listado</span> abstraen la presencia del elenco.</p>
<p>He aqu√≠ un ejemplo:</p>
<pre><code class="language-c">gint my_int;
gpointer my_pointer;

my_int = 5;
my_pointer = GINT_TO_POINTER (my_int);
printf (&quot;Estamos almacenando %d\n&quot;, GPOINTER_TO_INT (my_pointer));
</code></pre>
<p>Pero tenga cuidado; estas macros le permiten almacenar un entero en un puntero, pero almacenar un puntero en un entero <em>no</em> funcionar√°. Para hacerlo de forma port√°til, debe almacenar el puntero en un <code>long</code>. (Sin embargo, sin duda es una mala idea hacerlo).</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="macros-de-depuraci√≥n"><a class="header" href="#macros-de-depuraci√≥n">Macros de depuraci√≥n</a></h1>
<p>GLib tiene un buen conjunto de macros que puede usar para hacer cumplir invariantes y condiciones previas en su c√≥digo. GTK los usa generosamente, una de las razones por las que es tan estable y f√°cil de usar. Todos desaparecen cuando define <code>G_DISABLE_CHECKS</code> o <code>G_DISABLE_ASSERT</code>, por lo que no hay penalizaci√≥n de rendimiento en el c√≥digo de producci√≥n. Usarlos generosamente es una muy, muy buena idea. Encontrar√° errores mucho m√°s r√°pido si lo hace. Incluso puede agregar afirmaciones y verificaciones cada vez que encuentre un error para asegurarse de que el error no vuelva a aparecer en versiones futuras; esto complementa un conjunto de regresi√≥n. Las comprobaciones son especialmente √∫tiles cuando el c√≥digo que est√° escribiendo ser√° utilizado como caja negra por otros programadores; los usuarios sabr√°n inmediatamente cu√°ndo y c√≥mo han hecho un mal uso de su c√≥digo.</p>
<p>Por supuesto, debe tener mucho cuidado de asegurarse de que su c√≥digo no dependa sutilmente de declaraciones de solo depuraci√≥n para funcionar correctamente. Las declaraciones que desaparecer√°n en el c√≥digo de producci√≥n <em>nunca</em> deber√≠an tener efectos secundarios.</p>
<p><a id="glib-precondition"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

g_return_if_fail (condition);
g_return_val_if_fail (condition, return_value);
</code></pre>
<div class="caption">
<p><span class="glib-precondition">Listado</span>: Comprobaciones de condiciones previas.</p>
</div>
<p>El <span class="glib-precondition">Listado</span> muestra las verificaciones de condiciones previas de GLib. <code>g_return_if_fail()</code> imprime una advertencia y regresa inmediatamente de la funci√≥n actual si <code>condition</code> es <code>FALSE</code>. <code>g_return_val_if_fail()</code> es similar pero le permite devolver alg√∫n <code>return_value</code>. Estos macros son incre√≠blemente √∫tiles, si las usa libremente, especialmente en
combinaci√≥n con la verificaci√≥n de tipo en tiempo de ejecuci√≥n de GObject, reducir√° a la mitad el tiempo que dedica a buscar punteros incorrectos y errores
tipogr√°ficos.</p>
<p>Usar estas funciones es simple; aqu√≠ hay un ejemplo de la implementaci√≥n de la tabla hash GLib:</p>
<pre><code class="language-c">void
g_hash_table_foreach (GHashTable *hash_table,
                      GHFunc      func,
                      gpointer    user_data)
{
  gint i;

  g_return_if_fail (hash_table != NULL);
  g_return_if_fail (func != NULL);

  for (i = 0; i &lt; hash_table-&gt;size; i++)
    {
      guint node_hash = hash_table-&gt;hashes[i];
      gpointer node_key = hash_table-&gt;keys[i];
      gpointer node_value = hash_table-&gt;values[i];

      if (HASH_IS_REAL (node_hash))
        (* func) (node_key, node_value, user_data);
    }
}
</code></pre>
<p>Sin las comprobaciones, pasar <code>NULL</code> como par√°metro a esta funci√≥n resultar√≠a en una misteriosa falla de segmentaci√≥n. La persona que usa la biblioteca tendr√≠a que averiguar d√≥nde ocurri√≥ el error con un depurador y tal vez incluso indagar en el c√≥digo GLib para ver qu√© estaba mal. Con las comprobaciones, obtendr√°n un mensaje de error que les indicar√° que los argumentos <code>NULL</code> no est√°n permitidos.</p>
<p><a id="glib-assertions"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

g_assert (condition);
g_assert_not_reached ();
</code></pre>
<div class="caption">
<p><span class="glib-assertions">Listado</span>: Aserciones.</p>
</div>
<p>GLib tambi√©n tiene macros de aserci√≥n m√°s tradicionales, que se muestran en el <span class="glib-assertions">Listado</span>. <code>g_assert()</code> es b√°sicamente id√©ntico a <code>assert()</code>, pero responde a <code>G_DISABLE_ASSERT</code> y se comporta consistentemente en todas las plataformas. Tambi√©n se proporciona <code>g_assert_not_reached()</code>; esta es una aserci√≥n que siempre falla. Las aserciones llaman a <code>abort()</code> para salir del programa y (si su entorno lo admite) descargan un archivo central con fines de depuraci√≥n.</p>
<p>Las aserciones fatales deben usarse para verificar la <em>consistencia interna</em> de una funci√≥n o biblioteca, mientras que <code>g_return_if_fail()</code> est√° destinado a garantizar que se pasen valores cuerdos a las interfaces p√∫blicas de un m√≥dulo de programa. Es decir, si una aserci√≥n falla, normalmente busca un error en el m√≥dulo que contiene la aserci√≥n; Si falla una comprobaci√≥n de <code>g_return_if_fail()</code>, normalmente busca el error en el c√≥digo que invoca el m√≥dulo.</p>
<p>Este c√≥digo del m√≥dulo de c√°lculos calend√°ricos de GLib muestra la diferencia:</p>
<pre><code class="language-c">GDate *
g_date_new_dmy (GDateDay   day,
                GDateMonth month,
                GDateYear  year)
{
  GDate *date;
  g_return_val_if_fail (g_date_valid_dmy (day, month, year), NULL);

  date = g_new (GDate, 1);

  date-&gt;julian = FALSE;
  date-&gt;dmy = TRUE;

  date-&gt;month = month;
  date-&gt;day = day;
  date-&gt;year = year;

  g_assert (g_date_valid (date));

  return date;
}
</code></pre>
<p>La verificaci√≥n de condiciones previas al principio asegura que el usuario pasa en valores razonables para el d√≠a, mes y a√±o; la aserci√≥n al final asegura que GLib construy√≥ un objeto correctamente, dados valores adecuados.</p>
<p><code>g_assert_not_reached()</code> debe usarse para marcar situaciones &quot;imposibles&quot;; un uso com√∫n es detectar declaraciones de cambio que no manejan todos los valores posibles de una enumeraci√≥n:</p>
<pre><code class="language-c">switch (value)
  {
  case FOO_ONE:
    break;

  case FOO_TWO:
    break;

  default:
    g_assert_not_reached ();
  }
</code></pre>
<p>Todas las macros de depuraci√≥n imprimen una advertencia utilizando la funci√≥n <code>g_log()</code> de GLib, lo que significa que la advertencia incluye el nombre de la aplicaci√≥n o biblioteca de origen y, opcionalmente, puede instalar una rutina de impresi√≥n de advertencias de reemplazo. Por ejemplo, puede enviar todas las advertencias a un cuadro de di√°logo o archivo de registro en lugar de imprimirlas en la consola.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="memoria"><a class="header" href="#memoria">Memoria</a></h1>
<p>GLib envuelve el est√°ndar <code>malloc()</code> y <code>free()</code> con sus propias variantes <code>g_</code>, <code>g_malloc()</code> y <code>g_free()</code>, que se muestran en el <span class="glib-malloc-free">Listado</span>. Estos son agradables de varias maneras peque√±as:</p>
<ul>
<li>
<p><code>g_malloc()</code> siempre devuelve un <code>gpointer</code>, nunca un <code>char *</code>, por lo que no es necesario emitir el valor de retorno.</p>
</li>
<li>
<p><code>g_malloc()</code> aborta el programa si el <code>malloc()</code> subyacente falla, por lo que no tiene que buscar un valor devuelto <code>NULL</code>.</p>
</li>
<li>
<p><code>g_malloc()</code> maneja con gracia un <code>size</code> de <code>0</code>, devolviendo <code>NULL</code>.</p>
</li>
<li>
<p><code>g_free()</code> ignorar√° cualquier puntero <code>NULL</code> que le pase.</p>
</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> Antes del est√°ndar ANSI/ISO C, el tipo de puntero gen√©rico <code>void *</code> no exist√≠a y <code>malloc()</code> devolv√≠a un valor <code>char *</code>. Actualmente, <code>malloc()</code> devuelve un tipo <code>void *</code> (que es lo mismo que <code>gpointer</code>) y <code>void *</code> permite conversiones de puntero impl√≠citas en C. Lanzando el valor de retorno de <code>malloc()</code> es necesario si: el desarrollador quiere admitir compiladores antiguos; o si el desarrollador piensa que una conversi√≥n expl√≠cita aclara el c√≥digo; o si se usa un compilador de C++, porque en C++ se requiere una conversi√≥n del tipo <code>void *</code>.</p>
</blockquote>
<p><a id="glib-malloc-free"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gpointer g_malloc (gsize n_bytes);
void g_free (gpointer mem);
gpointer g_realloc (gpointer mem, gsize n_bytes);
gpointer g_memdup (gconstpointer mem, guint n_bytes);
</code></pre>
<div class="caption">
<p><span class="glib-malloc-free">Listado</span>: Asignaci√≥n de memoria GLib.</p>
</div>
<p>Es importante hacer coincidir <code>g_malloc()</code> con <code>g_free()</code>, <code>malloc()</code> simple con <code>free()</code> y si est√°s usando C++ <code>new</code> con <code>delete</code>. De lo contrario, pueden suceder comportamientos no esperados, ya que estos asignadores pueden usar diferentes grupos de memoria (y <code>new</code>/<code>delete</code> llama a constructores y destructores).</p>
<p>Por supuesto, hay un <code>g_realloc()</code> equivalente a <code>realloc()</code>. Tambi√©n hay un conveniente <code>g_malloc0()</code> que llena la memoria asignada con ceros, y <code>g_memdup()</code> que devuelve una copia de <code>n_bytes</code> bytes comenzando en <code>mem</code>. <code>g_realloc()</code> y <code>g_malloc0()</code> aceptar√°n ambos un tama√±o de 0, por coherencia con <code>g_malloc()</code>. Sin embargo, <code>g_memdup()</code> no lo har√°.</p>
<p>Si no es obvio: <code>g_malloc0()</code> llena la memoria sin procesar con bits no configurados, no el valor 0 para cualquier tipo que pretenda poner all√≠. De vez en cuando, alguien espera obtener una matriz de n√∫meros de coma flotante inicializados en 0.0; <em>no</em> se garantiza que funcione de forma port√°til.</p>
<p>Por √∫ltimo, existen macros de asignaci√≥n con reconocimiento de tipos, que se muestran en el <span class="glib-g_new">Listado</span>. El argumento <code>type</code> para cada uno de estos es el nombre de un tipo, y el argumento <code>count</code> es el n√∫mero de bloques de tama√±o <code>type</code> a asignar. Estas macros le ahorran algo de escritura y multiplicaci√≥n y, por lo tanto, son menos propensas a errores. Se lanzan autom√°ticamente al tipo de puntero de destino, por lo que intentar asignar la memoria asignada al tipo de puntero incorrecto deber√≠a activar una advertencia del compilador. (Si tiene las advertencias activadas, ¬°como deber√≠a hacerlo un programador responsable!)</p>
<p><a id="glib-g_new"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

g_new (type, count);
g_new0 (type, count);
g_renew (type, mem, count);
</code></pre>
<div class="caption">
<p><span class="glib-g_new">Listado</span>: Macros de asignaci√≥n.</p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="manejo-de-string"><a class="header" href="#manejo-de-string">Manejo de string</a></h1>
<p>GLib proporciona una serie de funciones para el manejo de cadenas; algunos son exclusivos de GLib y otros resuelven problemas de portabilidad. Todos interoperan muy bien con las rutinas de asignaci√≥n de memoria GLib.</p>
<p>Para aquellos interesados en una cadena mejor que <code>gchar *</code>, tambi√©n hay un tipo <code>GString</code>. No se trata en este libro; consulte la documentaci√≥n de la API para obtener m√°s informaci√≥n.</p>
<p><a id="glib-strext"></a></p>
<pre><code class="language-c">gint g_snprintf (gchar *string, gulong n, gchar const *format, ...);
</code></pre>
<div class="caption">
<p><span class="glib-strext">Listado</span>: Envoltorio de portabilidad.</p>
</div>
<p>El <span class="glib-strext">Listado</span> muestra un sustituto que GLib proporciona para la funci√≥n <code>snprintf()</code>. <code>g_snprintf()</code> envuelve el <code>snprintf()</code> nativo en las plataformas que lo tienen y proporciona una implementaci√≥n en las que no lo tienen.</p>
<p>Preste atenci√≥n a no usar la funci√≥n <code>sprintf()</code> que causa fallas, crea agujeros de seguridad y generalmente es maligna. Al usar <code>g_snprintf()</code> o <code>g_strdup_printf()</code> relativamente seguros (ver m√°s abajo), puedes despedirte de <code>sprintf()</code> para siempre.</p>
<p><a id="glib-strdup"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gchar * g_strdup (const gchar *str);
gchar * g_strndup (const gchar *str, gsize n);
gchar * g_strdup_printf (const gchar *format, ...);
gchar * g_strdup_vprintf (const gchar *format, va_list args);
gchar * g_strnfill (gsize length, gchar fill_char);
</code></pre>
<div class="caption">
<p><span class="glib-strdup">Listado</span>: Asignar cadenas.</p>
</div>
<p>El <span class="glib-strdup">Listado</span> muestra la amplia gama de funciones de GLib para asignar cadenas. Como era de esperar, <code>g_strdup()</code> y <code>g_strndup()</code> producen una copia asignada de <code>str</code> o los primeros <code>n</code> caracteres de <code>str</code>. Para mantener la coherencia con las funciones de asignaci√≥n de memoria GLib, devuelven <code>NULL</code> si se les pasa un puntero <code>NULL</code>. Las variantes <code>printf()</code> devuelven una cadena formateada. <code>g_strnfill()</code> devuelve una cadena de tama√±o <code>length</code> rellena con <code>fill_char</code>.</p>
<p><code>g_strdup_printf()</code> merece una menci√≥n especial; es una forma m√°s sencilla de manejar este c√≥digo com√∫n:</p>
<pre><code class="language-c">gchar *str = g_malloc (256);
g_snprintf (str, 256, &quot;%d printf-style %s&quot;, num, string);
</code></pre>
<p>En su lugar, podr√≠a decir esto y evitar tener que averiguar la longitud adecuada del b√∫fer para arrancar:</p>
<pre><code class="language-c">gchar *str = g_strdup_printf (&quot;%d printf-style %s&quot;, num, string);
</code></pre>
<p><a id="glib-strmanip"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gchar * g_strchug (gchar *string);
gchar * g_strchomp (gchar *string);
gchar * g_strstrip (gchar *string);
</code></pre>
<div class="caption">
<p><span class="glib-strmanip">Listado</span>: Modificaciones de cadenas in situ.</p>
</div>
<p>Las funciones del <span class="glib-strmanip">Listado</span> modifican una cadena en el lugar: <code>g_strchug()</code> y <code>g_strchomp()</code> &quot;chug&quot; la cadena (elimina los espacios iniciales), o &quot;chomp&quot; (eliminar los espacios finales). Esas dos funciones devuelven la cadena, adem√°s de modificarla en el lugar; en algunos casos, puede ser conveniente utilizar el valor de retorno. Hay una macro, <code>g_strstrip()</code>, que combina ambas funciones para eliminar los espacios iniciales y finales.</p>
<p><a id="glib-strformats"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gdouble g_strtod (const gchar *nptr, gchar **endptr);
const gchar * g_strerror (gint errnum);
const gchar * g_strsignal (gint signum);
</code></pre>
<div class="caption">
<p><span class="glib-strformats">Listado</span>: Conversiones de cadenas.</p>
</div>
<p>El listado 2.10 muestra algunas funciones semi-est√°ndar m√°s que envuelve GLib. <code>g_strtod</code> es como <code>strtod()</code> -- convierte la cadena <code>nptr</code> en un double -- con la excepci√≥n de que tambi√©n intentar√° convertir el double en la configuraci√≥n local de <code>&quot;C&quot;</code> si no puede convertirlo en la configuraci√≥n local predeterminada del usuario. <code>*endptr</code> se establece en el primer car√°cter no convertido, es decir, cualquier texto despu√©s de la representaci√≥n num√©rica. Si la conversi√≥n falla, <code>*endptr</code> se establece en <code>nptr</code>. <code>endptr</code> puede ser <code>NULL</code>, lo que hace que se ignore.</p>
<p><code>g_strerror()</code> y <code>g_strsignal()</code> son como sus equivalentes no <code>g_ </code>, pero port√°tiles. (Devuelven una representaci√≥n de cadena para un errno o un n√∫mero de se√±al).</p>
<p><a id="glib-strconcat"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gchar * g_strconcat (const gchar *string1, ...);
gchar * g_strjoin (const gchar *separator, ...);
</code></pre>
<div class="caption">
<p><span class="glib-strconcat">Listado</span>: Concatenar cadenas.</p>
</div>
<p>GLib proporciona algunas funciones convenientes para concatenar cadenas, que se muestran en el <span class="glib-strconcat">Listado</span>. <code>g_strconcat()</code> devuelve una cadena reci√©n asignada creada concatenando cada una de las cadenas en la lista de argumentos. El √∫ltimo argumento debe ser <code>NULL</code>, por lo que <code>g_strconcat()</code> sabe cu√°ndo detenerse. <code>g_strjoin()</code> es similar, pero <code>separator</code> se inserta entre cada cadena. Si <code>separator</code> es <code>NULL</code> , no se usa ning√∫n separador.</p>
<p><a id="glib-strvector"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gchar ** g_strsplit (const gchar *string,
                     const gchar *delimiter,
                     gint max_tokens);
gchar * g_strjoinv (const gchar *separator, gchar **str_array);
void g_strfreev (gchar **str_array);
</code></pre>
<div class="caption">
<p><span class="glib-strvector">Listado</span>: Manipulaci√≥n de vectores de cadena terminados en <code>NULL</code>.</p>
</div>
<p>Finalmente, el <span class="glib-strvector">Listado</span> resume algunas rutinas que manipulan matrices de cadenas terminadas en <code>NULL</code>. <code>g_strsplit()</code> rompe <code>string</code> en cada <code>delimiter</code>, devolviendo una matriz reci√©n asignada. <code>g_strjoinv()</code> concatena cada cadena en la matriz con un <code>separator</code> opcional, devolviendo una cadena asignada. <code>g_strfreev()</code> libera cada cadena en la matriz y luego la propia matriz.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="estructuras-de-datos"><a class="header" href="#estructuras-de-datos">Estructuras de datos</a></h1>
<p>GLib implementa muchas estructuras de datos comunes, por lo que no tiene que reinventar la rueda cada vez que desee una lista vinculada. Esta secci√≥n cubre la implementaci√≥n de GLib de listas enlazadas, √°rboles binarios ordenados, √°rboles N-arios y tablas hash.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="listas"><a class="header" href="#listas">Listas</a></h1>
<p>GLib proporciona listas gen√©ricas con enlaces simples y dobles, <code>GSList</code> y <code>GList</code>, respectivamente. Estos se implementan como listas de <code>gpointer</code>; puede usarlos para contener enteros con las macros <code>GINT_TO_POINTER</code> y <code>GPOINTER_TO_INT</code>. <code>GSList</code> y <code>GList</code> tienen casi las mismas API, excepto que hay una funci√≥n <code>g_list_previous()</code> y no <code>g_slist_previous()</code>. Esta secci√≥n discutir√° <code>GSList</code> pero todo tambi√©n se aplica a la lista doblemente enlazada.</p>
<p><a id="glib-gslist-cell"></a></p>
<pre><code class="language-c">typedef struct _GSList GSList;

struct _GSList
{
  gpointer data;
  GSList *next;
};
</code></pre>
<div class="caption">
<p><span class="glib-gslist-cell">Listado</span>: Celda <code>GSList</code>.</p>
</div>
<p>Una celda <code>GSList</code> es una estructura autoexplicativa que se muestra en el <span class="glib-gslist-cell">Listado</span>. Los campos de estructura son p√∫blicos, por lo que puede usarlos directamente para acceder a los datos o para recorrer la lista.</p>
<p>En la implementaci√≥n de GLib, la lista vac√≠a es simplemente un puntero <code>NULL</code>. Siempre es seguro pasar <code>NULL</code> a las funciones de lista, ya que es una lista v√°lida de longitud 0. El c√≥digo para crear una lista y agregar un elemento podr√≠a verse as√≠:</p>
<pre><code class="language-c">GSList *list = NULL;
gchar *element = g_strdup (&quot;Una cadena de caracteres&quot;);
list = g_slist_append (list, element);
</code></pre>
<p>Las listas GLib tienen una influencia Lisp notable; la lista vac√≠a es un valor especial &quot;nil&quot; por esa raz√≥n. <code>g_slist_prepend()</code> funciona de forma muy similar a <code>cons</code> -- es una operaci√≥n de tiempo constante <code>(O(1))</code> que agrega una nueva celda al principio de la lista.</p>
<p><a id="glib-listchanging"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

GSList * g_slist_append (GSList *list, gpointer data);
GSList * g_slist_prepend (GSList *list, gpointer data);
GSList * g_slist_insert (GSList *list, gpointer data, gint position);
GSList * g_slist_remove (GSList *list, gconstpointer data);
</code></pre>
<div class="caption">
<p><span class="glib-listchanging">Listado</span>: Cambiar el contenido de la lista vinculada.</p>
</div>
<p>El <span class="glib-listchanging">Listado</span> muestra las funciones b√°sicas para cambiar el contenido de <code>GSList</code>. Para todos estos, debe asignar el valor de retorno a su puntero de lista en caso de que cambie el encabezado de la lista. Tenga en cuenta que GLib <em>no</em> almacena un puntero al final de la lista, por lo que las funciones de agregar, insertar y eliminar se ejecutan en el tiempo <code>O(n)</code>, con <code>n</code> la longitud de la lista.</p>
<p>GLib se encargar√° de los problemas de memoria, desasignando y asignando celdas de lista seg√∫n sea necesario. Por ejemplo, el siguiente c√≥digo eliminar√≠a el elemento agregado anteriormente y vaciar√≠a la lista:</p>
<pre><code class="language-c">list = g_slist_remove (list, element);
</code></pre>
<p><code>list</code> ahora es <code>NULL</code>. A√∫n tienes que liberar <code>element</code> t√∫ mismo, por supuesto.</p>
<p>Para acceder a un elemento de lista, consulte la estructura <code>GSList</code> directamente:</p>
<pre><code class="language-c">gchar *my_data = list-&gt;data;
</code></pre>
<p>Para iterar sobre la lista, puede escribir un c√≥digo como este:</p>
<pre><code class="language-c">GSList *l;

for (l = list; l != NULL; l = l-&gt;next)
  {
    gchar *str = l-&gt;data;
    g_print (&quot;Elemento: %s\n&quot;, str);
  }
</code></pre>
<p><a id="glib-listfree"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef void (* GDestroyNotify) (gpointer data);

void g_slist_free (GSList *list);
void g_slist_free_full (GSList *list, GDestroyNotify free_func);
</code></pre>
<div class="caption">
<p><span class="glib-listfree">Listado</span>: Liberar listas enteras vinculadas.</p>
</div>
<p>El <span class="glib-listfree">Listado</span> muestra funciones para borrar una lista completa. <code>g_slist_free()</code> elimina todos los enlaces de una sola vez. <code>g_slist_free()</code> no tiene valor de retorno porque siempre ser√≠a <code>NULL</code>, y simplemente puede asignar ese valor a su lista si lo desea. Obviamente, <code>g_slist_free()</code> libera solo las celdas de la lista; no tiene forma de saber qu√© hacer con el contenido de la lista. La funci√≥n m√°s inteligente <code>g_slist_free_full()</code> toma un segundo argumento con un puntero de funci√≥n de destrucci√≥n que se llama en los datos de cada elemento. Para liberar la lista que contiene cadenas asignadas din√°micamente, puede escribir:</p>
<pre><code class="language-c">g_slist_free_full (list, g_free);

/* Si la lista se puede usar mas tarde: */
list = NULL;
</code></pre>
<p>Esto es equivalente a escribir:</p>
<pre><code class="language-c">GSList *l;

for (l = list; l != NULL; l = l-&gt;next)
  g_free (l-&gt;data);

g_slist_free (list);
list = NULL;
</code></pre>
<p>Construir una lista usando <code>g_slist_append()</code> es una <em>terrible</em> idea; use <code>g_slist_prepend()</code> y luego llame a <code>g_slist_reverse()</code> si necesita elementos en un orden en particular. Si prev√© agregar con frecuencia a una lista, tambi√©n puede mantener un puntero al √∫ltimo elemento.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Una forma m√°s conveniente es usar el tipo de datos GQueue: una cola de dos extremos que mantiene un puntero a la cabeza, un puntero a la cola y la longitud de la lista doblemente enlazada.</p>
</blockquote>
<p>El siguiente c√≥digo se puede usar para realizar agregados eficientes:</p>
<pre><code class="language-c">void
efficient_append (GSList   **list,
                  GSList   **list_end,
                  gpointer   data)
{
  g_return_if_fail (list != NULL);
  g_return_if_fail (list_end != NULL);

  if (*list == NULL)
    {
      g_assert (*list_end == NULL);

      *list = g_slist_append (*list, data);
      *list_end = *list;
    }
  else
    {
      *list_end = g_slist_append (*list_end, data)-&gt;next;
    }
}
</code></pre>
<p>Para usar esta funci√≥n, debe almacenar la lista y su final en alg√∫n lugar, y pasar su direcci√≥n a <code>efficient_append()</code>:</p>
<pre><code class="language-c">GSList* list = NULL;
GSList* list_end = NULL;

efficient_append (&amp;list, &amp;list_end, g_strdup (&quot;Foo&quot;));
efficient_append (&amp;list, &amp;list_end, g_strdup (&quot;Bar&quot;));
efficient_append (&amp;list, &amp;list_end, g_strdup (&quot;Baz&quot;));
</code></pre>
<p>Por supuesto, debe tener cuidado de no utilizar ninguna funci√≥n de lista que pueda cambiar el final de la lista sin actualizar <code>list_end</code>.</p>
<p><a id="glib-listaccess"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef void (* GFunc) (gpointer data, gpointer user_data);

GSList * g_slist_find (GSList *list, gconstpointer data);
GSList * g_slist_nth (GSList *list, guint n);
gpointer g_slist_nth_data (GSList *list, guint n);
GSList * g_slist_last (GSList *list);
gint g_slist_index (GSList *list, gconstpointer data);
void g_slist_foreach (GSList *list, GFunc func, gpointer user_data);
</code></pre>
<div class="caption">
<p><span class="glib-listaccess">Listado</span>: Acceder a datos en una lista vinculada.</p>
</div>
<p>Para acceder a los elementos de la lista, se proporcionan las funciones del <span class="glib-listaccess">Listado</span>. Ninguno de estos cambia la estructura de la lista. <code>g_slist_foreach()</code> aplica un <code>GFunc</code> a cada elemento de la lista.</p>
<p>Usado en <code>g_slist_foreach()</code>, su <code>GFunc</code> se llamar√° en cada <code>list-&gt;data</code> en <code>list</code>, pasando el <code>user_data</code> que proporcion√≥ a <code>g_slist_foreach()</code>. <code>g_slist_foreach()</code> es comparable a la funci√≥n &quot;map&quot; de Scheme.</p>
<p>Por ejemplo, es posible que tenga una lista de cadenas y que desee poder crear una lista paralela con alguna transformaci√≥n aplicada a las cadenas. Aqu√≠ hay algo de c√≥digo, usando la funci√≥n <code>efficient_append()</code> de un ejemplo anterior:</p>
<pre><code class="language-c">typedef struct _AppendContext AppendContext;
struct _AppendContext
{
  GSList *list;
  GSList *list_end;
  const gchar *append;
};

static void
append_foreach (gpointer data,
                gpointer user_data)
{
  gchar *oldstring = data;
  AppendContext *context = user_data;

  efficient_append (&amp;context-&gt;list,
                    &amp;context-&gt;list_end,
                    g_strconcat (oldstring, context-&gt;append, NULL));
}

GSList *
copy_with_append (GSList      *list_of_strings,
                  const gchar *append)
{
  AppendContext context;

  context.list = NULL;
  context.list_end = NULL;
  context.append = append;

  g_slist_foreach (list_of_strings, append_foreach, &amp;context);

  return context.list;
}
</code></pre>
<p>GLib y GTK usan mucho el lenguaje de &quot;puntero de funci√≥n y datos de usuario&quot;. Si tiene experiencia en programaci√≥n funcional, esto es muy parecido a usar expresiones lambda para crear un <em>cierre</em>. (Un cierre combina una funci√≥n con un <em>environment</em> -- un conjunto de enlaces nombre-valor. En este caso, el &quot;environment&quot; son los datos de usuario que pasa a <code>append_foreach()</code>, y el &quot;cierre&quot; es la combinaci√≥n del puntero de funci√≥n y los datos del usuario).</p>
<p><a id="glib-listmanip"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

guint g_slist_length (GSList *list);
GSList * g_slist_concat (GSList *list1, GSList *list2);
GSList * g_slist_reverse (GSList *list);
GSList * g_slist_copy (GSList *list);
</code></pre>
<div class="caption">
<p><span class="glib-listmanip">Listado</span>: Manipular una lista vinculada.</p>
</div>
<p>Hay algunas pr√°cticas rutinas de manipulaci√≥n de listas, listadas en <span class="glib-listmanip">Listado</span>. Con la excepci√≥n de <code>g_slist_copy()</code>, todos estos afectan las listas en el lugar. Lo que significa que debe asignar el valor de retorno y olvidarse del puntero pasado, tal como lo hace al agregar o eliminar elementos de la lista. <code>g_slist_copy()</code> devuelve una lista reci√©n asignada, por lo que puede continuar usando ambas listas y debe liberar ambas listas eventualmente.</p>
<p><a id="glib-listsorted"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef gint (* GCompareFunc) (gconstpointer a, gconstpointer b);

GSList * g_slist_insert_sorted (GSList *list, gpointer data, GCompareFunc func);
GSList * g_slist_sort (GSList *list, GCompareFunc compare_func);
GSList * g_slist_find_custom (GSList *list, gconstpointer data, GCompareFunc func);
</code></pre>
<div class="caption">
<p><span class="glib-listsorted">Listado</span>: Listas ordenadas.</p>
</div>
<p>Finalmente, hay algunas disposiciones para listas ordenadas, que se muestran en <span class="glib-listsorted">Listado</span>. Para usarlos, debe escribir un <code>GCompareFunc</code>, que es como la funci√≥n de comparaci√≥n en el est√°ndar C <code>qsort()</code>.</p>
<p>Si <code>a &lt; b</code> , <code>GCompareFunc</code> deber√≠a devolver un valor negativo; si <code>a &gt; b</code> un valor positivo; si <code>a == b</code> deber√≠a devolver 0.</p>
<p>Una vez que tenga una funci√≥n de comparaci√≥n, puede insertar un elemento en una lista ya ordenada u ordenar una lista completa. Las listas se ordenan en orden ascendente. Incluso puedes reciclar tu GCompareFunc para encontrar elementos de la lista, usando <code>g_slist_find_custom()</code>.</p>
<p>Tenga cuidado con las listas ordenadas; su mal uso puede volverse muy ineficaz r√°pidamente. Por ejemplo, <code>g_slist_insert_sorted()</code> es una operaci√≥n <code>O(n)</code>, pero si la usa en un bucle para insertar varios elementos, el bucle se ejecuta en tiempo cuadr√°tico (<code>O(n^2)</code>). Es mejor simplemente anteponer todos sus elementos y luego llamar a <code>g_slist_sort()</code>. <code>g_slist_sort()</code> se ejecuta en <code>O(n log n)</code>.</p>
<p>Tambi√©n puede usar la estructura de datos <code>GSequence</code> para datos ordenados. <code>GSequence</code> tiene una API de lista, pero se implementa internamente con un √°rbol binario equilibrado.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="√Årboles"><a class="header" href="#√Årboles">√Årboles</a></h1>
<p>Hay dos tipos diferentes de √°rboles en GLib; <code>GTree</code> es su √°rbol binario balanceado b√°sico, √∫til para almacenar pares clave-valor ordenados por clave; <code>GNode</code> almacena datos arbitrarios estructurados en √°rbol, como un √°rbol de an√°lisis o taxonom√≠a.</p>
<h2 id="gtree"><a class="header" href="#gtree">GTree</a></h2>
<p><a id="glib-treeconstruct"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef gint (* GCompareFunc) (gconstpointer a, gconstpointer b);
typedef gint (* GCompareDataFunc) (gconstpointer a,
                                   gconstpointer b,
                                   gpointer user_data);

GTree * g_tree_new (GCompareFunc key_compare_func);

GTree * g_tree_new_full (GCompareDataFunc key_compare_func,
                         gpointer key_compare_data,
                         GDestroyNotify key_destroy_func,
                         GDestroyNotify value_destroy_func);

void g_tree_destroy (GTree *tree);
</code></pre>
<div class="caption">
<p><span class="glib-treeconstruct">Listado</span>: Creando y destruyendo √°rboles binarios balanceados.</p>
</div>
<p>Para crear y destruir un <code>GTree</code>, use un constructor y un destructor que se muestran en el <span class="glib-treeconstruct">Listado</span>. <code>GCompareFunc</code> es la misma <code>qsort()</code>-funci√≥n de comparaci√≥n de estilo descrita para <code>GSList</code>; en este caso, se utiliza para comparar claves en el √°rbol. <code>g_tree_new_full()</code> es √∫til para facilitar la gesti√≥n de la memoria para claves y valores asignados din√°micamente.</p>
<p>La estructura <code>GTree</code> es un tipo de datos opaco. Se accede y modifica a su contenido √∫nicamente con funciones p√∫blicas.</p>
<p><a id="glib-treemanip"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

void g_tree_insert (GTree *tree, gpointer key, gpointer value);
gboolean g_tree_remove (GTree *tree, gconstpointer key);
gpointer g_tree_lookup (GTree *tree, gconstpointer key);
</code></pre>
<div class="caption">
<p><span class="glib-treemanip">Listado</span>: Manipular el contenido de <code>GTree</code>.</p>
</div>
<p>Las funciones para manipular el contenido del √°rbol se muestran en <span class="glib-treemanip">Listado</span>. Todo muy sencillo; <code>g_tree_insert()</code> sobrescribe cualquier valor existente, as√≠ que si no usa <code>g_tree_new_full()</code>, tenga cuidado si el valor existente es su √∫nico puntero a una porci√≥n de memoria asignada. Si <code>g_tree_lookup()</code> no encuentra la clave, devuelve <code>NULL</code>; de lo contrario, devuelve el valor asociado. Tanto las claves como los valores tienen el tipo <code>gpointer</code> o <code>gconstpointer</code>, pero las macros <code>GPOINTER_TO_INT()</code> y <code>GPOINTER_TO_UINT()</code> le permiten usar enteros en su lugar.</p>
<p><a id="glib-treesize"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gint g_tree_nnodes (GTree *tree);
gint g_tree_height (GTree *tree);
</code></pre>
<div class="caption">
<p><span class="glib-treesize">Listado</span>: Determinar el tama√±o de un <code>GTree</code>.</p>
</div>
<p>Hay dos funciones que le dan una idea del tama√±o del √°rbol, que se muestran en el <span class="glib-treesize">Listado</span>.</p>
<p><a id="glib-treetraverse"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef gboolean (* GTraverseFunc) (gpointer key,
                                    gpointer value,
                                    gpointer data);

void g_tree_foreach (GTree *tree, GTraverseFunc func, gpointer user_data);
</code></pre>
<div class="caption">
<p><span class="glib-treetraverse">Listado</span>: Atravesando un <code>GTree</code>.</p>
</div>
<p>Usando <code>g_tree_foreach()</code> (<span class="glib-treetraverse">Listado</span>) puedes recorrer todo el √°rbol. Para usarlo, proporcione un <code>GTraverseFunc</code>, al que se le pasa cada par clave-valor y un argumento <code>data</code> que le da a <code>g_tree_foreach()</code>. El recorrido contin√∫a mientras <code>GTraverseFunc</code> devuelva <code>FALSE</code>; si alguna vez devuelve <code>TRUE</code>, el recorrido se detiene. Puede usar esto para buscar en el √°rbol por <em>valor</em>.</p>
<h2 id="gnode"><a class="header" href="#gnode">GNode</a></h2>
<p><a id="glib-nodecell"></a></p>
<pre><code class="language-c">typedef struct _GNode GNode;

struct _GNode
{
  gpointer data;
  GNode *next;
  GNode *prev;
  GNode *parent;
  GNode *children;
};
</code></pre>
<div class="caption">
<p><span class="glib-nodecell">Listado</span>: Celda <code>GNode</code>.</p>
</div>
<p>A <code>GNode</code> es un √°rbol N-ario, implementado como una lista doblemente enlazada con listas padre e hijo. Por lo tanto, la mayor√≠a de las operaciones de lista tienen an√°logos en la API <code>GNode</code>. Puedes caminar por el √°rbol de varias maneras. El <span class="glib-nodecell">Listado</span> muestra la declaraci√≥n de un nodo.</p>
<p><a id="glib-nodeaccess"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

g_node_prev_sibling (node);
g_node_next_sibling (node);
g_node_first_child (node);
</code></pre>
<div class="caption">
<p><span class="glib-nodeaccess">Listado</span>: Accediendo a <code>GNode</code>.</p>
</div>
<p>Hay macros para acceder a los miembros de <code>GNode</code> , que se muestran en el <span class="glib-nodeaccess">Listado</span>. Al igual que con <code>GList</code>, el miembro <code>data</code> est√° dise√±ado para usarse directamente. Estas macros devuelven los miembros <code>next</code>, <code>prev</code> y <code>children</code> respectivamente; tambi√©n comprueban si su argumento es <code>NULL</code> antes de eliminar la referencia, y devuelven <code>NULL</code> si lo es.</p>
<p><a id="glib-nodenew"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

GNode * g_node_new (gpointer data);
</code></pre>
<div class="caption">
<p><span class="glib-nodenew">Listado</span>: Creando un <code>GNode</code>.</p>
</div>
<p>Para crear un nodo, se proporciona la funci√≥n <code>_new()</code> habitual (<span class="glib-nodenew">Listado</span>). <code>g_node_new()</code> crea un nodo sin hijos y sin padres que contiene <code>datos</code>. Normalmente, <code>g_node_new()</code> se usa solo para crear el nodo ra√≠z; Se proporcionan macros de conveniencia que crean autom√°ticamente nuevos nodos seg√∫n sea necesario.</p>
<p><a id="glib-nodebuild"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

GNode * g_node_insert (GNode *parent, gint position, GNode *node);
GNode * g_node_insert_before (GNode *parent, GNode *sibling, GNode *node);
GNode * g_node_prepend (GNode *parent, GNode *node);
</code></pre>
<div class="caption">
<p><span class="glib-nodebuild">Listado</span>: Construyendo un √°rbol <code>GNode</code>.</p>
</div>
<p>Para construir un √°rbol se utilizan las operaciones fundamentales que se muestran en el <span class="glib-nodebuild">Listado</span>. Cada operaci√≥n devuelve el nodo reci√©n agregado, para mayor comodidad al escribir bucles o recuperar el √°rbol. A diferencia de <code>GList</code>, es seguro ignorar el valor de retorno.</p>
<p><a id="glib-nodeconv"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

g_node_append (parent, node);
g_node_insert_data (parent, position, data);
g_node_insert_data_before (parent, sibling, data);
g_node_prepend_data (parent, data);
g_node_append_data (parent, data);
</code></pre>
<div class="caption">
<p><span class="glib-nodeconv">Listado</span>: Construyendo un <code>GNode</code>.</p>
</div>
<p>Las macros de conveniencia que se muestran en el <span class="glib-nodeconv">Listado</span> se implementan en t√©rminos de las operaciones fundamentales. <code>g_node_append()</code> es an√°logo a <code>g_node_prepend()</code>; el resto toma un argumento <code>data</code>, autom√°ticamente le asigna un nodo y llama a la operaci√≥n b√°sica correspondiente.</p>
<p><a id="glib-nodedestroy"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

void g_node_destroy (GNode *root);
void g_node_unlink (GNode *node);
</code></pre>
<div class="caption">
<p><span class="glib-nodedestroy">Listado</span>: Destruyendo un <code>GNode</code>.</p>
</div>
<p>Para eliminar un nodo del √°rbol, hay dos funciones que se muestran en el <span class="glib-nodedestroy">Listado</span>. <code>g_node_destroy()</code> elimina el nodo de un √°rbol, destruy√©ndolo a √©l ya todos sus hijos. <code>g_node_unlink()</code> elimina un nodo y lo convierte en un nodo ra√≠z; es decir, convierte un sub√°rbol en un √°rbol independiente.</p>
<p><a id="glib-nodeextrema"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

G_NODE_IS_ROOT (node);
G_NODE_IS_LEAF (node);
</code></pre>
<div class="caption">
<p><span class="glib-nodeextrema">Listado</span>: Predicados para <code>GNode</code>.</p>
</div>
<p>Hay dos macros para detectar la parte superior e inferior de un √°rbol <code>GNode</code>, que se muestran en el <span class="glib-nodeextrema">Listado</span>. Un nodo ra√≠z se define como un nodo sin padres ni hermanos. Un nodo hoja no tiene hijos.</p>
<p><a id="glib-nodeproperties"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

guint g_node_n_nodes (GNode *root, GTraverseFlags flags);
GNode * g_node_get_root (GNode *node);
gboolean g_node_is_ancestor (GNode *node, GNode *descendant);
guint g_node_depth (GNode *node);
GNode * g_node_find (GNode *root,
                     GTraverseType order,
                     GTraverseFlags flags,
                     gpointer data);
</code></pre>
<div class="caption">
<p><span class="glib-nodeproperties">Listado</span>: Propiedades de <code>GNode</code>.</p>
</div>
<p>Puede pedirle a GLib que proporcione informaci√≥n √∫til sobre un <code>GNode</code>, incluido el n√∫mero de nodos que contiene, su nodo ra√≠z, su profundidad y el nodo que contiene un puntero de datos en particular. Estas funciones se muestran en el <span class="glib-nodeproperties">Listado</span>.</p>
<p><code>GTraverseType</code> es una enumeraci√≥n; hay cuatro valores posibles. Estos son sus significados:</p>
<ul>
<li>
<p><code>G_PRE_ORDER</code> visita el nodo actual, luego recurre a cada hijo por turno.</p>
</li>
<li>
<p><code>G_POST_ORDER</code> recurre a cada hijo en orden, luego visita el nodo actual.</p>
</li>
<li>
<p><code>G_IN_ORDER</code> primero recurre al hijo m√°s a la izquierda del nodo, luego visita el nodo mismo y luego recurre al resto de los hijos del nodo. Esto no es muy √∫til; en su mayor√≠a, est√° dise√±ado para su uso con un √°rbol binario.</p>
</li>
<li>
<p><code>G_LEVEL_ORDER</code> primero visita el nodo en s√≠; luego cada uno de los hijos del nodo; luego los hijos de los hijos; luego los hijos de los hijos de los hijos; y as√≠. Es decir, visita cada nodo de profundidad 0, luego cada nodo de profundidad 1, luego cada nodo de profundidad 2, etc.</p>
</li>
</ul>
<p>Las funciones de recorrido de √°rbol de <code>GNode</code> tienen un argumento <code>GTraverseFlags</code>. Este es un campo de bits que se utiliza para cambiar la naturaleza del recorrido. Actualmente solo hay tres banderas: puede visitar solo los nodos de hoja, solo los nodos que no son de hoja o todos los nodos:</p>
<ul>
<li>
<p><code>G_TRAVERSE_LEAVES</code> significa atravesar solo los nodos hoja.</p>
</li>
<li>
<p><code>G_TRAVERSE_NON_LEAVES</code> significa atravesar solo nodos que no son hojas.</p>
</li>
<li>
<p><code>G_TRAVERSE_ALL</code> es simplemente un atajo para <br /> <code>(G_TRAVERSE_LEAVES | G_TRAVERSE_NON_LEAVES)</code>.</p>
</li>
</ul>
<p><a id="glib-nodeaccessors"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef gboolean (* GNodeTraverseFunc) (GNode *node, gpointer data);
typedef void (* GNodeForeachFunc) (GNode *node, gpointer data);

void g_node_traverse (GNode *root,
                      GTraverseType order,
                      GTraverseFlags flags,
                      gint max_depth,
                      GNodeTraverseFunc func,
                      gpointer data);

void g_node_children_foreach (GNode *node,
                              GTraverseFlags flags,
                              GNodeForeachFunc func,
                              gpointer data);

guint g_node_max_height (GNode *root);
void g_node_reverse_children (GNode *node);
guint g_node_n_children (GNode *node);
gint g_node_child_position (GNode *node, GNode *child);
GNode * g_node_nth_child (GNode *node, guint n);
GNode * g_node_last_child (GNode *node);
</code></pre>
<div class="caption">
<p><span class="glib-nodeaccessors">Listado</span>: Accediendo a un <code>GNode</code>.</p>
</div>
<p>El <span class="glib-nodeaccessors">Listado</span> muestra algunas de las funciones restantes de <code>GNode</code>. Son sencillos; la mayor√≠a de ellos son simplemente operaciones en la lista de hijos del nodo. Hay dos definiciones de tipos de funci√≥n exclusivas de <code>GNode</code>: <code>GNodeTraverseFunc</code> y <code>GNodeForeachFunc</code>. Estos se llaman con un puntero al nodo que se est√° visitando y los datos de usuario que proporciona. Un <code>GNodeTraverseFunc</code> puede devolver <code>TRUE</code> para detener cualquier recorrido que est√© en progreso; por lo tanto, puede usar <code>g_node_traverse()</code> para buscar el √°rbol por valor.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="tablas-hash"><a class="header" href="#tablas-hash">Tablas hash</a></h1>
<p><code>GHashTable</code> es una implementaci√≥n de tabla hash simple, que proporciona una matriz asociativa con b√∫squedas en tiempo constante. Para crear y destruir una <code>GHashTable</code>, use un constructor y un destructor listados en <span class="glib-hashnew">Listado</span>. Debe proporcionar una <code>GHashFunc</code>, que deber√≠a devolver un entero positivo cuando se le pase una clave hash. Cada <code>guint</code> devuelto (m√≥dulo del tama√±o de la tabla) corresponde a un &quot;slot&quot; o &quot;bucket&quot; en el hash; <code>GHashTable</code> maneja las colisiones almacenando una lista vinculada de pares clave-valor en cada espacio. Por lo tanto, los valores de <code>guint</code> devueltos por su <code>GHashFunc</code> deben distribuirse de manera bastante uniforme sobre el conjunto de posibles valores de <code>guint</code>, o la tabla hash degenerar√° en una lista enlazada. Su <code>GHashFunc</code> tambi√©n debe ser r√°pido, ya que se usa para cada b√∫squeda.</p>
<p>Adem√°s de <code>GHashFunc</code>, se requiere una <code>GEqualFunc</code> para probar la igualdad de las claves. Se utiliza para encontrar el par clave-valor correcto cuando las colisiones hash dan como resultado m√°s de un par en la misma ranura hash.</p>
<p>Si usa el constructor b√°sico <code>g_hash_table_new()</code>, recuerde que GLib no tiene forma de saber c√≥mo destruir los datos contenidos en su tabla hash; solo destruye la tabla misma. Si es necesario liberar las claves y los valores, use <code>g_hash_table_new_full()</code>, las funciones de destrucci√≥n se llamar√°n en cada clave y valor antes de destruir la tabla hash.</p>
<p><a id="glib-hashnew"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef guint (* GHashFunc) (gconstpointer key);
typedef gboolean (* GEqualFunc) (gconstpointer a, gconstpointer b);
typedef void (* GDestroyNotify) (gpointer data);

GHashTable * g_hash_table_new (GHashFunc hash_func, GEqualFunc key_equal_func);

GHashTable * g_hash_table_new_full (GHashFunc hash_func,
                                    GEqualFunc key_equal_func,
                                    GDestroyNotify key_destroy_func,
                                    GDestroyNotify value_destroy_func);

void g_hash_table_destroy (GHashTable *hash_table);
</code></pre>
<div class="caption">
<p><span class="glib-hashnew">Listado</span>: <code>GHashTable</code> constructores y destructores</p>
</div>
<p>Se proporcionan funciones de comparaci√≥n y hash listas para usar para claves comunes: enteros, punteros, cadenas y otros tipos de GLib. Los m√°s comunes se enumeran en el <span class="glib-hashfuncs">Listado</span>. Las funciones para enteros aceptan un puntero a <code>gint</code>, en lugar de a <code>gint</code> en s√≠. Si pasa <code>NULL</code> como argumento de la funci√≥n hash a <code>g_hash_table_new()</code>, <code>g_direct_hash()</code> se usa por defecto. Si pasa <code>NULL</code> como la funci√≥n de igualdad de claves, entonces se usa una comparaci√≥n de puntero simple (equivalente a <code>g_direct_equal()</code>, pero sin una llamada de funci√≥n).</p>
<p><a id="glib-hashfuncs"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

guint g_int_hash (gconstpointer key);
gboolean g_int_equal (gconstpointer key1, gconstpointer key2);
guint g_direct_hash (gconstpointer key);
gboolean g_direct_equal (gconstpointer key1, gconstpointer key2);
guint g_str_hash (gconstpointer key);
gboolean g_str_equal (gconstpointer key1, gconstpointer key2);
</code></pre>
<div class="caption">
<p><span class="glib-hashfuncs">Listado</span>: Hashes/comparaciones preescritos</p>
</div>
<p>Manipular la tabla hash es simple. Las rutinas se resumen en <span class="glib-hashmanip">Listado</span>. Las inserciones <em>no</em> copian la clave o el valor; estos se ingresan en la tabla exactamente como los proporciona, reemplazando cualquier par clave-valor preexistente con la misma clave (&quot;igual&quot; est√° definido por sus funciones hash e igualdad, recuerde). Si esto es un problema, debe realizar una b√∫squeda o eliminar antes de insertar. Tenga especial cuidado si asigna claves o valores de forma din√°mica. Si ha proporcionado funciones <code>GDestroyNotify</code>, √©stas se llamar√°n autom√°ticamente en el antiguo par clave-valor antes de reemplazarlo.</p>
<p>El <code>g_hash_table_lookup()</code> simple devuelve el valor que encuentra asociado con <code>key</code>, o <code>NULL</code> si no hay ning√∫n valor. A veces esto no funciona. Por ejemplo, <code>NULL</code> puede ser un valor v√°lido en s√≠ mismo. Si est√° utilizando cadenas como claves, especialmente cadenas asignadas din√°micamente, saber que una clave est√° en la tabla puede no ser suficiente; es posible que desee recuperar el <code>gchar*</code> exacto que utiliza la tabla hash para representar la clave <code>&quot;foo&quot;</code> . Se proporciona una segunda funci√≥n de b√∫squeda para casos como estos. <code>g_hash_table_lookup_extended()</code> devuelve <code>TRUE</code> si la b√∫squeda se realiz√≥ correctamente; si devuelve <code>TRUE</code>, coloca la clave y el valor que encontr√≥ en las ubicaciones proporcionadas.</p>
<p><a id="glib-hashmanip"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

gboolean g_hash_table_insert (GHashTable *hash_table, gpointer key, gpointer value);
gboolean g_hash_table_remove (GHashTable *hash_table, gconstpointer key);
gpointer g_hash_table_lookup (GHashTable *hash_table, gconstpointer key);
gboolean g_hash_table_lookup_extended (GHashTable *hash_table,
                                       gconstpointer lookup_key,
                                       gpointer *orig_key,
                                       gpointer *value);
</code></pre>
<div class="caption">
<p><span class="glib-hashmanip">Listado</span>: Manipular una <code>GHashTable</code></p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="el-bucle-del-evento-principal"><a class="header" href="#el-bucle-del-evento-principal">El bucle del evento principal</a></h1>
<p><a id="glib-event-loop"></a></p>
<div class="caption">
<img src="content/glib/sect/../../../assets/img/diag/event-loop.svg" alt="Estructura de una aplicaci√≥n impulsada por eventos" width="70%" />
<p><span class="glib-event-loop">Figura</span>: Estructura de una aplicaci√≥n impulsada por eventos, con un bucle de eventos principal</p>
</div>
<p>Las aplicaciones actuales a menudo se basan en eventos. Para las aplicaciones GUI, hay muchas fuentes de eventos: una pulsaci√≥n de tecla, un clic del mouse, un gesto t√°ctil, un mensaje de otra aplicaci√≥n, un cambio en el sistema de archivos, estar conectado o desconectado de la red, etc. Una aplicaci√≥n necesita reaccionar a esos eventos. Por ejemplo, cuando se presiona una tecla cuando una entrada de texto tiene el foco, el car√°cter debe insertarse y mostrarse en la pantalla.</p>
<p>Pero la programaci√≥n dirigida por eventos tambi√©n se aplica a los daemons. La comunicaci√≥n entre procesos tambi√©n ocurre entre daemons y aplicaciones. Un daemon podr√≠a recibir un evento cuando llega un paquete a una interfaz de red. Un daemon de impresora podr√≠a recibir eventos cuando una impresora est√° conectada, desconectada, tiene poco papel, etc. Un daemon de montaje puede escuchar las memorias USB insertadas. Otro daemon puede escuchar las conexiones de monitores externos para reconfigurar las pantallas, y as√≠ sucesivamente.</p>
<p>Un programa impulsado por eventos no est√° estructurado de la misma manera que un programa por lotes. El trabajo a realizar por un programa por lotes se determina al principio. Luego analiza la entrada, realiza algunos c√°lculos sobre ella y genera un informe. Por ejemplo, la mayor√≠a de los comandos y scripts de Unix son programas por lotes.</p>
<p>Entonces, ¬øc√≥mo estructurar una aplicaci√≥n que necesita responder a varios eventos que pueden llegar en cualquier momento? Como sugiere el t√≠tulo de esta secci√≥n ... ¬°con un <em>bucle de evento principal</em> por supuesto! Esa es otra parte importante de GLib; Proporciona soporte b√°sico de programaci√≥n dirigida por eventos, con una abstracci√≥n de bucle de eventos principal, una implementaci√≥n port√°til de subprocesos y comunicaci√≥n asincr√≥nica entre subprocesos. Un bucle de eventos escucha algunas fuentes de eventos. Se asocia una prioridad con cada fuente de eventos. Cuando llega un evento, el bucle de eventos lo env√≠a a la aplicaci√≥n. El evento se puede tener en cuenta, ya sea en el mismo hilo o en otro hilo. La <span class="glib-event-loop">Figura</span> muestra una vista de alto nivel de lo que es un bucle de eventos principal.</p>
<p>La funci√≥n <code>main()</code> de una aplicaci√≥n dirigida por eventos se ve as√≠:</p>
<pre><code class="language-c">gint
main (gint   argc,
      gchar *argv[])
{
  /* Cree una ventana principal y adjunte devoluciones de llamada de senal. */

  /* Ejecute el bucle de eventos principal. */
  gtk_main ();

  return 0;
}
</code></pre>
<p>El bucle de eventos GTK tiene un nivel ligeramente m√°s alto que la abstracci√≥n del bucle de eventos GLib. <code>gtk_main()</code> ejecuta el ciclo de eventos principal hasta que se llama a <code>gtk_main_quit()</code>. <code>gtk_main_quit()</code> normalmente se llama en la devoluci√≥n de llamada de la funci√≥n cuando se hace clic en el bot√≥n de cierre o se activa la acci√≥n del men√∫ Salir.</p>
<p>Una devoluci√≥n de llamada es una funci√≥n que se llama cuando se env√≠a una se√±al. El sistema de se√±ales est√° implementado por la biblioteca GObject. Escuchar una se√±al se logra con la funci√≥n <code>g_signal_connect()</code>:</p>
<pre><code class="language-c">static void
button_clicked_cb (GtkButton *button,
                   gpointer   user_data)
{
  MyObject *self = user_data;

  /* Hacer algo */
}

static void
create_button (MyObject *self)
{
  GtkButton *button;

  /* Crear boton */

  /* Adjuntar devolucion de llamada de senal */
  g_signal_connect (button,
                    &quot;clicked&quot;,
                    G_CALLBACK (button_clicked_cb),
                    self);
}
</code></pre>
<p>Cuando se ejecuta una devoluci√≥n de llamada, bloquea el bucle principal. Entonces, para no congelar la interfaz de usuario, existen dos soluciones:</p>
<ol>
<li>
<p>Las operaciones largas (especialmente las E/S) se pueden iniciar en otro hilo.</p>
</li>
<li>
<p>Las operaciones largas se pueden dividir en fragmentos m√°s peque√±os, y cada fragmento se ejecuta en una iteraci√≥n de bucle principal separada.</p>
</li>
</ol>
<p>Para la segunda soluci√≥n, GLib proporciona las funciones <code>g_idle_add()</code> y <code>g_timeout_add()</code> (ver <span class="glib-idle-timeout">Listado</span>). Se llamar√° a una funci√≥n inactiva cuando el bucle principal est√© inactivo, es decir, cuando el bucle principal no tenga nada m√°s que hacer. Se llama a una funci√≥n de tiempo de espera a intervalos regulares. El valor de retorno booleano de una <code>GSourceFunc</code> permite continuar o detener la funci√≥n. Si contin√∫a, el bucle principal volver√° a llamar a la funci√≥n en el siguiente tiempo de inactividad o tiempo de espera. Puede eliminar manualmente <code>GSourceFunc</code> llamando a <code>g_source_remove()</code>, que toma como par√°metro el ID de origen devuelto por <code>g_idle_add()</code> o <code>g_timeout_add()</code>. Debe prestar atenci√≥n para eliminar una <code>GSourceFunc</code> cuando se destruye el objeto en el que realiza el c√°lculo. Por lo tanto, puede almacenar el ID de fuente en un atributo de objeto y llamar a <code>g_source_remove()</code> en el destructor si el ID de fuente es diferente de <code>0</code>. (Consulte la biblioteca de GObject para crear sus propias clases en C.)</p>
<p><a id="glib-idle-timeout"></a></p>
<pre><code class="language-c">#include &lt;glib.h&gt;

typedef gboolean (* GSourceFunc) (gpointer user_data);

guint g_idle_add (GSourceFunc function, gpointer data);
guint g_timeout_add (guint interval, GSourceFunc function, gpointer data);

gboolean g_source_remove (guint source_id);
</code></pre>
<div class="caption">
<p><span class="glib-idle-timeout">Listado</span>: Inactivos y tiempos de espera</p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="glib-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="otras-caracter√≠sticas"><a class="header" href="#otras-caracter√≠sticas">Otras caracter√≠sticas</a></h1>
<p>Simplemente no hay espacio para cubrir todas las funciones de GLib en este
libro. Vale la pena mirar GLib cada vez que piense: &quot;Realmente <em>deber√≠a</em> haber
una funci√≥n que ...&quot;. Esta secci√≥n enumera otras caracter√≠sticas que proporciona
GLib, pero <em>no</em> es exhaustiva.</p>
<p>Parte del soporte de aplicaciones principales que no se ha mencionado a√∫n:</p>
<ul>
<li>
<p><code>GError</code>: un sistema de notificaci√≥n de errores, similar a las excepciones en otros lenguajes.</p>
</li>
<li>
<p>La funci√≥n <code>g_log()</code> le permite imprimir advertencias, mensajes, etc. con niveles de registro configurables y rutinas de impresi√≥n conectables.</p>
</li>
</ul>
<p>Utilidades:</p>
<ul>
<li>
<p>Un analizador de opciones de l√≠nea de comandos.</p>
</li>
<li>
<p>Un marco de prueba unitaria.</p>
</li>
<li>
<p>Una instalaci√≥n de temporizador.</p>
</li>
<li>
<p>Funciones calend√°ricas/aritm√©ticas de fechas.</p>
</li>
<li>
<p>Manipulaci√≥n de nombre de archivo, como <code>g_path_get_basename()</code> y <code>g_path_is_absolute()</code>.</p>
</li>
<li>
<p>Un analizador XML simple.</p>
</li>
<li>
<p>Expresiones regulares compatibles con Perl.</p>
</li>
</ul>
<p>Una selecci√≥n de utilidades m√°s peque√±as:</p>
<ul>
<li>
<p><code>G_MAXFLOAT</code>, etc. equivalentes para muchos tipos num√©ricos.</p>
</li>
<li>
<p>Conversiones por orden de bytes.</p>
</li>
<li>
<p><code>G_DIR_SEPARATOR</code> maneja las diferencias de Windows/Unix.</p>
</li>
<li>
<p>Rutinas de conveniencia/portabilidad para obtener el directorio de inicio del usuario, obtener el nombre de un directorio <code>/tmp</code> y tareas similares.</p>
</li>
<li>
<p><code>G_VA_COPY</code> copia una <code>va_list</code> de forma port√°til.</p>
</li>
<li>
<p>Numerosas macros para permitir el uso de extensiones del compilador (especialmente extensiones GCC) de forma port√°til.</p>
</li>
<li>
<p>Manipulaci√≥n de campo de bits.</p>
</li>
<li>
<p>Portable <code>g_htonl()</code> y otras conversiones de host a red.</p>
</li>
</ul>
<p>Y por √∫ltimo, pero no menos importante, otros tipos de datos interesantes:</p>
<ul>
<li>
<p>Clases mejoradas de cadenas y matrices. Arreglos de punteros y bytes.</p>
</li>
<li>
<p><code>GQuark</code> -- mapeo bidireccional de cadenas a identificadores enteros.</p>
</li>
<li>
<p><code>GVariant</code> -- un tipo de datos gen√©rico que almacena un valor junto con informaci√≥n sobre el tipo de ese valor.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="programaci√≥n-semi-orientada-a-objetos-en-c"><a class="header" href="#programaci√≥n-semi-orientada-a-objetos-en-c">Programaci√≥n semi-orientada a objetos en C</a></h1>
<p>Ahora que est√° familiarizado con la biblioteca principal de GLib, ¬øcu√°l es el siguiente paso? Como se explic√≥ en la secci√≥n <span class="ch-intro-learning-path">Ruta de aprendizaje</span>, el seguimiento l√≥gico es la programaci√≥n orientada a objetos (OOP) en C y los conceptos b√°sicos de GObject.</p>
<p>Cada widget GTK es una subclase de la clase base GObject. Entonces, conocer los conceptos b√°sicos de GObject es importante para <em>usar</em> un widget GTK u otra utilidad basada en GObject, pero tambi√©n para <em>crear</em> tus propias clases de GObject.</p>
<p>Es importante notar que aunque el lenguaje C no est√° orientado a objetos, es posible escribir c√≥digo C &quot;semi-orientado a objetos&quot; f√°cilmente, sin GObject. Para fines de aprendizaje, con eso comienza esta parte. GObject es entonces m√°s f√°cil de aprender. Lo que GObject agrega son m√°s caracter√≠sticas como recuento de referencias, herencia, funciones virtuales, interfaces, se√±ales y m√°s.</p>
<p>Pero, ¬øpor qu√© seguir un estilo orientado a objetos en primer lugar? Un c√≥digo orientado a objetos permite evitar variables globales. Y si ha le√≠do alg√∫n tipo de gu√≠a de mejores pr√°cticas de programaci√≥n, sabe que <em>deber√≠a</em>, si es posible, evitar las variables globales.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Una variable global en C puede ser una variable <code>static</code> declarada en el parte superior de un archivo *.c, al que se puede acceder desde cualquier funci√≥n en ese archivo *.c. Esto a veces es √∫til, pero debe evitarse si es posible. Hay otro tipo de variable global en C: una variable <code>extern</code> a la que se puede acceder desde cualquier archivo *.c. Este √∫ltimo es mucho peor que el primero.</p>
</blockquote>
<p>Porque el uso de datos globales hace que el c√≥digo sea m√°s dif√≠cil de administrar y comprender, especialmente cuando un programa se vuelve m√°s grande. Tambi√©n hace que el c√≥digo sea m√°s dif√≠cil de reutilizar. En cambio, es mejor dividir un programa en partes m√°s peque√±as e independientes, de modo que pueda concentrarse solo en una parte del c√≥digo a la vez.</p>
<p>Esta parte del libro consta de dos cap√≠tulos:</p>
<ul>
<li>
<p><span class="ch-oop-semi">Programaci√≥n semi-orientada a objetos en C</span>, que explica c√≥mo escribir sus propias clases semi-OOP;</p>
</li>
<li>
<p><span class="ch-oop-gobject">Una suave introducci√≥n a GObject</span>, que explica los conceptos b√°sicos de GObject.</p>
</li>
</ul>
<p>En el cap√≠tulo anterior se explic√≥ que la biblioteca principal de GLib utiliza un estilo de codificaci√≥n semi-orientado a objetos. Esta secci√≥n explica lo que significa y c√≥mo escribir su propio c√≥digo con este estilo de codificaci√≥n.</p>
<p>Una de las ideas principales de OOP es <em>mantener los datos y el comportamiento relacionados en un solo lugar</em>.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Esta es una de las pautas discutidas en <em>Heur√≠stica de dise√±o orientado a objetos</em> <span class="oop-book"></span>.</p>
</blockquote>
<p>En C, los datos se almacenan en una <code>struct</code> y el comportamiento se implementa con funciones. Para mantenerlos en un solo lugar, los colocamos en el mismo archivo *.c, con las funciones p√∫blicas presentes en el archivo *.h correspondiente (el encabezado).</p>
<p>Otra idea importante de OOP es <em>ocultar todos los datos dentro de su clase</em>. En C, significa que la declaraci√≥n completa de <code>struct</code> debe estar presente solo en el archivo *.c, mientras que el encabezado contiene solo un <code>typedef</code>. C√≥mo se almacenan los datos dentro de la clase y qu√© estructuras de datos se utilizan debe seguir siendo un detalle de implementaci√≥n. Un usuario de la clase no debe estar al tanto de los detalles de implementaci√≥n, en su lugar, debe confiar solo en la interfaz externa, es decir, lo que est√° presente en el encabezado y la documentaci√≥n p√∫blica. De esa manera, la implementaci√≥n de la clase puede cambiar sin afectar a los usuarios de la clase, siempre que la API no cambie.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="biblio-refs"></div>
<div class="refs-ch"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="ejemplo-de-encabezado"><a class="header" href="#ejemplo-de-encabezado">Ejemplo de encabezado</a></h1>
<p>El <span class="oop-semi-spell-checker-h">Listado</span> muestra un ejemplo de un encabezado que proporciona un simple corrector ortogr√°fico. Este es un c√≥digo ficticio; si necesita un corrector ortogr√°fico en su aplicaci√≥n GTK, probablemente usar√≠a hoy en d√≠a la biblioteca gspell.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Puede encontrar el proyecto en <a href="https://gitlab.gnome.org/GNOME/gspell">https://gitlab.gnome.org/GNOME/gspell</a>.</p>
</blockquote>
<p><a id="oop-semi-spell-checker-h"></a></p>
<pre><code class="language-c">#ifndef MYAPP_SPELL_CHECKER_H
#define MYAPP_SPELL_CHECKER_H

#include &lt;glib.h&gt;

G_BEGIN_DECLS

typedef struct _MyappSpellChecker MyappSpellChecker;

MyappSpellChecker *
  myapp_spell_checker_new             (const gchar *language_code);

void
  myapp_spell_checker_free            (MyappSpellChecker *checker);

gboolean
  myapp_spell_checker_check_word      (MyappSpellChecker *checker,
                                       const gchar       *word,
                                       gssize             word_length);

GSList *
  myapp_spell_checker_get_suggestions (MyappSpellChecker *checker,
                                       const gchar       *word,
                                       gssize             word_length);

G_END_DECLS

#endif /* MYAPP_SPELL_CHECKER_H */
</code></pre>
<div class="caption">
<p><span class="oop-semi-spell-checker-h">Listado</span>: myapp-spell-checker.h</p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="oop-semi-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="espacio-de-nombres-del-proyecto"><a class="header" href="#espacio-de-nombres-del-proyecto">Espacio de nombres del proyecto</a></h1>
<p>Lo primero a tener en cuenta es el uso del espacio de nombres &quot;Myapp&quot;. Cada s√≠mbolo del encabezado tiene como prefijo el espacio de nombres del proyecto.</p>
<p>Es una buena pr√°ctica elegir un espacio de nombres para su c√≥digo, para evitar conflictos de s√≠mbolos en el momento del enlace. Es especialmente importante tener un espacio de nombres para una biblioteca, pero tambi√©n es mejor tener uno para una aplicaci√≥n. Por supuesto, el espacio de nombres debe ser √∫nico para cada base de c√≥digo; por ejemplo, <em>no</em> debe reutilizar los espacios de nombres &quot;G&quot; o &quot;Gtk&quot; para su aplicaci√≥n o biblioteca.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="espacio-de-nombres-de-clase"><a class="header" href="#espacio-de-nombres-de-clase">Espacio de nombres de clase</a></h1>
<p>Adem√°s, hay un segundo espacio de nombres con el nombre de la clase, aqu√≠ &quot;SpellChecker&quot;. Si sigue esa convenci√≥n de forma coherente, el nombre de un s√≠mbolo es m√°s predecible, lo que facilita el trabajo con la API. El nombre de un s√≠mbolo siempre ser√° &quot;espacio de nombres del proyecto&quot; + &quot;nombre de la clase&quot; + &quot;nombre del s√≠mbolo&quot;.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="min√∫sculas-may√∫sculas-o-camelcase"><a class="header" href="#min√∫sculas-may√∫sculas-o-camelcase">¬øMin√∫sculas, May√∫sculas o CamelCase?</a></h1>
<p>Dependiendo del tipo de s√≠mbolo, su nombre est√° en may√∫sculas, min√∫sculas o CamelCase. La convenci√≥n en el mundo GLib es:</p>
<ul>
<li>Letras may√∫sculas para una constante, ya sea para un valor <code>#define</code> o <code>enum</code>;</li>
<li>CamelCase para un tipo <code>struct</code> o <code>enum</code>;</li>
<li>Min√∫sculas para funciones, variables, campos <code>struct</code>, ‚Ä¶</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="incluir-guardia"><a class="header" href="#incluir-guardia">Incluir guardia</a></h1>
<p>El encabezado contiene el t√≠pico protector de inclusi√≥n:</p>
<pre><code class="language-c">#ifndef MYAPP_SPELL_CHECKER_H
#define MYAPP_SPELL_CHECKER_H

/* ... */

#endif /* MYAPP_SPELL_CHECKER_H */
</code></pre>
<p>Evita que el encabezado se incluya varias veces en el mismo archivo *.c.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="soporte-de-c"><a class="header" href="#soporte-de-c">Soporte de C++</a></h1>
<p>El par <code>G_BEGIN_DECLS</code>/<code>G_END_DECLS</code> permite que el encabezado se incluya desde el c√≥digo C ++. Es m√°s importante para una biblioteca, pero tambi√©n es una buena pr√°ctica agregar esas macros en el c√≥digo de la aplicaci√≥n, incluso si la aplicaci√≥n no usa C ++. De esa manera, una clase de aplicaci√≥n se podr√≠a mover a una biblioteca f√°cilmente (puede ser dif√≠cil notar que faltan las macros <code>G_BEGIN_DECLS</code> y <code>G_END_DECLS</code>). Y si surge el deseo, la aplicaci√≥n podr√≠a trasladarse a C ++ de forma incremental.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="include"><a class="header" href="#include">#include</a></h1>
<p>Hay varias formas de organizar los <code>#include</code> en una base de c√≥digo C. La convenci√≥n en GLib/GTK es que incluir un encabezado en un archivo *.c no deber√≠a requerir incluir otro encabezado de antemano.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Esa es la regla general, pero existen excepciones: por ejemplo, incluir <code>glib/gi18n-lib.h</code> requiere que se defina <code>GETTEXT_PACKAGE</code>, este √∫ltimo suele estar presente en el encabezado <code>config.h</code>.</p>
</blockquote>
<p><code>myapp-spell-checker.h</code> contiene el siguiente <code>#include</code>:</p>
<pre><code class="language-c">#include &lt;glib.h&gt;
</code></pre>
<p>Debido a que <code>glib.h</code> es necesario para las macros <code>G_BEGIN_DECLS</code> y <code>G_END_DECLS</code>, para las definiciones de tipos b√°sicos de GLib (<code>gchar</code>, <code>gboolean</code>, etc.) y <code>GSList</code>.</p>
<p>Si se elimina el <code>#include</code> en <code>myapp-spell-checker.h</code>, cada archivo *.c que incluya <code>myapp-spell-checker.h</code> tambi√©n deber√≠a incluir <code>glib.h</code> de antemano; de lo contrario, el compilador no podr√≠a compilar ese archivo *.c. Pero no queremos agregar tal requisito para los usuarios de la clase.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="definici√≥n-de-tipo"><a class="header" href="#definici√≥n-de-tipo">Definici√≥n de tipo</a></h1>
<p>El tipo <code>MyappSpellChecker</code> se define de la siguiente manera:</p>
<pre><code class="language-c">typedef struct _MyappSpellChecker MyappSpellChecker;
</code></pre>
<p>La <code>struct _MyappSpellChecker</code> se declarar√° en el archivo <code>myapp-spell-checker.c</code>. Cuando usa <code>MyappSpellChecker</code> en otro archivo, no deber√≠a necesitar saber qu√© contiene <code>struct</code>, deber√≠a usar las funciones p√∫blicas de la clase en su lugar. La excepci√≥n a la mejor pr√°ctica de OOP es cuando llamar a una funci√≥n ser√≠a un problema de rendimiento, por ejemplo, para estructuras de datos de bajo nivel utilizadas para gr√°ficos por computadora (coordenadas, rect√°ngulos,‚Ä¶). Pero recuerde: <em>la optimizaci√≥n prematura es la ra√≠z de todos los males</em> (Donald Knuth).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="constructor-de-objetos"><a class="header" href="#constructor-de-objetos">Constructor de objetos</a></h1>
<p><code>myapp_spell_checker_new()</code> es el constructor de la clase. Toma un par√°metro de c√≥digo de idioma (por ejemplo <code>&quot;en_US&quot;</code>) y devuelve una <em>instancia</em> de la clase, tambi√©n llamada <em>objeto</em>. Lo que hace la funci√≥n es simplemente asignar din√°micamente la <code>estructura</code> y devolver el puntero. Ese valor de retorno se usa luego como el primer par√°metro de las funciones restantes de la clase. En algunos lenguajes como Python, ese primer par√°metro se llama par√°metro <em>self</em>, ya que hace referencia a &quot;s√≠ mismo&quot;, es decir, a su propia clase. Otros lenguajes orientados a objetos como Java y C ++ tienen la palabra clave <em>this</em> para acceder a los datos del objeto.</p>
<p>Tenga en cuenta que <code>myapp_spell_checker_new()</code> se puede llamar varias veces para crear diferentes objetos. Cada objeto tiene sus propios datos. Esa es la diferencia fundamental con las variables globales: si los datos se almacenan en variables globales, puede haber como m√°ximo una instancia de ellos.</p>
<blockquote>
<p><strong>üìå Nota:</strong> A menos que la variable global almacene los &quot;objetos&quot; en una estructura de datos agregados como una matriz, un lista enlazada o una tabla hash, con un identificador como el par√°metro &quot;<em>self</em>&quot; (por ejemplo, un n√∫mero entero o una cadena) para acceder a un elemento espec√≠fico. Pero este es un c√≥digo realmente desagradable, ¬°por favor no lo hagas!.</p>
</blockquote>
<!-- POR HACER explicar new() (asignaci√≥n en el mont√≥n) vs init() (asignaci√≥n en la pila) y dar un ejemplo con init(). Pero el ejemplo tambi√©n requiere el c√≥digo *.c, por lo que quiz√°s sea mejor agregar la explicaci√≥n en una subsecci√≥n posterior. --><div style="break-before: page; page-break-before: always;"></div><h1 id="destructor-de-objetos"><a class="header" href="#destructor-de-objetos">Destructor de objetos</a></h1>
<p><code>myapp_spell_checker_free()</code> es el destructor de la clase. Destruye un objeto liberando su memoria y liberando otros recursos asignados.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="otras-funciones-p√∫blicas"><a class="header" href="#otras-funciones-p√∫blicas">Otras funciones p√∫blicas</a></h1>
<p>Las funciones <code>myapp_spell_checker_check_word()} y </code>myapp_spell_checker_get_suggestions()` son las caracter√≠sticas disponibles de la clase. Comprueba si una palabra est√° escrita correctamente y obtiene una lista de sugerencias para corregir una palabra mal escrita.</p>
<p>El tipo de par√°metro <code>word_length</code> es <code>gssize</code>, que es un tipo entero GLib que puede contener --- por ejemplo --- el resultado de <code>strlen()</code>, y tambi√©n puede contener un valor negativo ya que --- contrario a <code>gsize</code> --- <code>gssize</code> es un tipo entero <em>con signo</em>. El par√°metro <code>word_length</code> puede ser <code>-1</code> si la cadena est√° terminada en nulo, es decir, si la cadena termina con el car√°cter especial <code>'\0'</code>. El prop√≥sito del par√°metro <code>word_length</code> es poder pasar un puntero a una palabra que pertenece a una cadena m√°s grande, sin la necesidad de llamar, por ejemplo, <code>g_strndup()</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="el-archivo-c-correspondiente"><a class="header" href="#el-archivo-c-correspondiente">El archivo *.c correspondiente</a></h1>
<p>Veamos ahora el archivo <code>myapp-spell-checker.c</code>:</p>
<p><a id="oop-semi-spell-checker-c"></a></p>
<pre><code class="language-c">#include &quot;myapp-spell-checker.h&quot;
#include &lt;string.h&gt;

struct _MyappSpellChecker
{
  gchar *language_code;

  /* Ponga aqui otras estructuras de datos utilizadas
   * para implementar la revision ortografica.
   */
};

static void
load_dictionary (MyappSpellChecker *checker)
{
  /* ... */
};

/**
 * myapp_spell_checker_new:
 * @language_code: el lenguaje del codigo a utlizar.
 *
 * Returns: un nuevo objeto #MyappSpellChecker. Libre con
 * myapp_spell_checker_free().
 */
MyappSpellChecker *
myapp_spell_checker_new (const gchar *language_code)
{
  MyappSpellChecker *checker;

  g_return_val_if_fail (language_code != NULL, NULL);

  checker = g_new0 (MyappSpellChecker, 1);
  checker-&gt;language_code = g_strdup (language_code);

  load_dictionary (checker);

  return checker;
}

/**
 * myapp_spell_checker_free:
 * @checker: un #MyappSpellChecker.
 *
 * Libera @checker.
 */
void
myapp_spell_checker_free (MyappSpellChecker *checker)
{
  if (checker == NULL)
    return;

  g_free (checker-&gt;language_code);
  g_free (checker);
}

/**
 * myapp_spell_checker_check_word:
 * @checker: un #MyappSpellChecker.
 * @word: la palabra para comprobar.
 * @word_length: la longitud de bytes de @word, o -1 si @word
 * es terminado en nulo.
 *
 * Returns: %TRUE si @word esta escrito correctamente, %FALSE
 * de lo contrario.
 */
gboolean
myapp_spell_checker_check_word (MyappSpellChecker *checker,
                                const gchar       *word,
                                gssize             word_length)
{
  g_return_val_if_fail (checker != NULL, FALSE);
  g_return_val_if_fail (word != NULL, FALSE);
  g_return_val_if_fail (word_length &gt;= -1, FALSE);

  /* ... Compruebe si la palabra esta presente en un diccionario. */

  return TRUE;
}

/**
 * myapp_spell_checker_get_suggestions:
 * @checker: un #MyappSpellChecker.
 * @word: una palabra mal escrita.
 * @word_length: la longitud de bytes de @word, o -1 si @word
 * es terminado en nulo.
 *
 * Obtiene las sugerencias para @word. Libera el valor de retorno con
 * g_slist_free_full(suggestions, g_free).
 *
 * Returns: (transfer full) (element-type utf8): la lista de sugerencias.
 */
GSList *
myapp_spell_checker_get_suggestions (MyappSpellChecker *checker,
                                     const gchar       *word,
                                     gssize             word_length)
{
  GSList *suggestions = NULL;

  g_return_val_if_fail (checker != NULL, NULL);
  g_return_val_if_fail (word != NULL, NULL);
  g_return_val_if_fail (word_length &gt;= -1, NULL);

  if (word_length == -1)
    word_length = strlen (word);

  if (strncmp (word, &quot;punchness&quot;, word_length) == 0)
    suggestions = g_slist_prepend (suggestions,
                                   g_strdup (&quot;punchiness&quot;));

  return suggestions;
}
</code></pre>
<div class="caption">
<p><span class="oop-semi-spell-checker-c">Listado</span>: myapp-spell-checker.c</p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="oop-semi-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="orden-de-include"><a class="header" href="#orden-de-include">Orden de #include</a></h1>
<p>En la parte superior del archivo, se encuentra la lista habitual de <code>#include</code>. Un detalle peque√±o pero digno de menci√≥n es que el orden de inclusi√≥n no se eligi√≥ al azar. En cierto archivo *.c, es mejor incluir primero su archivo *.h correspondiente, y luego los otros encabezados.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Excepto si tiene un archivo <code>config.h</code>, en ese caso deber√≠a <code>config.h</code>, <em>luego</em> el *.h correspondiente, y luego los otros encabezados.</p>
</blockquote>
<p>Al incluir la primera <code>myapp-spell-checker.h</code>, si falta un <code>#include</code> en <code>myapp-spell-checker.h</code>, el compilador informar√° un error. Como se explica en la secci√≥n <span class="ch-oop-semi-header-include"></span>, un encabezado siempre debe tener el m√≠nimo requerido <code>#include</code>s para que ese encabezado se incluya a su vez.</p>
<p>Adem√°s, dado que <code>glib.h</code> ya est√° incluido en <code>myapp-spell-checker.h</code>, no es necesario incluirlo una segunda vez en <code>myapp-spell-checker.c</code>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="comentarios-de-gtk-doc"><a class="header" href="#comentarios-de-gtk-doc">Comentarios de GTK-Doc</a></h1>
<p>La API p√∫blica est√° documentada con comentarios GTK-Doc. Un comentario de GTK-Doc comienza con <code>/**</code>, con el nombre del s√≠mbolo a documentar en la siguiente l√≠nea. Cuando nos referimos a un s√≠mbolo, existe una sintaxis especial a utilizar dependiendo del tipo de s√≠mbolo:</p>
<ul>
<li>Un par√°metro de funci√≥n tiene el prefijo <code>@</code>.</li>
<li>El <em>nombre</em> de una <code>estructura</code> o <code>enum</code> tiene el prefijo <code>#</code>.</li>
<li>Una constante (por ejemplo, una <code>enum</code> <em>valor</em>) tiene el prefijo <code>%</code>.</li>
<li>Una funci√≥n tiene el sufijo <code>()</code>.</li>
</ul>
<p>GTK-Doc puede analizar esos comentarios especiales y generar p√°ginas HTML que luego pueden ser navegadas f√°cilmente por un navegador API como Devhelp. Pero los comentarios especialmente formateados en el c√≥digo no son lo √∫nico que necesita GTK-Doc, tambi√©n necesita integraci√≥n con el sistema de compilaci√≥n de su proyecto (por ejemplo, Autotools), junto con algunos otros archivos para enumerar las diferentes p√°ginas, describe el estructura general con la lista de s√≠mbolos y, opcionalmente, proporciona contenido adicional escrito en formato DocBook XML. Estos archivos suelen estar presentes en el directorio <code>docs/reference/</code>.</p>
<p>Describir en detalle c√≥mo integrar el soporte GTK-Doc en su c√≥digo est√° m√°s all√° del alcance de este libro. Para eso, debe consultar el manual de GTK-Doc <span class="gtk-doc"></span>.</p>
<p>Cada biblioteca basada en GLib debe tener una documentaci√≥n GTK-Doc. Pero tambi√©n es √∫til escribir una documentaci√≥n GTK-Doc para el c√≥digo interno de una aplicaci√≥n. Como se explica en la secci√≥n <span class="ch-intro-separate-backend"></span>, es una buena pr√°ctica separar el backend de una aplicaci√≥n de su(s) frontend(s), y escribir el backend como una biblioteca interna o, m√°s tarde, una biblioteca compartida. Como tal, se recomienda documentar la API p√∫blica del backend con GTK-Doc, incluso si sigue siendo una biblioteca interna vinculada est√°ticamente. Porque cuando el c√≥digo base se vuelve m√°s grande, es de gran ayuda (especialmente para los reci√©n llegados) tener una descripci√≥n general de las clases disponibles y saber c√≥mo usar una clase sin la necesidad de comprender su implementaci√≥n.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="ch-refs"></div>
<div class="biblio-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="anotaciones-de-introspecci√≥n-de-gobject"><a class="header" href="#anotaciones-de-introspecci√≥n-de-gobject">Anotaciones de introspecci√≥n de GObject</a></h1>
<p>El comentario de GTK-Doc para la funci√≥n <code>myapp_spell_checker_get_suggestions()</code> contiene anotaciones de GObject Introspection para el valor de retorno:</p>
<pre><code class="language-c">/**
 * ...
 * Returns: (transfer full) (element-type utf8): la lista de sugerencias.
 */
</code></pre>
<p>El tipo de retorno de la funci√≥n es <code>GSList *</code>, que no es suficiente para que los enlaces de idioma sepan qu√© contiene la lista, y c√≥mo liberarla. <span class="text-monospace">(transferencia completa)</span> significa que la persona que llama debe liberar completamente el valor de retorno: la lista misma <em>y</em> sus elementos. <span class="text-monospace">(tipo de elemento utf8)</span> significa que la lista contiene cadenas UTF-8.</p>
<p>Para obtener un valor de retorno, si la anotaci√≥n de transferencia es <span class="text-monospace">contenedor de transferencia</span>, la persona que llama necesita liberar solo la estructura de datos, no sus elementos. Y si la anotaci√≥n de transferencia es <span class="text-monospace">transferir ninguna</span>, la propiedad del contenido variable no se transfiere y, por lo tanto, la persona que llama no debe liberar el valor de retorno.</p>
<p>Hay muchas otras anotaciones de GObject Introspection (GI), por nombrar solo un par de otras:</p>
<ul>
<li><code>(nullable)</code>: el valor puede ser <code>NULL</code>;</li>
<li><code>(out)</code>: un par√°metro de funci√≥n &quot;out&quot;, es decir, un par√°metro que devuelve un valor.</li>
</ul>
<p>Como puede ver, las anotaciones GI no solo son √∫tiles para los enlaces de idiomas, sino que tambi√©n recopilan informaci√≥n √∫til para el programador de C.</p>
<p>Para obtener una lista completa de anotaciones GI, consulte la wiki de GObject Introspection <span class="gobject-introspection"></span>.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-biblio"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="funciones-est√°ticas-vs-funciones-no-est√°ticas"><a class="header" href="#funciones-est√°ticas-vs-funciones-no-est√°ticas">Funciones est√°ticas vs funciones no est√°ticas</a></h1>
<p>En el c√≥digo de ejemplo, puede ver que la funci√≥n <code>load_dictionary()</code> se ha marcado como <code>static</code>. De hecho, es una buena pr√°ctica en C marcar las funciones internas como <code>static</code>. Una funci√≥n <code>static</code> solo se puede usar en el mismo archivo *.c. Por otro lado, una funci√≥n p√∫blica debe ser no est√°tica y tener un prototipo en un encabezado.</p>
<p>Existe la opci√≥n de advertencia <code>-Wmissing-prototypes</code> GCC para garantizar que un fragmento de c√≥digo siga esta convenci√≥n.</p>
<blockquote>
<p><strong>üìå Nota:</strong> Cuando se usan las herramientas autom√°ticas, la macro <code>AX\_COMPILER\_FLAGS</code> Autoconf habilita, entre otras cosas, esa bandera GCC.</p>
</blockquote>
<p>Adem√°s, contrariamente a una funci√≥n p√∫blica, una funci√≥n <code>static</code> no requiere que el proyecto y los espacios de nombres de la clase tengan el prefijo (aqu√≠, <code>myapp_spell_checker</code>).</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="programaci√≥n-defensiva"><a class="header" href="#programaci√≥n-defensiva">Programaci√≥n defensiva</a></h1>
<p>Cada funci√≥n p√∫blica verifica sus precondiciones con las macros de depuraci√≥n de <code>g_return_if_fail()</code> o <code>g_return_val_if_fail()</code>, como se describe en la secci√≥n <span class="ch-glib-dbg-macros"></span>. El par√°metro <em>self</em> tambi√©n se verifica, para ver si no es <code>NULL</code>, excepto por el destructor, <code>myapp_spell_checker_free()</code>, para que sea consistente con <code>free()</code> y <code>g_free()</code> que acepta un par√°metro <code>NULL</code> por conveniencia.</p>
<p>Tenga en cuenta que las macros <code>g_return</code> deben usarse solo para los puntos de entrada de una clase, es decir, en sus funciones p√∫blicas. Por lo general, puede asumir que los par√°metros pasados a una funci√≥n <code>static</code> son v√°lidos, especialmente el par√°metro <em>self</em>. Sin embargo, a veces es √∫til verificar un argumento de una funci√≥n <code>static</code> con <code>g_assert()</code>, para hacer que el c√≥digo sea m√°s robusto y auto-documentado.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="estilo-de-codificaci√≥n"><a class="header" href="#estilo-de-codificaci√≥n">Estilo de codificaci√≥n</a></h1>
<p>Finalmente, vale la pena explicar algunas cosas sobre el estilo de codificaci√≥n. Se le anima a utilizar desde el principio el mismo estilo de codificaci√≥n para su proyecto, ya que puede ser algo dif√≠cil de cambiar despu√©s. Si cada programa tiene diferentes convenciones de c√≥digo, es una pesadilla para alguien dispuesto a contribuir.</p>
<p>Aqu√≠ hay un ejemplo de una definici√≥n de funci√≥n:</p>
<pre><code class="language-c">gboolean
myapp_spell_checker_check_word (MyappSpellChecker *checker,
                                const gchar       *word,
                                gssize             word_length)
{
  /* ... */
}
</code></pre>
<p>Vea c√≥mo se alinean los par√°metros: hay un par√°metro por l√≠nea, con el tipo alineado en el par√©ntesis de apertura y con los nombres alineados en la misma columna. Algunos editores de texto se pueden configurar para hacerlo autom√°ticamente.</p>
<p>Para una funci√≥n <em>call</em>, si poner todos los par√°metros en la misma l√≠nea da como resultado una l√≠nea demasiado larga, los par√°metros tambi√©n deben estar alineados entre par√©ntesis, para que el c√≥digo sea m√°s f√°cil de leer:</p>
<pre><code class="language-c">  function_call (one_param,
                 another_param,
                 yet_another_param);
</code></pre>
<p>A diferencia de otros proyectos como el kernel de Linux, no existe realmente un l√≠mite en la longitud de la l√≠nea. Un c√≥digo basado en GObject puede tener l√≠neas bastante largas, incluso si los par√°metros de una funci√≥n est√°n alineados entre par√©ntesis. Por supuesto, si una l√≠nea termina en, digamos, la columna 120, podr√≠a significar que hay demasiados niveles de sangr√≠a y que deber√≠a extraer el c√≥digo en funciones intermedias.</p>
<p>El tipo de retorno de una funci√≥n <em>definition</em> est√° en la l√≠nea anterior que el nombre de la funci√≥n, por lo que el nombre de la funci√≥n est√° al principio de la l√≠nea. Al escribir una funci√≥n <em>prototype</em>, el nombre de la funci√≥n nunca debe estar al principio de una l√≠nea, idealmente debe estar en la misma l√≠nea que el tipo de retorno.</p>
<blockquote>
<p><strong>üìå Nota:</strong> En <code>myapp-spell-checker.h</code>, los nombres de las funciones est√°n sangrados con dos espacios en lugar de estar en las mismas l√≠neas que los tipos de retorno, porque no hay suficiente espacio horizontal en la p√°gina.</p>
</blockquote>
<p>De esa manera, puede hacer una b√∫squeda de expresi√≥n regular para encontrar la implementaci√≥n de una funci√≥n, por ejemplo, con el comando de shell <code>grep</code>:</p>
<pre><code class="language-bash">$ grep -n -E &quot;^function_name&quot; *.c
</code></pre>
<p>O, si el c√≥digo est√° dentro de un repositorio de Git, es un poco m√°s conveniente de usar <code>git grep</code>:</p>
<pre><code class="language-bash">$ git grep -n -E &quot;^function_name&quot;
</code></pre>
<p>Asimismo, existe una manera f√°cil de encontrar la declaraci√≥n de una <code>struct</code> p√∫blica. La convenci√≥n es prefijar el nombre del tipo con un gui√≥n bajo al declarar la <code>struct</code>. Por ejemplo:</p>
<pre><code class="language-c">/* En el encabezado: */
typedef struct _MyappSpellChecker MyappSpellChecker;

/* En el archivo *.c: */
struct _MyappSpellChecker
{
  /* ... */
};
</code></pre>
<p>Como resultado, para encontrar la declaraci√≥n completa del tipo <code>MyappSpellChecker</code>, puede buscar &quot;<code>_MyappSpellChecker</code>&quot;:</p>
<pre><code class="language-bash">$ git grep -n _MyappSpellChecker
</code></pre>
<p>En GLib/GTK, esta convenci√≥n de prefijo de subrayado se aplica normalmente a cada <code>struct</code> que tiene una l√≠nea <code>typedef</code> separada. La convenci√≥n no se sigue a fondo cuando se usa una <code>struct</code> en un solo archivo *.c. Y la convenci√≥n generalmente no se sigue para los tipos <code>enum</code>. Sin embargo, para su proyecto, nada le impide aplicar consistentemente la convenci√≥n de prefijo de subrayado a todos los tipos.</p>
<p>Tenga en cuenta que existen herramientas m√°s sofisticadas que <code>grep</code> para examinar una base de c√≥digo C, por ejemplo, <a href="http://cscope.sourceforge.net/">Cscope</a>.</p>
<p>Para aprender m√°s sobre el estilo de codificaci√≥n usado en GLib, GTK y GNOME, lea las Pautas de programaci√≥n de GNOME <span class="gnome-programming-guidelines"></span>.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="biblio-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="una-suave-introducci√≥n-a-gobject"><a class="header" href="#una-suave-introducci√≥n-a-gobject">Una suave introducci√≥n a GObject</a></h1>
<p>En el cap√≠tulo anterior hemos aprendido a escribir c√≥digo semi-orientado a objetos en C. As√≠ es como se escriben las clases en GLib core. GObject avanza varios pasos en la programaci√≥n orientada a objetos, con herencia, interfaces, funciones virtuales, etc. GObject tambi√©n simplifica el paradigma de programaci√≥n dirigida por eventos, con se√±ales y propiedades.</p>
<p>Se recomienda crear sus propias clases de GObject para escribir una aplicaci√≥n GLib/GTK. Desafortunadamente, el c√≥digo es un poco detallado, porque el lenguaje C no est√° orientado a objetos. El c√≥digo repetitivo es necesario para algunas funciones, pero no tenga miedo, existen herramientas y scripts para generar el modelo repetitivo.</p>
<p>Sin embargo, este cap√≠tulo da un paso atr√°s del cap√≠tulo anterior, es solo una peque√±a introducci√≥n a GObject; explicar√° las cosas esenciales para saber c√≥mo <em>usar</em> una clase GObject existente (como todos los widgets y clases GTK en GIO). No explicar√° c√≥mo <em>crear</em> sus propias clases de GObject, porque ya est√° bien cubierto en el manual de referencia de GObject, y el objetivo de este libro no es duplicar todo el contenido de los manuales de referencia, el objetivo es m√°s para que sirva de gu√≠a de introducci√≥n.</p>
<p>Entonces, para obtener informaci√≥n m√°s detallada sobre GObject y saber c√≥mo crear subclases, la documentaci√≥n de referencia de GObject contiene cap√≠tulos introductorios: &quot;<em>Conceptos</em>&quot; y &quot;<em>Tutorial</em>&quot;, disponibles en:</p>
<p><a href="https://docs.gtk.org/gobject/">https://docs.gtk.org/gobject/</a></p>
<p>Para explicar ciertos conceptos, se toman algunos ejemplos de GTK o GIO. Al leer este cap√≠tulo, se le anima a abrir Devhelp en paralelo, para mirar la referencia de API y ver por s√≠ mismo c√≥mo se documenta una biblioteca basada en GObject. El objetivo es que seas aut√≥nomo y puedas aprender cualquier clase nueva de GObject, ya sea en GIO, GTK o cualquier otra biblioteca.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="herencia"><a class="header" href="#herencia">Herencia</a></h1>
<p>Un concepto importante de OOP es la herencia. Una clase puede ser una subclase de una clase principal. La subclase hereda las caracter√≠sticas de la clase padre, extendiendo o anulando su comportamiento.</p>
<p>La biblioteca GObject proporciona la clase base <code>GObject</code>. Cada clase en GIO y GTK hereda, directa o indirectamente, de la clase base <code>GObject</code>. Al mirar una clase basada en GObject, la documentaci√≥n (si est√° escrita con GTK-Doc) siempre contiene una <em>Jerarqu√≠a de objetos</em>. Por ejemplo, <code>GtkApplication</code> tiene la siguiente jerarqu√≠a de objetos:</p>
<pre><code class="language-plaintext">GObject
‚îî‚îÄ‚îÄ GApplication
    ‚îî‚îÄ‚îÄ GtkApplication
</code></pre>
<p>Significa que cuando crea un objeto <code>GtkApplication</code>, tambi√©n tiene acceso a las funciones, se√±ales y propiedades de <code>GApplication</code> (implementado en GIO) y <code>GObject</code>. Por supuesto, las funciones <code>g_application_*</code> toman como primer argumento una variable de tipo &quot;<code>GApplication *</code>&quot;, no &quot;<code>GtkApplication *</code>&quot;. Para convertir la variable en el tipo correcto, la forma recomendada es usar la macro <code>G_APPLICATION()</code>. Por ejemplo:</p>
<pre><code class="language-c">GtkApplication *app;

g_application_mark_busy (G_APPLICATION (app));
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="macros-de-gobject"><a class="header" href="#macros-de-gobject">Macros de GObject</a></h1>
<p>Cada clase de GObject proporciona un conjunto de macros est√°ndar. La macro <code>G_APPLICATION()</code> como se demostr√≥ en la secci√≥n anterior es una de las macros est√°ndar proporcionadas por la clase <code>GApplication</code>.</p>
<p>No todas las macros est√°ndar de GObject se explicar√°n aqu√≠, solo las macros √∫tiles para <em>usar</em> un GObject de una manera b√°sica. Las otras macros son m√°s avanzadas y generalmente son √∫tiles solo cuando se subclasifica una clase GObject, cuando se crea una propiedad o una se√±al, o cuando se reemplaza una funci√≥n virtual.</p>
<p>Cada clase GObject define una macro de la forma <code>NAMESPACE_CLASSNAME(object)</code>, que convierte la variable al tipo &quot;<code>NamespaceClassname *</code>&quot; y comprueba en tiempo de ejecuci√≥n si la variable contiene correctamente un <code>NamespaceClassname</code> objeto o una subclase del mismo. Si la variable es <code>NULL</code> o contiene un objeto incompatible, la macro imprime un mensaje de advertencia cr√≠tico en la consola y devuelve NULL.</p>
<p>Un elenco est√°ndar tambi√©n funciona, pero la mayor√≠a de las veces no se recomienda porque no hay comprobaciones de tiempo de ejecuci√≥n:</p>
<pre><code class="language-c">GtkApplication *app;

/* No recomendado */
g_application_mark_busy ((GApplication *) app);
</code></pre>
<p>Otra macro √∫til cuando se usa un GObject es <code>NAMESPACE_IS_CLASSNAME(object)</code>, que devuelve <code>TRUE</code> si la variable es un objeto <code>NamespaceClassname</code> o una subclase del mismo.</p>
<!-- POR HACER mostrar un ejemplo de una funci√≥n que verifica sus argumentos con g_return? -->
<div style="break-before: page; page-break-before: always;"></div><h1 id="interfaces"><a class="header" href="#interfaces">Interfaces</a></h1>
<p>Con GObject es posible crear interfaces. Una interfaz es solo una API, no contiene la implementaci√≥n. Una clase GObject puede implementar una o varias interfaces. Si una clase GObject est√° documentada con GTK-Doc, la documentaci√≥n contendr√° una secci√≥n <em>Interfaces implementadas</em>.</p>
<p>Por ejemplo, GTK contiene la interfaz <code>GtkOrientable</code> que es implementada por muchos widgets y permite establecer la orientaci√≥n: horizontal o vertical.</p>
<p>Las dos macros explicadas en la secci√≥n anterior tambi√©n funcionan para interfaces. Un ejemplo con <code>GtkGrid</code>:</p>
<pre><code class="language-c">GtkWidget *vgrid;

vgrid = gtk_grid_new ();
gtk_orientable_set_orientation (GTK_ORIENTABLE (vgrid),
                                GTK_ORIENTATION_VERTICAL);
</code></pre>
<p>Entonces, cuando busca una determinada caracter√≠stica en la API para una cierta clase de GObject, la caracter√≠stica se puede ubicar en tres lugares diferentes:</p>
<ul>
<li>En la propia clase GObject;</li>
<li>En una de las clases padre en <em>Jerarqu√≠a de objetos</em>;</li>
<li>O en una de las <em>Interfaces implementadas</em>.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="recuento-de-referencias"><a class="header" href="#recuento-de-referencias">Recuento de referencias</a></h1>
<p>La gesti√≥n de la memoria de las clases de GObject se basa en <em>recuento de referencias</em>. Una clase GObject tiene un contador:</p>
<ul>
<li>Cuando se crea el objeto, el contador es igual a uno;</li>
<li><code>g_object_ref()</code> incrementa el contador;</li>
<li><code>g_object_unref()</code> disminuye el contador;</li>
<li>Si el contador llega a cero, el objeto se libera.</li>
</ul>
<p>Permite almacenar el GObject en varios lugares sin necesidad de coordinar cu√°ndo liberar el objeto.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="evitar-ciclos-de-referencia-con-referencias-d√©biles"><a class="header" href="#evitar-ciclos-de-referencia-con-referencias-d√©biles">Evitar ciclos de referencia con referencias d√©biles</a></h1>
<p>Si el objeto A hace referencia al objeto B y el objeto B hace referencia al objeto A, hay un ciclo de referencia y los dos objetos nunca se liberar√°n. Para evitar ese problema, existe el concepto de referencias &quot;d√©biles&quot;. Al llamar a <code>g_object_ref()</code>, es una referencia &quot;s√≥lida&quot;. Entonces, en una direcci√≥n hay una referencia fuerte, y en la otra direcci√≥n debe haber una referencia d√©bil (o ninguna referencia).</p>
<p><a id="oop-gobject-weak-ref-schema"></a></p>
<div class="caption">
<img src="content/oop-gobj/ref-cnt/../../../assets/img/diag/weak-ref.svg" alt="" width="32%" />
<p><span class="oop-gobject-weak-ref-schema">Figura</span>: Usar una referencia d√©bil para romper <br /> el ciclo de referencia entre A y B.</p>
</div>
<p>En la <span class="oop-gobject-weak-ref-schema">Figura</span> podemos ver que el objeto A tiene una fuerte referencia al objeto B, y el objeto B tiene una d√©bil referencia al objeto A.</p>
<p>Se puede crear una referencia d√©bil con <code>g_object_add_weak_pointer()</code> o <code>g_object_weak_ref()</code>. Al igual que con las referencias fuertes, es importante liberar la referencia cuando ya no se necesite, generalmente en el destructor de clases. Una referencia d√©bil debe eliminarse con <code>g_object_remove_weak_pointer()</code> o <code>g_object_weak_unref()</code>. Entonces, en la <span class="oop-gobject-weak-ref-schema">Figura</span>, el destructor de la clase B debe eliminar la referencia d√©bil si a√∫n no lo ha hecho.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="oop-gobj-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="referencias-flotantes"><a class="header" href="#referencias-flotantes">Referencias flotantes</a></h1>
<p>Cuando una clase GObject hereda de <code>GInitiallyUnowned</code> (que es el caso de <code>GtkWidget</code>), el objeto inicialmente tiene una referencia <em>floating</em>. Se debe llamar a <code>g_object_ref_sink()</code> para convertir esa referencia flotante en una referencia normal y fuerte.</p>
<p>Cuando un GObject hereda de <code>GInitiallyUnowned</code>, significa que GObject debe incluirse en alg√∫n tipo de contenedor. El contenedor luego asume la propiedad de la referencia flotante, llamando a <code>g_object_ref_sink()</code>. Permite simplificar el c√≥digo, para eliminar la necesidad de llamar a <code>g_object_unref()</code> despu√©s de incluir el objeto en el contenedor.</p>
<p>El <span class="oop-gobject-mem-management-normal">Listado</span> muestra c√≥mo se maneja la administraci√≥n de memoria con un GObject normal. Compare esto con el <span class="oop-gobject-mem-management-floating">Listado</span>, que muestra c√≥mo se maneja la administraci√≥n de memoria con un GObject derivado de <code>GInitiallyUnowned</code>. La diferencia es que <code>g_object_unref()</code> no se llama en el √∫ltimo Listado, por lo que acorta el c√≥digo.</p>
<p><a id="oop-gobject-mem-management-normal"></a></p>
<pre><code class="language-c">/* GObject normal */

a_normal_gobject = normal_gobject_new ();
/* a_normal_gobject tiene ahora un recuento de referencia de 1. */

container_add (container, a_normal_gobject);
/* a_normal_gobject tiene ahora un recuento de referencia de 2. */

/* Ya no necesitamos un a_normal_gobject, por lo que lo anulamos. */
g_object_unref (a_normal_gobject);
/* a_normal_gobject tiene ahora un recuento de referencia de 1. */
</code></pre>
<div class="caption">
<p><span class="oop-gobject-mem-management-normal">Listado</span>: Gesti√≥n de la memoria de GObjects normales.</p>
</div>
<p><a id="oop-gobject-mem-management-floating"></a></p>
<pre><code class="language-c">/* Objeto GInitiallyUnowned, p. Ej. un GtkWidget */

widget = gtk_entry_new ();
/* widget tiene ahora solo una referencia flotante. */

gtk_container_add (container, widget);
/* El contenedor ha llamado a g_object_ref_sink(), tomando
 * posesion de la referencia flotante. El codigo esta
 * simplificado porque no debemos llamar a g_object_unref().
 */
</code></pre>
<div class="caption">
<p><span class="oop-gobject-mem-management-floating">Listado</span>: Gesti√≥n de memoria de GObjects derivados de <code>GInitiallyUnowned</code>.</p>
</div>
<p>Entonces, es importante saber si un GObject hereda de <code>GInitiallyUnowned</code> o no. Para eso, debe mirar la <em>Object Hierarchy</em>, por ejemplo, <code>GtkEntry</code> tiene la siguiente jerarqu√≠a:</p>
<pre><code class="language-plaintext">GObject
‚îî‚îÄ‚îÄ GInitiallyUnowned
    ‚îî‚îÄ‚îÄ GtkWidget
        ‚îî‚îÄ‚îÄ GtkEntry
</code></pre>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="oop-gobj-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="se√±ales-y-propiedades"><a class="header" href="#se√±ales-y-propiedades">Se√±ales y propiedades</a></h1>
<p>Una clase GObject puede emitir se√±ales. Con el bucle de eventos principal GLib (explicado anteriormente en la secci√≥n <span class="ch-glib-main-loop">El bucle del evento principal</span>, esta es la base para la programaci√≥n dirigida por eventos. Un ejemplo de se√±al es cuando el usuario hace clic en un bot√≥n. La aplicaci√≥n conecta una funci√≥n de devoluci√≥n de llamada a la se√±al para realizar la acci√≥n deseada cuando ocurre el evento.</p>
<p>Otro concepto de GObject son las <em>propiedades</em>, que est√° relacionado con las se√±ales. Una propiedad es b√°sicamente una variable de instancia coronada con una se√±al de <code>&quot;notify&quot;</code> que se emite cuando cambia su valor. Un buen ejemplo de una propiedad es el estado de un bot√≥n de verificaci√≥n, es decir, un valor booleano que describe si el bot√≥n est√° actualmente marcado o no. Cuando el estado cambia, se env√≠a la se√±al <code>&quot;notify&quot;</code>.</p>
<p>Para crear sus propias se√±ales o propiedades, se debe crear una subclase GObject. Como se explic√≥ en la introducci√≥n de este cap√≠tulo, esto est√° m√°s all√° del alcance de este libro, pero debe tener en cuenta que, por supuesto, es posible y recomendable crear sus propias se√±ales o propiedades. De hecho, crear una se√±al o propiedad de GObject es una buena manera de implementar el patr√≥n de dise√±o Observer <span class="design-patterns-book"></span>; es decir, uno o varios objetos <em>observando</em> cambios de estado de otro objeto, conectando devoluciones de llamada de funci√≥n. El objeto que <em>emite</em> la se√±al no sabe qu√© objetos <em>reciben</em> la se√±al. GObject solo realiza un seguimiento de la lista de devoluciones de llamada para llamar. Entonces, agregar una se√±al permite desacoplar clases.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div>
<div class="biblio-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="conexi√≥n-de-una-funci√≥n-de-devoluci√≥n-de-llamada-a-una-se√±al"><a class="header" href="#conexi√≥n-de-una-funci√≥n-de-devoluci√≥n-de-llamada-a-una-se√±al">Conexi√≥n de una funci√≥n de devoluci√≥n de llamada a una se√±al</a></h1>
<p>Para hacer las cosas m√°s concretas, si observa la documentaci√≥n de <code>GtkButton</code>, ver√° que proporciona la se√±al <code>&quot;clicked&quot;</code>. Para realizar la acci√≥n deseada cuando se emite la se√±al, una o m√°s funciones de devoluci√≥n de llamada deben estar conectadas de antemano.</p>
<p>Para conectar una devoluci√≥n de llamada a una se√±al, se puede usar la funci√≥n <code>g_signal_connect()</code>, o una de las otras funciones <code>g_signal_connect_*()</code>:</p>
<ul>
<li><code>g_signal_connect()</code></li>
<li><code>g_signal_connect_after()</code></li>
<li><code>g_signal_connect_swapped()</code></li>
<li><code>g_signal_connect_data()</code></li>
<li><code>g_signal_connect_object()</code></li>
<li>Y algunas m√°s avanzadas.</li>
</ul>
<p>El <span class="oop-gobject-gtkbutton-clicked">Listado</span> muestra el prototipo de la se√±al <code>GtkButton::clicked</code>.</p>
<blockquote>
<p><strong>üìå Nota:</strong> La convenci√≥n cuando se hace referencia a una se√±al de GObject es &quot;<code>ClassName::signal-name</code>&quot;. As√≠ es como se documenta con los comentarios de GTK-Doc.</p>
</blockquote>
<p><a id="oop-gobject-gtkbutton-clicked"></a></p>
<pre><code class="language-c">void
user_function (GtkButton *button,
               gpointer   user_data);
</code></pre>
<div class="caption">
<p><span class="oop-gobject-gtkbutton-clicked">Listado</span>: El prototipo de la se√±al <code>GtkButton::clicked</code>.</p>
</div>
<p>Cuando se usa <code>g_signal_connect()</code>, la funci√≥n de devoluci√≥n de llamada debe tener el mismo prototipo que el prototipo de se√±al. Muchas se√±ales tienen m√°s argumentos y algunas se√±ales devuelven un valor. Si la devoluci√≥n de llamada tiene un prototipo incompatible, suceder√°n cosas malas, habr√° errores o bloqueos aleatorios.</p>
<p>El <span class="oop-gobject-connect-to-signal">Listado</span> muestra un ejemplo de c√≥mo usar <code>g_signal_connect()</code>.</p>
<p><a id="oop-gobject-connect-to-signal"></a></p>
<pre><code class="language-c">static void
button_clicked_cb (GtkButton *button,
                   gpointer   user_data)
{
  MyClass *my_class = MY_CLASS (user_data);

  g_message (&quot;Boton pulsado!&quot;);
}

static void
create_button (MyClass *my_class)
{
  GtkButton *button;

  /* Crea el boton */
  /* ... */

  /* Conectar la funcion de devolucion de llamada */
  g_signal_connect (button,
                    &quot;clicked&quot;,
                    G_CALLBACK (button_clicked_cb),
                    my_class);
}
</code></pre>
<div class="caption">
<p><span class="oop-gobject-connect-to-signal">Listado</span>: C√≥mo conectarse a una se√±al</p>
</div>
<p>La macro <code>G_CALLBACK()</code> es necesaria porque <code>g_signal_connect()</code> es gen√©rica: se puede usar para conectarse a cualquier se√±al de cualquier clase de GObject, por lo que el puntero de funci√≥n debe ser convertido.</p>
<p>Hay dos convenciones principales para nombrar funciones de devoluci√≥n de llamada:</p>
<ul>
<li>Termine el nombre de la funci√≥n con &quot;<code>cb</code>&quot;, atajo de &quot;callback&quot;. Por ejemplo: <code>button_clicked_cb()</code> como en el ejemplo de c√≥digo anterior.</li>
<li>Inicie el nombre de la funci√≥n con &quot;<code>on</code>&quot;. Por ejemplo: <code>on_button_clicked()</code>.</li>
</ul>
<p>Con una de esas convenciones de nomenclatura --- y con el par√°metro <code>gpointer user_data</code>, que siempre es el √∫ltimo par√°metro --- es f√°cil reconocer que una funci√≥n es una devoluci√≥n de llamada.</p>
<p>El lenguaje C permite escribir una firma de funci√≥n de devoluci√≥n de llamada diferente --- pero compatible ---, aunque no se considera universalmente como algo bueno:</p>
<ul>
<li>Uno o m√°s de los <em>√∫ltimos</em> argumentos de la funci√≥n se pueden omitir si no se utilizan. Pero como se explic√≥ anteriormente, el argumento <code>gpointer user_data</code> permite reconocer f√°cilmente que la funci√≥n es efectivamente una devoluci√≥n de llamada.</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> Al igual que con los lenguajes naturales, la redundancia permite comprender mejor y m√°s r√°pidamente lo que leemos o escuchamos.</p>
</blockquote>
<ul>
<li>Los tipos de argumentos se pueden modificar a un tipo compatible: p. Ej. otra clase en la jerarqu√≠a de herencia, o en el ejemplo anterior, reemplazando &quot;<code>gpointer</code>&quot; por &quot;<code>MyClass *</code>&quot; (pero hacer eso hace que el c√≥digo sea un poco menos robusto porque <code>No se llama a la macro MY_CLASS()</code>).</li>
</ul>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="oop-gobj-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="desconexi√≥n-de-controladores-de-se√±ales"><a class="header" href="#desconexi√≥n-de-controladores-de-se√±ales">Desconexi√≥n de controladores de se√±ales</a></h1>
<p>En el <span class="oop-gobject-connect-to-signal">Listado</span>, se llama a <code>button_clicked_cb()</code> cada vez que el objeto <code>button</code> emite la se√±al <code>&quot;clicked&quot;</code>. Si el objeto <code>button</code> todav√≠a est√° vivo despu√©s de que <code>my_class</code> se haya liberado, cuando la se√±al se emita nuevamente habr√° un peque√±o problema ... Entonces, en el destructor de <code>MyClass</code>, el manejador de se√±ales (es decir, la devoluci√≥n de llamada) debe desconectarse. ¬øComo hacer eso?</p>
<p>Las funciones <code>g_signal_connect*()</code> en realidad devuelven un ID del manejador de se√±ales, como un entero <code>gulong</code> siempre mayor que 0 (para conexiones exitosas). Al almacenar ese ID, es posible desconectar ese manejador de se√±al espec√≠fico con la funci√≥n <code>g_signal_handler_disconnect()</code>.</p>
<p>A veces tambi√©n queremos desconectar el controlador de se√±ales simplemente porque ya no estamos interesados en el evento.</p>
<p>El <span class="oop-gobject-disconnect-signal">Listado</span> muestra un ejemplo completo de c√≥mo desconectar un manejador de se√±ales cuando se libera su argumento <code>user_data</code>. Volvemos a un ejemplo con un corrector ortogr√°fico, porque el ejemplo con el bot√≥n GTK no se ajusta bien a la situaci√≥n.</p>
<blockquote>
<p><strong>üìå Nota:</strong> La mayor√≠a de las veces, un widget GTK no vive m√°s tiempo que el contenedor al que se agrega, y el El objeto que escucha la se√±al del widget suele ser el propio contenedor. Entonces, si el widget muere al mismo tiempo que el contenedor, no es posible que el widget env√≠e una se√±al mientras su contenedor ya ha sido destruido. En ese caso, no tiene sentido desconectar la se√±al en el destructor del contenedor, ya que en ese punto el widget ya est√° liberado; y es m√°s dif√≠cil para un objeto muerto enviar una se√±al.</p>
</blockquote>
<blockquote>
<p><strong>üìå Nota:</strong> Cuando digo que es m√°s dif√≠cil, en realidad es imposible, por supuesto.</p>
</blockquote>
<!-- GObject es aburrido, por lo que un poco de humor no duele, una nota al pie dentro de una nota al pie, recepci√≥n al pie :-) -->
<p>El argumento de devoluci√≥n de llamada <code>user_data</code> es una instancia de <code>MyTextView</code>, con <code>MyTextView</code> implementado con un estilo semi-OOP. Dado que el objeto del corrector ortogr√°fico puede vivir m√°s tiempo que la instancia de <code>MyTextView</code>, la se√±al debe desconectarse en el destructor <code>MyTextView</code>.</p>
<p><a id="oop-gobject-disconnect-signal"></a></p>
<pre><code class="language-c">#include &lt;glib-object.h&gt;

typedef struct _MyTextView MyTextView;

struct _MyTextView
{
  GspellChecker *spell_checker;
  gulong word_added_to_personal_handler_id;
};

static void
word_added_to_personal_cb (GspellChecker *spell_checker,
                           const gchar   *word,
                           gpointer       user_data)
{
  MyTextView *text_view = user_data;

  g_message (&quot;La palabra '%s' se ha agregado al diccionario personal &quot;
             &quot;del usuario. text_view=%p se actualizara en consecuencia.&quot;,
             word,
             text_view);
}

MyTextView *
my_text_view_new (GspellChecker *spell_checker)
{
  MyTextView *text_view;

  g_return_val_if_fail (GSPELL_IS_CHECKER (spell_checker), NULL);

  text_view = g_new0 (MyTextView, 1);

  /* Almacenamos el GObject de spell_checker en la variable
   * de instancia, por lo que aumentamos el recuento de referencias
   * para asegurarnos de que el corrector ortografico permanece activo
   * durante la vida util de la text_view.
   *
   * Tenga en cuenta que el corrector ortografico se proporciona de
   * forma externa, por lo que el corrector ortografico puede vivir mas
   * tiempo que text_view, de ahi la necesidad de desconectar la se√±al
   * en my_text_view_free().
   */
  text_view-&gt;spell_checker = g_object_ref (spell_checker);

  text_view-&gt;word_added_to_personal_handler_id =
    g_signal_connect (spell_checker,
                      &quot;word-added-to-personal&quot;,
                      G_CALLBACK (word_added_to_personal_cb),
                      text_view);

  return text_view;
}

void
my_text_view_free (MyTextView *text_view)
{
  if (text_view == NULL)
    return;

  if (text_view-&gt;spell_checker != NULL &amp;&amp;
      text_view-&gt;word_added_to_personal_handler_id != 0)
    {
      g_signal_handler_disconnect (text_view-&gt;spell_checker,
                                   text_view-&gt;word_added_to_personal_handler_id);

      /* Aqui no es necesario restablecer el valor a 0 porque
       * text_view de todos modos se liberara, es solo para tener
       * un ejemplo mas completo.
       */
      text_view-&gt;word_added_to_personal_handler_id = 0;
    }

  /* El equivalente de:
   * if (text_view-&gt;spell_checker != NULL)
   * {
   *   g_object_unref (text_view-&gt;spell_checker);
   *   text_view-&gt;spell_checker = NULL;
   * }
   *
   * Despues de disminuir el recuento de referencias, spell_checker
   * aun puede estar activo si otra parte del programa todavia
   * hace referencia al mismo corrector ortografico.
   */
  g_clear_object (&amp;text_view-&gt;spell_checker);

  g_free (text_view);
}
</code></pre>
<div class="caption">
<p><span class="oop-gobject-disconnect-signal">Listado</span>: Desconectar un manejador de se√±ales cuando se libera su argumento `user_data`.</p>
</div>
<p>En realidad, hay otras funciones de <code>g_signal_handler*()</code> que permiten desconectar los manejadores de se√±ales:</p>
<ul>
<li><code>g_signal_handlers_disconnect_by_data()</code></li>
<li><code>g_signal_handlers_disconnect_by_func()</code></li>
<li><code>g_signal_handlers_disconnect_matched()</code></li>
</ul>
<p>Habr√≠a sido posible utilizar una de las funciones anteriores en el <span class="oop-gobject-disconnect-signal">Listado</span>, y habr√≠a evitado la necesidad de almacenar <code>word_added_to_personal_handler_id</code>. La funci√≥n b√°sica <code>g_signal_handler_disconnect()</code> se ha utilizado con fines de aprendizaje.</p>
<p>Tenga en cuenta tambi√©n que si <code>MyTextView</code> fuera una clase GObject, habr√≠a sido posible conectarse a la se√±al del corrector ortogr√°fico con <code>g_signal_connect_object()</code>, y habr√≠a eliminado por completo la necesidad de desconectar manualmente el controlador de se√±al en el destructor <code>MyTextView</code>. Una (peque√±a) raz√≥n m√°s para aprender a crear subclases de GObject.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="oop-gobj-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="propiedades"><a class="header" href="#propiedades">Propiedades</a></h1>
<p>Si ha mirado la referencia de la API GTK o GIO, debe haber notado que algunas clases de GObject tienen una o m√°s <em>propiedades</em>. Una propiedad es como una variable de instancia, tambi√©n llamada &quot;attribute&quot;, pero es diferente en el contexto de GObject porque tiene propiedades interesantes adicionales (Pun intencionado).</p>
<p>Como se dijo anteriormente al comienzo de la secci√≥n <span class="ch-oop-gobject-sig-prop"></span>, un buen ejemplo de una propiedad es el estado de un bot√≥n de verificaci√≥n, es decir, un valor booleano que describe si el bot√≥n est√° actualmente marcado o no. Si ya conoce un poco de GTK, es posible que haya descubierto que hay un bot√≥n de verificaci√≥n disponible con el widget <code>GtkCheckButton</code>. Pero hab√≠a una peque√±a trampa si quer√≠a encontrar la propiedad de la que estaba hablando, porque la propiedad est√° implementada en la clase padre <code>GtkToggleButton</code>: la propiedad <code>GtkToggleButton:active</code></p>
<blockquote>
<p><strong>üìå Nota:</strong> De la misma manera como las se√±ales se documentan con GTK-Doc como &quot;<code>ClassName::signal-name</code>&quot;, las propiedades se documentan como &quot;<code>ClassName:property-name</code>&quot;.</p>
</blockquote>
<h2 id="la-se√±al-notify"><a class="header" href="#la-se√±al-notify">La se√±al <code>notify</code></a></h2>
<p>El atributo principal (Pun tambi√©n intencionado) de una propiedad (adem√°s de representar un valor) es que la clase GObject emite la se√±al <code>GObject::notify</code> cuando cambia el valor de una propiedad.</p>
<p>Hay un concepto de se√±ales GObject que a√∫n no se ha explicado y se usa con la se√±al <code>GObject::notify</code>: cuando se emite una se√±al, se puede proporcionar un <em>detail</em>. En el caso de la se√±al de notificaci√≥n, el detalle es el nombre de la propiedad cuyo valor ha cambiado. Dado que solo hay una se√±al para todas las propiedades, gracias al <em>detail</em> es posible conectar una devoluci√≥n de llamada para recibir una notificaci√≥n solo cuando una determinada propiedad haya cambiado. Si el <em>detail</em> no se proporciona al conectar la devoluci√≥n de llamada, la devoluci√≥n de llamada se llamar√° cuando <em>cualquiera</em> de las propiedades del objeto cambie, lo que generalmente no es lo que se desea.</p>
<p>Ser√° m√°s claro con un ejemplo. El <span class="oop-gobject-connect-to-notify">Listado</span> muestra c√≥mo conectarse a la se√±al de notificaci√≥n. Tenga en cuenta que en lugar de conectarse a la se√±al detallada <code>&quot;notify::active&quot;</code>, en realidad es m√°s conveniente utilizar la se√±al <code>GtkToggleButton::toggled</code>. Hay mejores casos de uso en el mundo real en los que es necesario conectarse a la se√±al de notificaci√≥n, pero al menos el <span class="oop-gobject-connect-to-notify">Listado</span> es, con suerte, comprensible con solo un conocimiento limitado de GTK (y si mira la documentaci√≥n en Devhelp en paralelo).</p>
<p><a id="oop-gobject-connect-to-notify"></a></p>
<pre><code class="language-c">/* Si observa la documentacion de la se√±al de notificacion, el primer
 * parametro tiene el tipo GObject, no GtkCheckButton. Dado que
 * GtkCheckButton es una subclase de GObject, el lenguaje C permite
 * escribir GtkCheckButton directamente.
 */
static void
check_button_notify_cb (GtkCheckButton *check_button,
                        GParamSpec     *pspec,
                        gpointer        user_data)
{
  /* Se llama cada vez que cambia alguna propiedad de check_button. */
}

static void
check_button_notify_active_cb (GtkCheckButton *check_button,
                               GParamSpec     *pspec,
                               gpointer        user_data)
{
  MyWindow *window = MY_WINDOW (user_data);
  gboolean active;

  active = gtk_toggle_button_get_active (GTK_TOGGLE_BUTTON (check_button));
  gtk_widget_set_visible (window-&gt;side_panel, active);
}

static GtkWidget *
create_check_button (MyWindow *window)
{
  GtkWidget *check_button;

  check_button = gtk_check_button_new_with_label (&quot;Mostrar panel lateral&quot;);

  /* Conectese sin el detail. */
  g_signal_connect (check_button,
                    &quot;notify&quot;,
                    G_CALLBACK (check_button_notify_cb),
                    NULL);

  /* Conectese con el detail, para ser notificado solo
   * cuando la propiedad GtkToggleButton:active cambia
   */
  g_signal_connect (check_button,
                    &quot;notify::active&quot;,
                    G_CALLBACK (check_button_notify_active_cb),
                    window);

  return check_button;
}
</code></pre>
<div class="caption">
<p><span class="oop-gobject-connect-to-notify">Listado</span>: Conexi√≥n a la se√±al de notificaci√≥n para escuchar cambios en la propiedad.</p>
</div>
<h2 id="vinculaciones-de-propiedad"><a class="header" href="#vinculaciones-de-propiedad">Vinculaciones de propiedad</a></h2>
<p>Otro aspecto √∫til de las propiedades es que dos propiedades se pueden vincular f√°cilmente: cuando una propiedad cambia, la otra se actualiza para tener el mismo valor. Lo mismo se puede lograr con la se√±al <code>&quot;notify&quot;</code>, pero existen funciones de nivel superior.</p>
<p>Se pueden vincular dos propiedades de varias formas con una de las funciones <code>g_object_bind_property*()</code>. El <span class="oop-gobject-binding-properties">Listado</span> muestra una implementaci√≥n m√°s simple del <span class="oop-gobject-connect-to-notify">Listado</span>; el c√≥digo es equivalente, pero usa la funci√≥n <code>g_object_bind_property()</code>.</p>
<p><a id="oop-gobject-binding-properties"></a></p>
<pre><code class="language-c">static GtkWidget *
create_check_button (MyWindow *window)
{
  GtkWidget *check_button;

  check_button = gtk_check_button_new_with_label (&quot;Mostrar panel lateral&quot;);

  /* Cuando la propiedad GtkToggleButton:active de check_button cambia,
   * la propiedad GtkWidget:visible de window-&gt;side_panel se actualiza
   * para tener el mismo valor booleano.
   *
   * Seria util agregar G_BINDING_SYNC_CREATE a las banderas, pero en
   * ese caso el codigo no seria equivalente al listado de codigo anterior.
   */
  g_object_bind_property (check_button, &quot;active&quot;,
                          window-&gt;side_panel, &quot;visible&quot;,
                          G_BINDING_DEFAULT);

  return check_button;
}
</code></pre>
<div class="caption">
<p><span class="oop-gobject-binding-properties">Listado</span>: Vinculando dos propiedades.</p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div>
<div class="oop-gobj-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="ejemplo-de-una-arquitectura-de-c√≥digo-de-aplicaci√≥n-gtk"><a class="header" href="#ejemplo-de-una-arquitectura-de-c√≥digo-de-aplicaci√≥n-gtk">Ejemplo de una arquitectura de c√≥digo de aplicaci√≥n GTK</a></h1>
<blockquote>
<p><strong>‚ö† Advertencia:</strong> <em>Este cap√≠tulo no est√° completamente terminado, puede ser dif√≠cil de entender sin ning√∫n conocimiento sobre GTK u otro conjunto de herramientas de widgets. Y el cap√≠tulo no est√° bien integrado con los otros cap√≠tulos, la introducci√≥n y los cap√≠tulos de lectura adicional no se han adaptado, por ejemplo. Este cap√≠tulo se distribuye con la esperanza de que sea √∫til, pero SIN NINGUNA GARANT√çA; incluso sin la garant√≠a impl√≠cita de COMERCIABILIDAD o APTITUD PARA UN PROP√ìSITO EN PARTICULAR.</em></p>
</blockquote>
<!-- POR ARREGLAR: Vuelve a explicar qu√© es un "widget" y un "contenedor". Y agregue un glosario al final. -->
<p>Para cualquier proyecto de programaci√≥n, es importante dise√±ar correctamente la arquitectura de c√≥digo general. Con Programaci√≥n Orientada a Objetos, significa definir las clases principales. Este cap√≠tulo explica un buen ejemplo de una arquitectura de c√≥digo para una aplicaci√≥n GTK, observando una vista simplificada del editor de texto <a href="https://wiki.gnome.org/Apps/Gedit">gedit</a>.</p>
<p>gedit tiene una interfaz de documento con pesta√±as: se pueden abrir varios archivos en la misma ventana de gedit, en diferentes pesta√±as. Como veremos, esto se refleja en la arquitectura del c√≥digo.</p>
<p>La <span class="fig:gedit-architecture">Figura</span> muestra el esquema de la clase. Cada clase gedit en el esquema es una subclase de una clase GTK o GtkSourceView. (<a href="https://wiki.gnome.org/Projects/GtkSourceView">GtkSourceView</a> es una biblioteca que extiende el widget <code>GtkTextView</code>; <code>GtkTextView</code> es parte de GTK).</p>
<p>Repasaremos el esquema de la clase, explicando las clases paso a paso, comenzando por la parte superior. Esto permitir√° presentar algunas de las clases GTK m√°s importantes, no describi√©ndolas en detalle con muchos ejemplos de c√≥digo, sino dando una descripci√≥n general de alto nivel.</p>
<p><a id="fig-gedit-architecture"></a></p>
<div class="caption">
<img src="content/gtk-app-arch/chpt/../../../assets/img/diag/gedit-architecture.svg" alt="" width="75%" />
<p><span class="fig-gedit-architecture">Figura</span>: Arquitectura de c√≥digo simplificada del editor de texto gedit</p>
</div>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="gtk-app-arch-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="la-funci√≥n-main-y-geditapp"><a class="header" href="#la-funci√≥n-main-y-geditapp">La funci√≥n main() y GeditApp</a></h1>
<p>Aunque no est√° representado en el esquema, el punto de entrada de una aplicaci√≥n GTK (como para todos los programas en C) es la funci√≥n <code>main()</code>. Para crear una aplicaci√≥n GTK, lo principal que se debe hacer en <code>main()</code> es crear una instancia de <code>GtkApplication</code>, o una subclase de la misma. En el esquema vemos que <code>GeditApp</code> es una subclase de <code>GtkApplication</code>, por lo que la funci√≥n <code>main()</code> de gedit crea un objeto <code>GeditApp</code>.</p>
<p><code>GtkApplication</code> es la clase que contiene y representa la aplicaci√≥n completa. Por lo general, solo hay una instancia de <code>GtkApplication</code> por proceso, por lo que puede considerarse una clase singleton. Lo que contiene <code>GtkApplication</code> son <em>windows</em>, por ejemplo, <code>GeditWindow</code> en el caso de gedit, adem√°s de otros tipos de ventanas como ventanas de di√°logo.</p>
<p>Ya vimos la jerarqu√≠a de clases <code>GtkApplication</code> en la secci√≥n <span class="ch-oop-gobj-inherit">Herencia</span> al explicar la herencia POO con GObject:</p>
<pre><code class="language-plaintext">GObject
‚îî‚îÄ‚îÄ GApplication
    ‚îî‚îÄ‚îÄ GtkApplication
</code></pre>
<p><code>GApplication</code> es parte de la biblioteca GIO e implementa las funciones que no est√°n relacionadas con la interfaz gr√°fica de usuario (GUI). Entonces, para un programa que se ejecuta en la terminal, es posible usar solo <code>GApplication</code>.</p>
<p>Una caracter√≠stica importante que proporciona <code>GApplication</code> es la unicidad del proceso (pero puede desactivarse si no se desea). Lo que hace la unicidad del proceso es tener solo un proceso por aplicaci√≥n por sesi√≥n de usuario. Para que esa caracter√≠stica funcione, se debe proporcionar un ID de aplicaci√≥n al crear el objeto <code>GApplication</code>. Con ese ID, <code>GApplication</code> busca si otro proceso ya ejecuta la misma aplicaci√≥n en la misma sesi√≥n de usuario; si es el caso, comunica a la instancia primaria las acciones que deben realizarse (por ejemplo, abrir una nueva ventana, o abrir un nuevo archivo en una ventana existente, etc.). Cuando las acciones se realizan en la instancia principal, el segundo proceso finaliza inmediatamente. En Linux, <code>GApplication</code> utiliza el sistema de comunicaci√≥n entre procesos (IPC) D-Bus para comunicarse entre los dos procesos.</p>
<p>La singularidad del proceso tiene varias ventajas, por dar algunos ejemplos concretos:</p>
<ul>
<li>
<p>Para una aplicaci√≥n con una interfaz de documento con pesta√±as, al hacer clic en un archivo en un administrador de archivos como Nautilus, el archivo se puede abrir en una nueva pesta√±a en lugar de crear cada vez una nueva ventana. Para que esto funcione, la comunicaci√≥n entre procesos es necesaria de una forma u otra;</p>
</li>
<li>
<p>Una aplicaci√≥n no necesita sincronizar expl√≠citamente su estado y datos entre diferentes procesos. En aras del argumento, digamos que en gedit el usuario puede crear &quot;herramientas de compilaci√≥n&quot; personalizadas para compilar el archivo o proyecto actual. gedit guarda las herramientas de construcci√≥n personalizadas en un archivo XML y se muestran en el men√∫ para ejecutar sus comandos. En Linux, el archivo XML se guarda, por ejemplo, en el directorio <code>~/.local/share/</code> del usuario. Sin la unicidad del proceso, si un proceso gedit modifica las herramientas de compilaci√≥n personalizadas, los otros procesos gedit deben volver a cargar el archivo XML y deben asegurarse de que no haya carreras (dos procesos gedit diferentes no deben modificar el archivo XML al mismo tiempo) . Con la unicidad del proceso, ese problema no existe, todas las ventanas gedit comparten el mismo estado de la aplicaci√≥n, y el desarrollador puede asumir que solo un proceso por usuario puede modificar el archivo XML (Por supuesto, el usuario todav√≠a tiene la posibilidad de editar el archivo XML a mano, pero en ese caso la aplicaci√≥n se puede reiniciar, normalmente se espera que el usuario modifique las herramientas de compilaci√≥n de la GUI que proporciona gedit).</p>
</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> Tenga en cuenta que esto no ser√≠a cierto si fuera posible abrir <em>varias</em> sesiones gr√°ficas para el mismo usuario, en la misma m√°quina (con soporte para m√∫ltiples puestos) o al menos compartir el almacenamiento de respaldo para el directorio de inicio (por ejemplo, con montajes NFS). Pero GNOME y la mayor√≠a de las aplicaciones no admiten esto, un usuario puede abrir como m√°ximo una sesi√≥n gr√°fica a la vez para el mismo directorio de inicio. Para los inicios de sesi√≥n en la misma m√°quina f√≠sica, esto se aplica mediante GDM (el administrador de pantalla GNOME y la pantalla de inicio de sesi√≥n) y D-Bus. En el caso de montajes NFS, esto no se aplica, pero si el mismo usuario abre varias sesiones gr√°ficas en diferentes equipos, es posible que algunos programas no funcionen correctamente. Entonces, aunque la unicidad del proceso de <code>GApplication</code> est√° documentada como por <em>sesi√≥n de usuario</em>, en la pr√°ctica podemos decir que es simplemente por <em>usuario</em>.</p>
</blockquote>
<p>Otra caracter√≠stica importante de <code>GApplication</code> es ejecutar el ciclo de eventos principal. El bucle de eventos principal de GLib se describi√≥ en la secci√≥n <span class="ch-glib-main-loop">El bucle del evento principal</span>. Con <code>GApplication</code>, esto se hace con la funci√≥n <code>g_application_run()</code>. Una versi√≥n minimalista de la funci√≥n <code>main()</code> en gedit se ver√≠a as√≠:</p>
<pre><code class="language-c">int
main (int    argc,
      char **argv)
{
  GeditApp *app;
  int status;

  /* Inicializacion de i18n (internacionalizacion) aqui. */

  app = gedit_app_new ();
  status = g_application_run (G_APPLICATION (app), argc, argv);
  g_object_unref (app);

  return status;
}
</code></pre>
<p>Lo que hace <code>GeditApp</code> es b√°sicamente lo que deber√≠a hacerse en <code>main()</code> si no hubiera una subclase <code>GtkApplication</code>. Esto incluye:</p>
<ul>
<li>
<p>Configurando correctamente el objeto <code>GtkApplication</code>, por ejemplo, dando el ID de la aplicaci√≥n;</p>
</li>
<li>
<p>Conectando devoluciones de llamada a algunas se√±ales, por ejemplo para crear una <code>GeditWindow</code> cuando sea necesario;</p>
</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> Pero tenga en cuenta que en una subclase de GObject, en lugar de conectar devoluciones de llamada a se√±ales de una clase principal con p. Ej. <code>g_signal_connect()</code>, es mejor anular las funciones virtuales en su lugar.</p>
</blockquote>
<ul>
<li>Implementando <code>GAction</code> en toda la aplicaci√≥n. <code>GAction</code> es una parte de clase de GIO que representa una acci√≥n que el usuario puede desencadenar. Una acci√≥n en toda la aplicaci√≥n es, por ejemplo, salir de la aplicaci√≥n o abrir el cuadro de di√°logo de preferencias (porque las preferencias se aplican a toda la aplicaci√≥n).</li>
</ul>
<p>Cuando comienzas a escribir una nueva aplicaci√≥n GTK, no ves directamente la necesidad de una subclase <code>GtkApplication</code>, ya que el c√≥digo en <code>main()</code>, m√°s las devoluciones de llamada, a√∫n son peque√±as. Pero cuando se agregan m√°s y m√°s caracter√≠sticas, es una buena idea en alg√∫n momento mover el c√≥digo a una subclase <code>GtkApplication</code>. O para crear una subclase directamente. Una subclase es especialmente √∫til cuando surge la necesidad de almacenar datos adicionales.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div>
<div style="break-before: page; page-break-before: always;"></div><h1 id="geditwindow"><a class="header" href="#geditwindow">GeditWindow</a></h1>
<p><code>GeditWindow</code> es una subclase de <code>GtkApplicationWindow</code>. Y no lo vemos en el esquema, pero <code>GtkApplicationWindow</code> es una subclase de <code>GtkWindow</code>, que es un widget de nivel superior. Un widget de nivel superior no puede incluirse en otro widget. Una <code>GtkApplicationWindow</code> est√° contenida en una <code>GtkApplication</code>, pero <code>GtkApplication</code> no es una subclase de <code>GtkWidget</code>.</p>
<p>En el esquema, la notaci√≥n &quot;<span class="text-monospace">1</span>&quot; y &quot;<span class="text-monospace">1..*</span>&quot; significa que un objeto <code>GeditApp</code> <em>contiene</em> uno o varios <code>GeditWindow</code> objetos, y que una <code>GeditWindow</code> est√° contenida exactamente en una <code>GeditApp</code> (una <code>GeditWindow</code> no puede estar contenida en varios objetos <code>GeditApp</code>, de todos modos solo hay una instancia de <code>GeditApp</code> por proceso).</p>
<p><code>GeditWindow</code> es responsable de crear la interfaz de usuario principal, creando otros widgets y ensambl√°ndolos en un contenedor <code>GtkGrid</code>, por ejemplo. Otra cosa que hace <code>GeditWindow</code> es implementar las <code>GActions</code> que tienen un efecto solo en la ventana actual, por ejemplo, una acci√≥n para cerrar la ventana o guardar el documento actual. Al implementar una <code>GAction</code>, <code>GeditWindow</code> puede, por supuesto, delegar la mayor parte de su trabajo a otras clases contenidas en <code>GeditWindow</code>.</p>
<p>En la parte superior de la ventana principal de una aplicaci√≥n, generalmente hay una <code>GtkHeaderBar</code>, que muestra el t√≠tulo de la ventana, algunos botones y un men√∫ de &quot;hamburguesa&quot;. Alternativamente, una aplicaci√≥n puede tener una barra de men√∫ y una barra de herramientas tradicionales.</p>
<p>Adem√°s de la barra de encabezado, <code>GeditWindow</code> crea un widget <code>GeditStatusbar</code> y lo agrega al final de la ventana. Tambi√©n crea dos <code>GeditPanels</code>, uno en el lado izquierdo de la ventana y el otro en la parte inferior, encima de la <code>GeditStatusbar</code>. Cada panel puede contener varios elementos. Por ejemplo, el panel lateral contiene un explorador de archivos integrado y el panel inferior puede contener una terminal, entre otras cosas.</p>
<blockquote>
<p><strong>üìå Nota:</strong> El c√≥digo gedit actual en realidad ya no contiene una clase <code>GeditPanel</code>, pero fue el caso en una versi√≥n anterior. Se agreg√≥ <code>GeditPanel</code> al diagrama para mostrar una posible implementaci√≥n de paneles en una aplicaci√≥n. Si su aplicaci√≥n contiene solo un elemento en un panel, no es necesario tener una clase <code>Panel</code>, puede agregar directamente el elemento a la ventana.</p>
</blockquote>
<p><code>GeditWindow</code> tambi√©n crea un <code>GeditNotebook</code>, la parte principal de la ventana.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="geditnotebook-y-lo-que-contiene"><a class="header" href="#geditnotebook-y-lo-que-contiene">GeditNotebook y lo que contiene</a></h1>
<p><code>GeditNotebook</code> es una subclase de <code>GtkNotebook</code>, que es el widget que muestra pesta√±as y tambi√©n contiene su contenido.</p>
<p>En el esquema de la clase, podemos ver que el contenido de una pesta√±a es un widget <code>GeditTab</code>, una subclase de <code>GtkGrid</code>. El elemento principal dentro de una <code>GeditTab</code> es <code>GeditView</code>. M√°s precisamente --- se omiti√≥ en el esquema por concisi√≥n --- el <code>GeditView</code> est√° contenido en una <code>GtkScrolledWindow</code> que est√° contenido en el <code>GeditTab</code>. Pero <code>GeditTab</code> puede contener otros widgets, por ejemplo, barras de informaci√≥n en la parte superior del documento.</p>
<p><code>GeditView</code> es una subclase de <code>GtkSourceView</code>, que en s√≠ misma es una subclase de <code>GtkTextView</code>. <code>GtkTextView</code> --- que es parte de GTK --- es la base para un editor de texto multil√≠nea. La biblioteca GtkSourceView agrega caracter√≠sticas √∫tiles para el c√≥digo fuente, como el resaltado de sintaxis. <code>GtkTextView</code> sigue un patr√≥n Modelo-Vista-Controlador. <code>GtkTextBuffer</code> es el modelo, es decir, contiene los datos.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="por-qu√©-y-cu√°ndo-crear-subclases-de-widgets-gtk"><a class="header" href="#por-qu√©-y-cu√°ndo-crear-subclases-de-widgets-gtk">¬øPor qu√© y cu√°ndo crear subclases de widgets GTK?</a></h1>
<p>Si buscamos, por ejemplo, en <code>GeditTab</code>, contiene --- por composici√≥n --- a <code>GeditView</code>. <code>GeditView</code> es una subclase de <code>GtkSourceView</code>. En su lugar, <code>GeditTab</code> podr√≠a usar por composici√≥n directamente un objeto <code>GtkSourceView</code> y mover el c√≥digo de <code>GeditView</code> a <code>GeditTab</code>. Pero, por lo general, sucede o deber√≠a ocurrir exactamente lo contrario.</p>
<p>Cuando la base de c√≥digo de una aplicaci√≥n GTK a√∫n es peque√±a, por ejemplo, si comienza a escribir un equivalente de <code>GeditTab</code>, puede crear un objeto <code>GtkSourceView</code> directamente en <code>GeditTab</code> y almacenar la <code>GtkSourceView</code> objeto en una variable de instancia. Luego, al implementar nuevas caracter√≠sticas, agrega nuevas funciones que usan casi exclusivamente la variable de instancia <code>GtkSourceView</code>. Incluso puede tener funciones <code>static</code> que toman directamente un argumento <code>GtkSourceView</code> en lugar del par√°metro <code>GeditTab</code> <em>self</em>. Tambi√©n puede almacenar datos adicionales √∫tiles solo para las funciones relacionadas con <code>GtkSourceView</code>. Si la clase <code>GeditTab</code> a√∫n es peque√±a (por ejemplo, 500 l√≠neas de c√≥digo) y no contiene muchas variables de instancia, no hay problema. Por otro lado, si la clase <code>GeditTab</code> se vuelve m√°s grande (por ejemplo, m√°s de 2000 l√≠neas de c√≥digo), entonces probablemente sea una se√±al de que la clase deber√≠a delegar parte de su trabajo a una nueva clase; en nuestro caso, <code>GeditView</code>. Tenga en cuenta que 2000 l√≠neas de c√≥digo para una clase pueden estar bien, no hay un l√≠mite claro sobre cu√°ndo se debe dividir una clase. Pero si la clase <code>GeditView</code> resultante contendr√≠a al menos varios cientos de c√≥digo no est√°ndar, probablemente sea una buena idea hacer la refactorizaci√≥n.</p>
<p>De lo que se trata OOP es de empaquetar datos y comportamiento juntos, y delegar parte del trabajo a otras clases. La herencia de clases tiene sentido cuando queremos agregar m√°s comportamiento a una clase existente, con posibles datos adicionales relacionados con el comportamiento agregado. <code>GeditView</code> es una subclase de <code>GtkSourceView</code> porque <code>GeditView</code> <em>es a</em> <code>GtkSourceView</code>; es decir, <code>GeditView</code> opera con los mismos datos base que <code>GtkSourceView</code>. Adem√°s, permite a <code>GeditTab</code> delegar parte de su trabajo, con el objetivo de tener clases m√°s peque√±as y manejables. M√°s peque√±o de dos formas: menos c√≥digo y menos variables de instancia.</p>
<p>Por lo tanto, durante la vida √∫til de una aplicaci√≥n GTK, el programador a menudo necesita refactorizar el c√≥digo, crear nuevas clases y delegar m√°s trabajo. Lo contrario puede suceder cuando el c√≥digo de la aplicaci√≥n se mueve a la biblioteca subyacente; por ejemplo, si todas las caracter√≠sticas de <code>GeditView</code> se agregan a la clase <code>GtkSourceView</code>; en ese caso, la subclase <code>GeditView</code> ya no tiene sentido.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="widgets-compuestos"><a class="header" href="#widgets-compuestos">Widgets compuestos</a></h1>
<p>Los widgets compuestos son contenedores que ya contienen una colecci√≥n √∫til de widgets secundarios en un paquete agradable. Implementar un widget compuesto es f√°cil (una vez que sepa c√≥mo subclasificar una clase GObject), solo necesita:</p>
<ol>
<li>Subclase un contenedor como <code>GtkGrid</code> o <code>GtkBin</code> o <code>GtkWindow</code>;</li>
<li>En el constructor de la clase, cree los widgets secundarios y agr√©guelos al contenedor.</li>
</ol>
<p>En el esquema de la clase gedit, los widgets compuestos son las subclases de <code>GtkGrid</code> (<code>GeditPanel</code> y <code>GeditTab</code>) y <code>GeditWindow</code>.</p>
<p><code>GeditWindow</code> es una subclase indirecta de <code>GtkBin</code>, por lo que puede contener como m√°ximo un widget hijo. Es por eso que <code>GeditWindow</code> usa un <code>GtkGrid</code> como su widget hijo, de modo que <code>GtkGrid</code> puede contener a su vez todos los elementos de la ventana.</p>
<p>Por defecto, una <code>GeditTab</code> tiene solo un widget secundario, la <code>GtkScrolledWindow</code> que contiene la <code>GeditView</code>. Pero <code>GeditTab</code> tiene una funci√≥n para agregar un <code>GtkInfoBar</code> en la parte superior, mostrando por ejemplo un mensaje de error.</p>
<p>Entonces, mientras <code>GtkGrid</code> es un contenedor de uso general que inicialmente no contiene ning√∫n widget secundario, un widget compuesto es un contenedor especializado que ya contiene widgets secundarios espec√≠ficos. Escribir widgets compuestos es una forma conveniente de codificar aplicaciones.</p>
<!-- POR HACER mostrar un ejemplo de c√≥digo --><div style="break-before: page; page-break-before: always;"></div><h1 id="lecturas-adicionales"><a class="header" href="#lecturas-adicionales">Lecturas adicionales</a></h1>
<p>En este punto, debe conocer los conceptos b√°sicos de GLib core y GObject. No necesitas saber <em>todo</em> sobre GLib core y GObject para continuar, pero tener al menos un conocimiento b√°sico te permitir√° aprender m√°s f√°cilmente GTK y GIO, o cualquier otra biblioteca basada en GObject.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="gtk-y-gio"><a class="header" href="#gtk-y-gio">GTK y GIO</a></h1>
<p>GTK y GIO se pueden aprender en paralelo.</p>
<p>Deber√≠a poder usar cualquier clase de GObject en GIO, solo lea la descripci√≥n de la clase y hojee la lista de funciones para tener una descripci√≥n general de las caracter√≠sticas que proporciona una clase. Entre otras cosas interesantes, GIO incluye:</p>
<ul>
<li><code>GFile</code> para manejar archivos y directorios.</li>
<li><code>GSettings</code> para almacenar la configuraci√≥n de la aplicaci√≥n.</li>
<li><code>GDBus</code>: una API de alto nivel para el sistema de comunicaci√≥n entre procesos D-Bus.</li>
<li><code>GSubprocess</code> para iniciar procesos secundarios y comunicarse con ellos de forma asincr√≥nica.</li>
<li><code>GCancellable</code>, <code>GAsyncResult</code> y <code>GTask</code> para usar o implementar tareas asincr√≥nicas y cancelables.</li>
<li>Muchas otras funciones, como flujos de E/S, soporte de red o soporte de aplicaciones.</li>
</ul>
<p>Para crear aplicaciones gr√°ficas con GTK, no se preocupe, la documentaci√≥n de referencia tiene una gu√≠a de introducci√≥n, disponible con Devhelp o en l√≠nea en:</p>
<p><a href="https://docs.gtk.org/gtk4/">https://docs.gtk.org/gtk4/</a></p>
<p>Despu√©s de leer la gu√≠a de introducci√≥n, lea toda la referencia de la API para familiarizarse con los widgets, contenedores y clases base disponibles. Algunos widgets tienen una API bastante grande, por lo que tambi√©n est√°n disponibles algunos tutoriales externos, por ejemplo, para <code>GtkTextView</code> y <code>GtkTreeView</code>. Consulte la p√°gina de documentaci√≥n en:</p>
<p><a href="http://www.gtk.org">www.gtk.org</a></p>
<p>Tambi√©n hay una serie de peque√±os tutoriales sobre varios temas GLib/GTK:</p>
<p><a href="https://wiki.gnome.org/HowDoI">wiki.gnome.org/HowDoI</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="escribir-sus-propias-clases-de-gobject"><a class="header" href="#escribir-sus-propias-clases-de-gobject">Escribir sus propias clases de GObject</a></h1>
<p>El <span class="ch-oop-gobject">cap√≠tulo</span> explica c√≥mo &quot;usar&quot; una clase GObject existente, que es muy √∫til para aprender GTK, pero no explica c√≥mo &quot;crear&quot; tus propias clases GObject. Escribir sus propias clases de GObject permite contar con referencias, puede crear sus propias propiedades y se√±ales, puede implementar interfaces, anular funciones virtuales (si la funci√≥n virtual no est√° asociada a una se√±al), etc.</p>
<p>Como se explic√≥ al principio del <span class="ch-oop-gobject">cap√≠tulo</span>, si desea obtener informaci√≥n m√°s detallada sobre GObject y saber c√≥mo crear subclases, la documentaci√≥n de referencia de GObject contiene cap√≠tulos introductorios: &quot;<em>Concepts</em>&quot; y &quot;<em>Tutorial</em>&quot;, disponibles como de costumbre en Devhelp o en l√≠nea en:</p>
<p><a href="https://docs.gtk.org/gobject/">https://docs.gtk.org/gobject/</a></p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="refs-ch"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="sistema-de-compilaci√≥n"><a class="header" href="#sistema-de-compilaci√≥n">Sistema de compilaci√≥n</a></h1>
<p>Un Makefile b√°sico generalmente no es suficiente si desea instalar su aplicaci√≥n en diferentes sistemas. Por tanto, se necesita una soluci√≥n m√°s sofisticada. Para un programa basado en GLib/GTK, existen dos alternativas principales: Autotools y Meson.</p>
<p>GNOME y GTK hist√≥ricamente usan Autotools, pero a partir de 2017 algunos m√≥dulos (incluido GTK) est√°n migrando a Meson. Para un nuevo proyecto, se puede recomendar Meson.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="las-autotools"><a class="header" href="#las-autotools">Las Autotools</a></h1>
<p>Las Autotools comprenden tres componentes principales: Autoconf, Automake y Libtool. Est√° basado en scripts de shell, macros m4 y <code>make</code>.</p>
<p>Las macros est√°n disponibles para varios prop√≥sitos (la documentaci√≥n del usuario, estad√≠sticas de cobertura de c√≥digo para pruebas unitarias, etc.). El libro m√°s reciente sobre el tema es <em>Autotools</em>, de John Calcote <span class="autotools"></span>.</p>
<p>Pero Autotools tiene la reputaci√≥n de ser dif√≠cil de aprender.</p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="biblio-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="meson"><a class="header" href="#meson">Meson</a></h1>
<p>Meson es un sistema de construcci√≥n bastante nuevo, es m√°s f√°cil de aprender que Autotools y tambi√©n resulta en construcciones m√°s r√°pidas. Algunos m√≥dulos de GNOME ya usan Meson. Consulte el sitio web para obtener m√°s informaci√≥n:</p>
<p><a href="https://mesonbuild.com/">https://mesonbuild.com/</a></p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="mejores-pr√°cticas-de-programaci√≥n"><a class="header" href="#mejores-pr√°cticas-de-programaci√≥n">Mejores pr√°cticas de programaci√≥n</a></h1>
<p>Se recomienda seguir las Pautas de programaci√≥n de GNOME <span class="gnome-programming-guidelines"></span>.</p>
<p>La siguiente lista no tiene nada que ver con el desarrollo de GLib/GTK, pero es √∫til para cualquier proyecto de programaci√≥n. Despu√©s de tener algo de pr√°ctica, es interesante aprender m√°s sobre las <em>mejores</em> pr√°cticas de programaci√≥n. Escribir c√≥digo de buena calidad es importante para prevenir errores y para mantener una pieza de software a largo plazo.</p>
<ul>
<li><em>El</em> libro sobre las mejores pr√°cticas de programaci√≥n es <em>Code Complete</em>, de Steve McConnell <span class="code-complete"></span>. Muy recomendable</li>
</ul>
<blockquote>
<p><strong>üìå Nota:</strong> Aunque el editor de <em>Code Complete</em> es Microsoft Press, el libro no est√° relacionado con Microsoft o Windows. El autor a veces explica cosas relacionadas con el c√≥digo abierto, UNIX y Linux, pero uno puede lamentar la ausencia total de la menci√≥n &quot;software libre/free&quot; y todos los beneficios de la libertad, en particular para este tipo de libros: poder aprender leyendo el c√≥digo de otros. Pero si est√° aqu√≠, es de esperar que ya sepa todo esto.</p>
</blockquote>
<ul>
<li>
<p>Para obtener pautas sobre POO espec√≠ficamente, consulte <em>Object-Oriented Design Heuristics</em>, de Arthur Riel <span class="oop-book"></span>.</p>
</li>
<li>
<p>Una excelente fuente de informaci√≥n es la web de <a href="https://martinfowler.com/">Martin Fowler</a>: refactorizaci√≥n, metodolog√≠a √°gil, dise√±o de c√≥digo, ...</p>
</li>
</ul>
<p>M√°s relacionados con GNOME, los art√≠culos de Havoc Pennington tienen buenos consejos que vale la pena leer, incluidos &quot;<em>Working on Free Software</em>&quot;, &quot;<em>Free software UI</em>&quot; y &quot;<em>Free Software Maintenance: Adding Features</em>&quot;:</p>
<p><a href="https://ometer.com/writing.html">https://ometer.com/writing.html</a></p>
<!-- Habilitacion del enumeramiento de referencias -->
<div class="biblio-refs"></div><div style="break-before: page; page-break-before: always;"></div><h1 id="bibliograf√≠a"><a class="header" href="#bibliograf√≠a">Bibliograf√≠a</a></h1>
<ol>
<li>
<p><a id="k-r-book"></a>
Brian Kernighan y Dennis Ritchie (1988).<br>
<em>The C Programming Language</em> (2da ed.). Prentice Hall.</p>
</li>
<li>
<p><a id="oop-book"></a>
Arthur Riel (1996).<br>
<em>Object-Oriented Design Heuristics</em> (1ra ed.). Addison-Wesley.</p>
</li>
<li>
<p><a id="design-patterns-book"></a>
Gamma E., Helm R., Johnson R. y Vlissides J. (1994).<br>
<em>Design Patterns: Elements of Reusable Object-Oriented Software</em> (1ra ed.). Addison-
Wesley Professional.</p>
</li>
<li>
<p><a id="algo-book"></a>
Steven Skiena (2008).<br>
<em>The Algorithm Design Manual</em> (2da ed.). Springer.</p>
</li>
<li>
<p><a id="unix-impatient"></a>
Paul Abrahams (1995).<br>
UNIX for the Impatient (2da ed.). Addison-Wesley.</p>
</li>
<li>
<p><a id="pro-git"></a>
Scott Chacon.<br>
<em>Pro Git</em>.<br>
<a href="https://git-scm.com/book">https://git-scm.com/book</a></p>
</li>
<li>
<p><a id="autotools"></a>
John Calcote (2010).<br>
<em>Autotools: A Practitioner‚Äôs Guide to GNU Autoconf, Automake, and Libtool</em> (1ra ed.).
No Starch Press.</p>
</li>
<li>
<p><a id="code-complete"></a>
Steve McConnell (2004).<br>
<em>Code Complete: A practical handbook of software construction</em> (2da ed.). Microsoft Press.</p>
</li>
<li>
<p><a id="gtk-doc"></a>
GTK-Doc Manual.<br>
<a href="https://developer.gnome.org/gtk-doc-manual/">https://developer.gnome.org/gtk-doc-manual/</a></p>
</li>
<li>
<p><a id="gobject-introspection"></a>
GObject Introspection.<br>
<a href="https://wiki.gnome.org/Projects/GObjectIntrospection">https://wiki.gnome.org/Projects/GObjectIntrospection</a></p>
</li>
<li>
<p><a id="gnome-programming-guidelines"></a>
GNOME Programming Guidelines.<br>
<a href="https://developer.gnome.org/programming-guidelines/stable/">https://developer.gnome.org/programming-guidelines/stable/</a></p>
</li>
</ol>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        <script type="text/javascript" src="./src/assets/js/refs-ch.js"></script>
        <script type="text/javascript" src="./src/assets/js/refs-biblio.js"></script>
        <script type="text/javascript" src="./src/assets/js/refs-intro.js"></script>
        <script type="text/javascript" src="./src/assets/js/refs-glib.js"></script>
        <script type="text/javascript" src="./src/assets/js/refs-oop-semi.js"></script>
        <script type="text/javascript" src="./src/assets/js/refs-oop-gobj.js"></script>
        <script type="text/javascript" src="./src/assets/js/refs-gtk-app-arch.js"></script>

        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </body>
</html>
